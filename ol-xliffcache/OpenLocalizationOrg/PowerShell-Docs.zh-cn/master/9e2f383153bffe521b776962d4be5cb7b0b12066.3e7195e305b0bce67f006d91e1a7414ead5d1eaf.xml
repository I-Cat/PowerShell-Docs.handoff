{"nodes":[{"pos":[32,72],"content":"Configure Port Mirroring | Microsoft ATA","needQuote":true,"nodes":[{"content":"Configure Port Mirroring | Microsoft ATA","pos":[0,40]}]},{"pos":[86,152],"content":"Describes port mirroring options and how to configure them for ATA","needQuote":true,"nodes":[{"content":"Describes port mirroring options and how to configure them for ATA","pos":[0,66]}]},{"content":"Applies to: Advanced Threat Analytics version 1.7","pos":[482,531]},{"pos":[538,562],"content":"Configure Port Mirroring","linkify":"Configure Port Mirroring","nodes":[{"content":"Configure Port Mirroring","pos":[0,24]}]},{"pos":[565,884],"content":"[!NOTE] \nThis article is relevant only if you deploy ATA Gateways instead of ATA Lightweight Gateways. To determine if you need to use ATA Gateways, see [Choosing the right gateways for your deployment](/advanced-threat-analytics/plan-design/ata-capacity-planning#choosing-the-right-gateway-type-for-your-deployment).","leadings":["","> "],"nodes":[{"content":"This article is relevant only if you deploy ATA Gateways instead of ATA Lightweight Gateways. To determine if you need to use ATA Gateways, see [Choosing the right gateways for your deployment](/advanced-threat-analytics/plan-design/ata-capacity-planning#choosing-the-right-gateway-type-for-your-deployment).","pos":[9,317],"nodes":[{"content":"This article is relevant only if you deploy ATA Gateways instead of ATA Lightweight Gateways.","pos":[0,93]},{"content":"To determine if you need to use ATA Gateways, see <bpt id=\"p1\">[</bpt>Choosing the right gateways for your deployment<ept id=\"p1\">](/advanced-threat-analytics/plan-design/ata-capacity-planning#choosing-the-right-gateway-type-for-your-deployment)</ept>.","pos":[94,308],"source":" To determine if you need to use ATA Gateways, see [Choosing the right gateways for your deployment](/advanced-threat-analytics/plan-design/ata-capacity-planning#choosing-the-right-gateway-type-for-your-deployment)."}]}]},{"content":"The main data source used by ATA is deep packet inspection of the network traffic to and from your domain controllers.","pos":[887,1005]},{"content":"For ATA to see the network traffic, you must either configure port mirroring, or use a Network TAP.","pos":[1006,1105]},{"content":"For port mirroring, configure <bpt id=\"p1\">**</bpt>port mirroring<ept id=\"p1\">**</ept> for each domain controller to be monitored, as the <bpt id=\"p2\">**</bpt>source<ept id=\"p2\">**</ept> of the network traffic.","pos":[1107,1241],"source":"For port mirroring, configure **port mirroring** for each domain controller to be monitored, as the **source** of the network traffic."},{"content":"Typically, you will need to work with the networking or virtualization team to configure port mirroring.","pos":[1242,1346]},{"content":"For more information, refer to your vendor's documentation.","pos":[1347,1406],"source":"\nFor more information, refer to your vendor's documentation."},{"content":"Your domain controllers and ATA Gateways can be either physical or virtual.","pos":[1408,1483]},{"content":"The following are common methods for port mirroring and some considerations.","pos":[1484,1560]},{"content":"Refer to your switch or virtualization server product documentation for additional information.","pos":[1561,1656]},{"content":"Your switch manufacturer might use different terminology.","pos":[1657,1714]},{"content":"<bpt id=\"p1\">**</bpt>Switched Port Analyzer (SPAN)<ept id=\"p1\">**</ept> – Copies network traffic from one or more switch ports to another switch port on the same switch.","pos":[1716,1847],"source":"**Switched Port Analyzer (SPAN)** – Copies network traffic from one or more switch ports to another switch port on the same switch."},{"content":"Both the ATA Gateway and domain controllers must be connected to the same physical switch.","pos":[1848,1938]},{"content":"<bpt id=\"p1\">**</bpt>Remote Switch Port Analyzer (RSPAN)<ept id=\"p1\">**</ept>  – Allows you to monitor network traffic from source ports distributed over multiple physical switches.","pos":[1940,2083],"source":"**Remote Switch Port Analyzer (RSPAN)**  – Allows you to monitor network traffic from source ports distributed over multiple physical switches."},{"content":"RSPAN copies the source traffic into a special RSPAN configured VLAN.","pos":[2084,2153]},{"content":"This VLAN needs to be trunked to the other switches involved.","pos":[2154,2215]},{"content":"RSPAN works at Layer 2.","pos":[2216,2239]},{"content":"<bpt id=\"p1\">**</bpt>Encapsulated Remote Switch Port Analyzer (ERSPAN)<ept id=\"p1\">**</ept> – Is a Cisco proprietary technology working at Layer 3.","pos":[2241,2350],"source":"**Encapsulated Remote Switch Port Analyzer (ERSPAN)** – Is a Cisco proprietary technology working at Layer 3."},{"content":"ERSPAN allows you to monitor traffic across switches without the need for VLAN trunks.","pos":[2351,2437]},{"content":"ERSPAN uses generic routing encapsulation (GRE) to copy monitored network traffic.","pos":[2438,2520]},{"content":"ATA currently cannot directly receive ERSPAN traffic.","pos":[2521,2574]},{"content":"For ATA to work with ERSPAN traffic, a switch or router that can decapsulate the traffic needs to be configured as the destination of ERSPAN where the traffic will be decapsulated.","pos":[2575,2755]},{"content":"The switch or router will then need to be configured to forward it to the ATA Gateway using either SPAN or RSPAN.","pos":[2756,2869]},{"pos":[2873,3034],"content":"[!NOTE]\nIf the domain controller being port mirrored is connected over a WAN link, make sure the WAN link can handle the additional load of the ERSPAN traffic.","leadings":["","> "],"nodes":[{"content":"If the domain controller being port mirrored is connected over a WAN link, make sure the WAN link can handle the additional load of the ERSPAN traffic.","pos":[8,159]}]},{"pos":[3039,3071],"content":"Supported port mirroring options","linkify":"Supported port mirroring options","nodes":[{"content":"Supported port mirroring options","pos":[0,32]}]},{"content":"ATA Gateway","pos":[3074,3085]},{"content":"Domain Controller","pos":[3086,3103]},{"content":"Considerations","pos":[3104,3118]},{"content":"Virtual","pos":[3180,3187]},{"content":"Virtual on same host","pos":[3188,3208]},{"content":"The virtual switch needs to support port mirroring.","pos":[3209,3260]},{"content":"Moving one of the virtual machines to another host by itself may break the port mirroring.","pos":[3272,3362]},{"content":"Virtual","pos":[3365,3372]},{"content":"Virtual on different hosts","pos":[3373,3399]},{"content":"Make sure your virtual switch supports this scenario.","pos":[3400,3453]},{"content":"Virtual","pos":[3456,3463]},{"content":"Physical","pos":[3464,3472]},{"content":"Requires a dedicated network adapter otherwise ATA will see all of the traffic coming in and out of the host, even the traffic it sends to the ATA Center.","pos":[3473,3627]},{"content":"Physical","pos":[3630,3638]},{"content":"Virtual","pos":[3639,3646]},{"content":"Make sure your virtual switch supports this scenario - and port mirroring configuration on your physical switches based on the scenario:","pos":[3647,3783]},{"content":"If the virtual host is on the same physical switch, you will need to configure a switch level span.","pos":[3795,3894]},{"content":"If the virtual host is on a different switch, you will need to configure RSPAN or ERSPAN&amp;#42;.","pos":[3906,4000],"source":"If the virtual host is on a different switch, you will need to configure RSPAN or ERSPAN&#42;."},{"content":"Physical","pos":[4003,4011]},{"content":"Physical on the same switch","pos":[4012,4039]},{"content":"Physical switch must support SPAN/Port Mirroring.","pos":[4040,4089]},{"content":"Physical","pos":[4092,4100]},{"content":"Physical on a different switch","pos":[4101,4131]},{"content":"Requires physical switches to support RSPAN or ERSPAN&amp;#42;.","pos":[4132,4191],"source":"Requires physical switches to support RSPAN or ERSPAN&#42;."},{"content":"&amp;#42; ERSPAN is only supported when decapsulation is performed before the traffic is analyzed by ATA.","pos":[4193,4294],"source":"&#42; ERSPAN is only supported when decapsulation is performed before the traffic is analyzed by ATA."},{"pos":[4298,4442],"content":"[!NOTE]\nMake sure that domain controllers and the ATA Gateways to which they connect have time synchronized to within 5 minutes of each other.","leadings":["","> "],"nodes":[{"content":"Make sure that domain controllers and the ATA Gateways to which they connect have time synchronized to within 5 minutes of each other.","pos":[8,142]}]},{"content":"If you are working with virtualization clusters:","pos":[4446,4494]},{"content":"For each domain controller running on the virtualization cluster in a virtual machine with the ATA Gateway,  configure affinity between the domain controller and the ATA Gateway.","pos":[4502,4680]},{"content":"This way when the domain controller moves to another host in the cluster the ATA Gateway will follow it.","pos":[4681,4785]},{"content":"This works well when there are a few domain controllers.","pos":[4786,4842]},{"pos":[4845,4970],"content":"[!NOTE]\nIf your environment supports Virtual to Virtual on different hosts (RSPAN) you do not need to worry about affinity.","leadings":["","> "],"nodes":[{"content":"If your environment supports Virtual to Virtual on different hosts (RSPAN) you do not need to worry about affinity.","pos":[8,123]}]},{"content":"To make sure the ATA Gateways are properly sized to handle monitoring all of the DCs by themselves, try this option: Install a virtual machine on each virtualization host and install an ATA Gateway on each host.","pos":[4978,5189]},{"content":"Configure each ATA Gateway to monitor all of the domain controllers  that run on the cluster.","pos":[5190,5283]},{"content":"This way, any host the domain controllers run on will be monitored.","pos":[5284,5351]},{"content":"After configuring port mirroring, validate that port mirroring is working before installing the ATA Gateway.","pos":[5353,5461]},{"pos":[5466,5474],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]},{"content":"Validate port mirroring","pos":[5478,5501]},{"content":"Install ATA","pos":[5534,5545]},{"content":"Check out the ATA forum!","pos":[5566,5590]}],"content":"---\n# required metadata\n\ntitle: Configure Port Mirroring | Microsoft ATA\ndescription: Describes port mirroring options and how to configure them for ATA\nkeywords:\nauthor: rkarlin\nmanager: mbaldwin\nms.date: 08/28/2016\nms.topic: get-started-article\nms.prod:\nms.service: advanced-threat-analytics\nms.technology:\nms.assetid: cdaddca3-e26e-4137-b553-8ed3f389c460\n\n# optional metadata\n\n#ROBOTS:\n#audience:\n#ms.devlang:\nms.reviewer: bennyl\nms.suite: ems\n#ms.tgt_pltfrm:\n#ms.custom:\n\n---\n\n*Applies to: Advanced Threat Analytics version 1.7*\n\n\n\n# Configure Port Mirroring\n> [!NOTE] \n> This article is relevant only if you deploy ATA Gateways instead of ATA Lightweight Gateways. To determine if you need to use ATA Gateways, see [Choosing the right gateways for your deployment](/advanced-threat-analytics/plan-design/ata-capacity-planning#choosing-the-right-gateway-type-for-your-deployment).\n \nThe main data source used by ATA is deep packet inspection of the network traffic to and from your domain controllers. For ATA to see the network traffic, you must either configure port mirroring, or use a Network TAP.\n\nFor port mirroring, configure **port mirroring** for each domain controller to be monitored, as the **source** of the network traffic. Typically, you will need to work with the networking or virtualization team to configure port mirroring.\nFor more information, refer to your vendor's documentation.\n\nYour domain controllers and ATA Gateways can be either physical or virtual. The following are common methods for port mirroring and some considerations. Refer to your switch or virtualization server product documentation for additional information. Your switch manufacturer might use different terminology.\n\n**Switched Port Analyzer (SPAN)** – Copies network traffic from one or more switch ports to another switch port on the same switch. Both the ATA Gateway and domain controllers must be connected to the same physical switch.\n\n**Remote Switch Port Analyzer (RSPAN)**  – Allows you to monitor network traffic from source ports distributed over multiple physical switches. RSPAN copies the source traffic into a special RSPAN configured VLAN. This VLAN needs to be trunked to the other switches involved. RSPAN works at Layer 2.\n\n**Encapsulated Remote Switch Port Analyzer (ERSPAN)** – Is a Cisco proprietary technology working at Layer 3. ERSPAN allows you to monitor traffic across switches without the need for VLAN trunks. ERSPAN uses generic routing encapsulation (GRE) to copy monitored network traffic. ATA currently cannot directly receive ERSPAN traffic. For ATA to work with ERSPAN traffic, a switch or router that can decapsulate the traffic needs to be configured as the destination of ERSPAN where the traffic will be decapsulated. The switch or router will then need to be configured to forward it to the ATA Gateway using either SPAN or RSPAN.\n\n> [!NOTE]\n> If the domain controller being port mirrored is connected over a WAN link, make sure the WAN link can handle the additional load of the ERSPAN traffic.\n\n## Supported port mirroring options\n\n|ATA Gateway|Domain Controller|Considerations|\n|---------------|---------------------|------------------|\n|Virtual|Virtual on same host|The virtual switch needs to support port mirroring.<br /><br />Moving one of the virtual machines to another host by itself may break the port mirroring.|\n|Virtual|Virtual on different hosts|Make sure your virtual switch supports this scenario.|\n|Virtual|Physical|Requires a dedicated network adapter otherwise ATA will see all of the traffic coming in and out of the host, even the traffic it sends to the ATA Center.|\n|Physical|Virtual|Make sure your virtual switch supports this scenario - and port mirroring configuration on your physical switches based on the scenario:<br /><br />If the virtual host is on the same physical switch, you will need to configure a switch level span.<br /><br />If the virtual host is on a different switch, you will need to configure RSPAN or ERSPAN&#42;.|\n|Physical|Physical on the same switch|Physical switch must support SPAN/Port Mirroring.|\n|Physical|Physical on a different switch|Requires physical switches to support RSPAN or ERSPAN&#42;.|\n&#42; ERSPAN is only supported when decapsulation is performed before the traffic is analyzed by ATA.\n\n> [!NOTE]\n> Make sure that domain controllers and the ATA Gateways to which they connect have time synchronized to within 5 minutes of each other.\n\n**If you are working with virtualization clusters:**\n\n-   For each domain controller running on the virtualization cluster in a virtual machine with the ATA Gateway,  configure affinity between the domain controller and the ATA Gateway. This way when the domain controller moves to another host in the cluster the ATA Gateway will follow it. This works well when there are a few domain controllers.\n> [!NOTE]\n> If your environment supports Virtual to Virtual on different hosts (RSPAN) you do not need to worry about affinity.\n> \n-   To make sure the ATA Gateways are properly sized to handle monitoring all of the DCs by themselves, try this option: Install a virtual machine on each virtualization host and install an ATA Gateway on each host. Configure each ATA Gateway to monitor all of the domain controllers  that run on the cluster. This way, any host the domain controllers run on will be monitored.\n\nAfter configuring port mirroring, validate that port mirroring is working before installing the ATA Gateway.\n\n## See Also\n- [Validate port mirroring](validate-port-mirroring.md)\n- [Install ATA](install-ata.md)\n- [Check out the ATA forum!](https://social.technet.microsoft.com/Forums/security/home?forum=mata)\n"}