{"nodes":[{"pos":[32,90],"content":"Troubleshooting ATA using the ATA database | Microsoft ATA","needQuote":true,"nodes":[{"content":"Troubleshooting ATA using the ATA database | Microsoft ATA","pos":[0,58]}]},{"pos":[104,174],"content":"Describes how you can use the ATA database to help troubleshoot issues","needQuote":true,"nodes":[{"content":"Describes how you can use the ATA database to help troubleshoot issues","pos":[0,70]}]},{"content":"Applies to: Advanced Threat Analytics version 1.7","pos":[493,542]},{"pos":[549,591],"content":"Troubleshooting ATA using the ATA database","linkify":"Troubleshooting ATA using the ATA database","nodes":[{"content":"Troubleshooting ATA using the ATA database","pos":[0,42]}]},{"content":"ATA uses MongoDB as its database.","pos":[592,625]},{"content":"You can interact with the database using the default command line or using a user interface tool to perform advanced tasks and troubleshooting.","pos":[626,769],"source":"\nYou can interact with the database using the default command line or using a user interface tool to perform advanced tasks and troubleshooting."},{"pos":[774,803],"content":"Interacting with the database","linkify":"Interacting with the database","nodes":[{"content":"Interacting with the database","pos":[0,29]}]},{"content":"The default and most basic way to query the database is using the Mongo shell:","pos":[804,882]},{"content":"Open a command line window and change the path to the MongoDB bin folder.","pos":[888,961]},{"content":"The default path is: <bpt id=\"p1\">**</bpt>C:\\Program Files\\Microsoft Advanced Threat Analytics\\Center\\MongoDB\\bin<ept id=\"p1\">**</ept>.","pos":[962,1059],"source":" The default path is: **C:\\Program Files\\Microsoft Advanced Threat Analytics\\Center\\MongoDB\\bin**."},{"content":"Run: <ph id=\"ph1\">`mongo.exe ATA`</ph>.","pos":[1065,1086],"source":"Run: `mongo.exe ATA`."},{"content":"Make sure to type ATA with all capital letters.","pos":[1087,1134]},{"content":"How to...","pos":[1137,1146]},{"content":"Syntax","pos":[1147,1153]},{"content":"Notes","pos":[1154,1159]},{"content":"Check for collections in the database.","pos":[1199,1237]},{"content":"Useful as an end-to-end test to see that traffic is being written to the database and that event 4776 is being received by ATA.","pos":[1257,1384]},{"content":"Get the details of a user/computer/group (UniqueEntity), such as user ID.","pos":[1387,1460]},{"content":"Find Kerberos authentication traffic originating from a specific computer on a specific day.","pos":[1536,1628]},{"content":"To get the <ph id=\"ph1\">&amp;lt;</ph>ID of the source computer<ph id=\"ph2\">&amp;gt;</ph> you can query the UniqueEntity collections, as shown in the example.","pos":[1712,1825],"source":"To get the &lt;ID of the source computer&gt; you can query the UniqueEntity collections, as shown in the example."},{"content":"Each network activity type, for example Kerberos authentications, has its own collection per UTC date.","pos":[1837,1939]},{"content":"Find NTLM traffic originating from a specific computer related to a specific account on a specific day.","pos":[1942,2045]},{"content":"To get the <ph id=\"ph1\">&amp;lt;</ph>ID of the source computer<ph id=\"ph2\">&amp;gt;</ph> and <ph id=\"ph3\">&amp;lt;</ph>ID of the account<ph id=\"ph4\">&amp;gt;</ph> you can query the UniqueEntity collections, as shown in the example.","pos":[2163,2306],"source":"To get the &lt;ID of the source computer&gt; and &lt;ID of the account&gt; you can query the UniqueEntity collections, as shown in the example."},{"content":"Each network activity type, for example NTLM authentications, has its own collection per UTC date.","pos":[2318,2416]},{"content":"Search for advanced properties such as the active dates of an account.","pos":[2419,2489]},{"content":"To get the <ph id=\"ph1\">&amp;lt;</ph>ID of the account<ph id=\"ph2\">&amp;gt;</ph> you can query the UniqueEntity collections, as shown in the example.","pos":[2561,2666],"source":"To get the &lt;ID of the account&gt; you can query the UniqueEntity collections, as shown in the example."},{"content":"The property name that shows the dates in which the account has been active is called: \"ActiveDates\".","pos":[2670,2771]},{"content":"For example you may want to know if an account has at least 21 days of activity for the abnormal behavior machine learning algorithm to be able to run on it.","pos":[2777,2934]},{"content":"Make advanced configuration changes.","pos":[2937,2973]},{"content":"In this example we change the send queue size for all ATA Gateways to 10,000.","pos":[2974,3051]},{"content":"The following example provides sample code using the syntax provided above.","pos":[3205,3280]},{"content":"If you are investigating a suspicious activity that occurred on 20/10/2015 and want to learn more about the NTLM activities that \"John Doe\" performed on that day:","pos":[3281,3443]},{"content":"First, find the ID of \"John Doe\"","pos":[3455,3487]},{"content":"Take a note of his ID as indicated by the value of \"<ph id=\"ph1\">`_id`</ph>\" For our example, let's assume the ID is \"<ph id=\"ph2\">`123bdd24-b269-h6e1-9c72-7737as875351`</ph>\"","pos":[3535,3674],"source":"Take a note of his ID as indicated by the value of \"`_id`\" For our example, let's assume the ID is \"`123bdd24-b269-h6e1-9c72-7737as875351`\""},{"content":"Then, search for the collection with the closest date that is before the date you are looking for, in our example 20/10/2015.","pos":[3678,3803]},{"content":"Then, search for John Doe's account NTLM activities:","pos":[3807,3859]},{"pos":[3956,3964],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]},{"content":"ATA prerequisites","pos":[3968,3985]},{"content":"ATA capacity planning","pos":[4048,4069]},{"content":"Configure event collection","pos":[4136,4162]},{"content":"Configuring Windows event forwarding","pos":[4233,4269]},{"content":"Check out the ATA forum!","pos":[4377,4401]}],"content":"---\n# required metadata\n\ntitle: Troubleshooting ATA using the ATA database | Microsoft ATA\ndescription: Describes how you can use the ATA database to help troubleshoot issues \nkeywords:\nauthor: rkarlin\nmanager: mbaldwin\nms.date: 08/24/2016\nms.topic: article\nms.prod:\nms.service: advanced-threat-analytics\nms.technology:\nms.assetid: d89e7aff-a6ef-48a3-ae87-6ac2e39f3bdb\n\n# optional metadata\n\n#ROBOTS:\n#audience:\n#ms.devlang:\nms.reviewer: bennyl\nms.suite: ems\n#ms.tgt_pltfrm:\n#ms.custom:\n\n---\n\n*Applies to: Advanced Threat Analytics version 1.7*\n\n\n\n# Troubleshooting ATA using the ATA database\nATA uses MongoDB as its database.\nYou can interact with the database using the default command line or using a user interface tool to perform advanced tasks and troubleshooting.\n\n## Interacting with the database\nThe default and most basic way to query the database is using the Mongo shell:\n\n1.  Open a command line window and change the path to the MongoDB bin folder. The default path is: **C:\\Program Files\\Microsoft Advanced Threat Analytics\\Center\\MongoDB\\bin**.\n\n2.  Run: `mongo.exe ATA`. Make sure to type ATA with all capital letters.\n\n|How to...|Syntax|Notes|\n|-------------|----------|---------|\n|Check for collections in the database.|`show collections`|Useful as an end-to-end test to see that traffic is being written to the database and that event 4776 is being received by ATA.|\n|Get the details of a user/computer/group (UniqueEntity), such as user ID.|`db.UniqueEntity.find({SearchNames: \"<name of entity in lower case>\"})`||\n|Find Kerberos authentication traffic originating from a specific computer on a specific day.|`db.KerberosAs_<datetime>.find({SourceComputerId: \"<Id of the source computer>\"})`|To get the &lt;ID of the source computer&gt; you can query the UniqueEntity collections, as shown in the example.<br /><br />Each network activity type, for example Kerberos authentications, has its own collection per UTC date.|\n|Find NTLM traffic originating from a specific computer related to a specific account on a specific day.|`db.Ntlm_<datetime>.find({SourceComputerId: \"<Id of the source computer>\", SourceAccountId: \"<Id of the account>\"})`|To get the &lt;ID of the source computer&gt; and &lt;ID of the account&gt; you can query the UniqueEntity collections, as shown in the example.<br /><br />Each network activity type, for example NTLM authentications, has its own collection per UTC date.|\n|Search for advanced properties such as the active dates of an account. |`db.UniqueEntityProfile.find({UniqueEntityId: \"<Id of the account>\")`|To get the &lt;ID of the account&gt; you can query the UniqueEntity collections, as shown in the example.<br>The property name that shows the dates in which the account has been active is called: \"ActiveDates\". <br>\nFor example you may want to know if an account has at least 21 days of activity for the abnormal behavior machine learning algorithm to be able to run on it.|\n|Make advanced configuration changes. In this example we change the send queue size for all ATA Gateways to 10,000.|`db.SystemProfile.update( {_t: \"GatewaySystemProfile\"} ,`<br>`{$set:{\"Configuration.EntitySenderConfiguration.EntityBatchBlockMaxSize\" : \"10000\"}})`|`|\n\nThe following example provides sample code using the syntax provided above. If you are investigating a suspicious activity that occurred on 20/10/2015 and want to learn more about the NTLM activities that \"John Doe\" performed on that day:<br /><br />First, find the ID of \"John Doe\"\n\n`db.UniqueEntity.find({Name: \"John Doe\"})`<br>Take a note of his ID as indicated by the value of \"`_id`\" For our example, let's assume the ID is \"`123bdd24-b269-h6e1-9c72-7737as875351`\"<br>Then, search for the collection with the closest date that is before the date you are looking for, in our example 20/10/2015.<br>Then, search for John Doe's account NTLM activities: \n\n`db.Ntlms_<closest date>.find({SourceAccountId: \"123bdd24-b269-h6e1-9c72-7737as875351\"})`\n\n## See Also\n- [ATA prerequisites](/advanced-threat-analytics/plan-design/ata-prerequisites)\n- [ATA capacity planning](/advanced-threat-analytics/plan-design/ata-capacity-planning)\n- [Configure event collection](/advanced-threat-analytics/deploy-use/configure-event-collection)\n- [Configuring Windows event forwarding](/advanced-threat-analytics/deploy-use/configure-event-collection#configuring-windows-event-forwarding)\n- [Check out the ATA forum!](https://social.technet.microsoft.com/Forums/security/home?forum=mata)\n"}