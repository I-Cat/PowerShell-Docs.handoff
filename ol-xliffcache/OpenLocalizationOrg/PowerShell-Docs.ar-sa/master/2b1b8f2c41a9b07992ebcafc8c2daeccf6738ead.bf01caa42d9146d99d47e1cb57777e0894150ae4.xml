{"nodes":[{"pos":[32,77],"content":"What's new in ATA version 1.7 | Microsoft ATA","needQuote":true,"nodes":[{"content":"What's new in ATA version 1.7 | Microsoft ATA","pos":[0,45]}]},{"pos":[91,152],"content":"Lists what was new in ATA version 1.7 along with known issues","needQuote":true,"nodes":[{"content":"Lists what was new in ATA version 1.7 along with known issues","pos":[0,61]}]},{"pos":[429,458],"content":"What's new in ATA version 1.7","linkify":"What's new in ATA version 1.7","nodes":[{"content":"What's new in ATA version 1.7","pos":[0,29]}]},{"content":"These release notes provide information about known issues in this version of Advanced Threat Analytics.","pos":[459,563]},{"pos":[568,601],"content":"What's new in the ATA 1.7 update?","linkify":"What's new in the ATA 1.7 update?","nodes":[{"content":"What's new in the ATA 1.7 update?","pos":[0,33]}]},{"content":"The update to ATA 1.7 provides improvements in the following areas:","pos":[602,669]},{"content":"New &amp; updated detections","pos":[675,699],"source":"New & updated detections"},{"content":"Role-based access control","pos":[705,730]},{"content":"Support for Windows Server 2016 and Windows Server Core","pos":[736,791]},{"content":"User experience improvements","pos":[797,825]},{"pos":[832,856],"content":"New & updated detections","linkify":"New & updated detections","nodes":[{"content":"New &amp; updated detections","pos":[0,24],"source":"New & updated detections"}]},{"content":"<bpt id=\"p1\">**</bpt>Reconnaissance using Directory Services Enumeration<ept id=\"p1\">**</ept> As part of the reconnaissance phase, attackers gather information about the entities in the network using different methods.","pos":[861,1041],"source":"**Reconnaissance using Directory Services Enumeration**\nAs part of the reconnaissance phase, attackers gather information about the entities in the network using different methods."},{"content":"Directory services enumeration using the SAM-R protocol enables attackers to obtain the list of users and groups in a domain and understand the interaction between the different entities.","pos":[1042,1229]},{"content":"<bpt id=\"p1\">**</bpt>Pass-the-Hash Enhancements<ept id=\"p1\">**</ept> To enhance Pass-the-Hash detection, we added additional behavioral models for the authentication patterns of entities.","pos":[1234,1383],"source":"**Pass-the-Hash Enhancements**\nTo enhance Pass-the-Hash detection, we added additional behavioral models for the authentication patterns of entities."},{"content":"These models enable ATA to correlate entity behavior with suspicious NTLM authentications, and differentiate real Pass-the-Hash attacks from the behavior of false positive scenarios.","pos":[1384,1566]},{"content":"<bpt id=\"p1\">**</bpt>Pass-the-Ticket Enhancements<ept id=\"p1\">**</ept> To successfully detect advanced attacks in general and Pass-the-Ticket in particular, the correlation between an IP address and the computer account must be accurate.","pos":[1570,1769],"source":"**Pass-the-Ticket Enhancements**\nTo successfully detect advanced attacks in general and Pass-the-Ticket in particular, the correlation between an IP address and the computer account must be accurate."},{"content":"This is a challenge in environments where IP addresses change rapidly by design (for example Wi-Fi networks and multiple virtual machines sharing the same host).","pos":[1770,1931]},{"content":"To overcome this challenge and improve the accuracy of the Pass-the-Ticket detection, ATA’s Network Name Resolution (NNR) mechanism was improved significantly to reduce false-positives.","pos":[1932,2117]},{"pos":[2121,2339],"content":"<bpt id=\"p1\">**</bpt>Abnormal Behavior Enhancements<ept id=\"p1\">**</ept> In ATA 1.7, NTLM authentication data was added as a data source for the abnormal behavior detections, providing the algorithms with broader coverage of entity behavior in the network.","source":"**Abnormal Behavior Enhancements**\nIn ATA 1.7, NTLM authentication data was added as a data source for the abnormal behavior detections, providing the algorithms with broader coverage of entity behavior in the network."},{"content":"<bpt id=\"p1\">**</bpt>Unusual Protocol Implementation Enhancements<ept id=\"p1\">**</ept> ATA now detects unusual protocol implementation in the Kerberos protocol, along with additional anomalies in the NTLM protocol.","pos":[2344,2520],"source":"**Unusual Protocol Implementation Enhancements**\nATA now detects unusual protocol implementation in the Kerberos protocol, along with additional anomalies in the NTLM protocol."},{"content":"Specifically, these new anomalies for Kerberos are commonly used in Over-pass-the-Hash attacks.","pos":[2521,2616]},{"pos":[2623,2637],"content":"Infrastructure","linkify":"Infrastructure","nodes":[{"content":"Infrastructure","pos":[0,14]}]},{"content":"<bpt id=\"p1\">**</bpt>Role based access control<ept id=\"p1\">**</ept> Role-Based Access Control (RBAC) capability.","pos":[2641,2715],"source":"**Role based access control**\nRole-Based Access Control (RBAC) capability."},{"content":"ATA 1.7 includes three roles: ATA Administrator, ATA Analyst and ATA Executive.","pos":[2716,2795]},{"content":"<bpt id=\"p1\">**</bpt>Support for Windows Server 2016 and Windows Server Core<ept id=\"p1\">**</ept> ATA 1.7 supports the deployment of Lightweight Gateways on domain controllers running Server Core for Windows Server 2012 and Server Core for Windows Server 2012 R2.","pos":[2799,3024],"source":"**Support for Windows Server 2016 and Windows Server Core**\nATA 1.7 supports the deployment of Lightweight Gateways on domain controllers running Server Core for Windows Server 2012 and Server Core for Windows Server 2012 R2."},{"content":"Additionally, this release supports Windows Server 2016 both for the ATA Center and ATA Gateway components.","pos":[3025,3132]},{"pos":[3138,3153],"content":"User Experience","linkify":"User Experience","nodes":[{"content":"User Experience","pos":[0,15]}]},{"content":"<bpt id=\"p1\">**</bpt>Configuration Experience<ept id=\"p1\">**</ept> In this release, the ATA configuration experience was redesigned for a better user experience and to better support of environments with multiple ATA Gateways.","pos":[3156,3344],"source":"**Configuration Experience**\nIn this release, the ATA configuration experience was redesigned for a better user experience and to better support of environments with multiple ATA Gateways."},{"content":"This release also introduces the ATA Gateway update page for simpler, better management of automatic updates for the various Gateways.","pos":[3345,3479]},{"pos":[3484,3496],"content":"Known issues","linkify":"Known issues","nodes":[{"content":"Known issues","pos":[0,12]}]},{"content":"The following known issues exist in this version.","pos":[3497,3546]},{"pos":[3552,3585],"content":"Gateway automatic update may fail","linkify":"Gateway automatic update may fail","nodes":[{"content":"Gateway automatic update may fail","pos":[0,33]}]},{"content":"<bpt id=\"p1\">**</bpt>Symptoms:<ept id=\"p1\">**</ept> In environments with slow WAN links, the ATA Gateway update may reach the timeout for the update (100 seconds) and fail to complete successfully.","pos":[3586,3745],"source":"**Symptoms:** In environments with slow WAN links, the ATA Gateway update may reach the timeout for the update (100 seconds) and fail to complete successfully."},{"content":"In the ATA Console, the ATA Gateway will have the status of \"Updating (downloading package)\" for a long amount of time and it eventually fails.","pos":[3746,3889],"source":"\nIn the ATA Console, the ATA Gateway will have the status of \"Updating (downloading package)\" for a long amount of time and it eventually fails."},{"pos":[3891,4032],"content":"<bpt id=\"p1\">**</bpt>Workaround:<ept id=\"p1\">**</ept> To work around this issue, download the latest ATA Gateway package from the ATA Console, and update the ATA Gateway manually.","source":"**Workaround:** To work around this issue, download the latest ATA Gateway package from the ATA Console, and update the ATA Gateway manually."},{"pos":[4038,4082],"content":"Migration failure when updating from ATA 1.6","linkify":"Migration failure when updating from ATA 1.6","nodes":[{"content":"Migration failure when updating from ATA 1.6","pos":[0,44]}]},{"pos":[4083,4180],"content":"When updating to ATA 1.7, the update process may fail with the following error code <bpt id=\"p1\">*</bpt>0x80070643<ept id=\"p1\">*</ept>:","source":"When updating to ATA 1.7, the update process may fail with the following error code *0x80070643*:"},{"content":"Update ATA to 1.7 error","pos":[4184,4207]},{"content":"Review the deployment log to find the cause of the failure.","pos":[4238,4297]},{"content":"The deployment log is located in the following location, <bpt id=\"p1\">**</bpt>%temp%<ph id=\"ph1\">\\.</ph>.\\Microsoft Advanced Thread Analytics Center_{date_stamp}_MsiPackage.log<ept id=\"p1\">**</ept>.","pos":[4298,4440],"source":" The deployment log is located in the following location, **%temp%\\..\\Microsoft Advanced Thread Analytics Center_{date_stamp}_MsiPackage.log**."},{"content":"In the table below lists the errors to look for and the corresponding Mongo script to fix the error.","pos":[4443,4543]},{"content":"See example below the table on how to run the Mongo script:","pos":[4544,4603]},{"content":"Error in deployment log file","pos":[4607,4635]},{"content":"Mongo script","pos":[4751,4763]},{"content":"System.FormatException: Size {size},is larger than MaxDocumentSize 16777216","pos":[4946,5021]},{"content":"Further down in the file:","pos":[5026,5051]},{"content":"Microsoft.Tri.Center.Deployment.Package.Actions.DatabaseActions.MigrateUniqueEntityProfiles(Boolean isPartial)","pos":[5057,5167]},{"content":"db.UniqueEntityProfile.find().forEach(function(obj){if(Object.bsonsize(obj) &gt; 12582912) {print(obj._id);print(Object.bsonsize(obj));db.UniqueEntityProfile.remove({_id:obj._id});}})","pos":[5257,5437],"source":"db.UniqueEntityProfile.find().forEach(function(obj){if(Object.bsonsize(obj) > 12582912) {print(obj._id);print(Object.bsonsize(obj));db.UniqueEntityProfile.remove({_id:obj._id});}})"},{"content":"System.OutOfMemoryException: Exception of type 'System.OutOfMemoryException' was thrown","pos":[5442,5529]},{"content":"Further down in the file:","pos":[5533,5558]},{"content":"Microsoft.Tri.Center.Deployment.Package.Actions.DatabaseActions.ReduceSuspiciousActivityDetailsRecords(IMongoCollection`1 suspiciousActivityCollection, Int32 deletedDetailRecordMaxCount)","pos":[5562,5748]},{"content":"db.SuspiciousActivity.find().forEach(function(obj){if(Object.bsonsize(obj) &gt; 500000),{print(obj._id);print(Object.bsonsize(obj));db.SuspiciousActivity.remove({_id:obj._id});}})","pos":[5751,5927],"source":"db.SuspiciousActivity.find().forEach(function(obj){if(Object.bsonsize(obj) > 500000),{print(obj._id);print(Object.bsonsize(obj));db.SuspiciousActivity.remove({_id:obj._id});}})"},{"content":"System.Security.Cryptography.CryptographicException: Bad Length","pos":[5935,5998]},{"content":"Further down in the file:","pos":[6002,6027]},{"content":"Microsoft.Tri.Center.Deployment.Package.Actions.DatabaseActions.MigrateCenterSystemProfile(IMongoCollection`1 systemProfileCollection)","pos":[6032,6166]},{"content":"CenterThumbprint=db.SystemProfile.find({_t:\"CenterSystemProfile\"}).toArray()[0].Configuration.SecretManagerConfiguration.CertificateThumbprint;db.SystemProfile.update({_t:\"CenterSystemProfile\"},{$set:{\"Configuration.ManagementClientConfiguration.ServerCertificateThumbprint\":CenterThumbprint}})","pos":[6168,6462]},{"content":"To run the appropriate script, follow the following steps.","pos":[6466,6524]},{"pos":[6531,6673],"content":"From an elevated command prompt, browse to the following location: <bpt id=\"p1\">**</bpt>C:\\Program Files\\Microsoft Advanced Threat Analytics\\Center\\MongoDB\\bin<ept id=\"p1\">**</ept>","source":"From an elevated command prompt, browse to the following location: **C:\\Program Files\\Microsoft Advanced Threat Analytics\\Center\\MongoDB\\bin**"},{"pos":[6678,6739],"content":"Type – <bpt id=\"p1\">**</bpt>Mongo.exe ATA<ept id=\"p1\">**</ept>   (<bpt id=\"p2\">*</bpt>Note<ept id=\"p2\">*</ept>: ATA must be capitalized.)","source":"Type – **Mongo.exe ATA**   (*Note*: ATA must be capitalized.)"},{"content":"Paste the script that matches the error in the deployment log from the table above.","pos":[6744,6827]},{"content":"ATA Mongo Script","pos":[6831,6847]},{"content":"At this point you should be able to restart the upgrade.","pos":[6880,6936]},{"pos":[6942,7051],"content":"ATA reports a large number of “<bpt id=\"p1\">*</bpt>Reconnaissance using directory services enumerations<ept id=\"p1\">*</ept>” suspicious activities:","linkify":"ATA reports a large number of “*Reconnaissance using directory services enumerations*” suspicious activities:","source":"ATA reports a large number of “*Reconnaissance using directory services enumerations*” suspicious activities:"},{"content":"This is most likely happening if there is a network scanning tool running on all (or a lot) of client machines in the organization.","pos":[7054,7185],"source":"This is most likely happening if there is a network scanning tool running on all (or a lot) of client machines in the\norganization."},{"content":"If you are seeing this problem:","pos":[7186,7217]},{"content":"In case you can identify the reason or the specific application that running on the client machines, send an email to ATAEval at Microsoft.com with the information.","pos":[7222,7386]},{"content":"Use the following mongo script to dismiss all these events (see above how to execute the mongo script):","pos":[7390,7493]},{"content":"db.SuspiciousActivity.update({_t: \"SamrReconnaissanceSuspiciousActivity\"}, {$set: {Status: \"Dismissed\"}}, {multi: true})","pos":[7495,7615]},{"pos":[7621,7681],"content":"ATA sends notifications for dismissed suspicious activities:","linkify":"ATA sends notifications for dismissed suspicious activities:","nodes":[{"content":"ATA sends notifications for dismissed suspicious activities:","pos":[0,60]}]},{"content":"If notifications have been configured, ATA may keep sending notifications (email, syslog and event logs) for dismissed suspicious activities.","pos":[7682,7823]},{"content":"There is no workaround for this issue now.","pos":[7824,7866],"source":"\nThere is no workaround for this issue now."},{"pos":[7873,7962],"content":"ATA Gateway may fail to register with the ATA Center if TLS 1.0 and TLS 1.1 are disbaled:","linkify":"ATA Gateway may fail to register with the ATA Center if TLS 1.0 and TLS 1.1 are disbaled:","nodes":[{"content":"ATA Gateway may fail to register with the ATA Center if TLS 1.0 and TLS 1.1 are disbaled:","pos":[0,89]}]},{"content":"If TLS 1.0 and TLS 1.1 disabled on the ATA Gateway (or Lightweight Gateway), the gateway may fail to register itself on the ATA Center","pos":[7963,8097]},{"pos":[8103,8182],"content":"Automatic certificate renewal for the certificates used by ATA is not supported","linkify":"Automatic certificate renewal for the certificates used by ATA is not supported","nodes":[{"content":"Automatic certificate renewal for the certificates used by ATA is not supported","pos":[0,79]}]},{"content":"The use of automatic certificate renewal may cause ATA to stop functioning when the certificate is automatically renewed.","pos":[8183,8304]},{"pos":[8311,8319],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]},{"content":"Check out the ATA forum!","pos":[8321,8345]},{"content":"Update ATA to version 1.7 - migration guide","pos":[8419,8462]}],"content":"---\n# required metadata\n\ntitle: What's new in ATA version 1.7 | Microsoft ATA\ndescription: Lists what was new in ATA version 1.7 along with known issues\nkeywords:\nauthor: rkarlin\nmanager: mbaldwin\nms.date: 08/28/2016\nms.topic: article\nms.prod:\nms.service: advanced-threat-analytics\nms.technology:\nms.assetid: \n\n# optional metadata\n\n#ROBOTS:\n#audience:\n#ms.devlang:\nms.reviewer: \nms.suite: ems\n#ms.tgt_pltfrm:\n#ms.custom:\n\n---\n\n# What's new in ATA version 1.7\nThese release notes provide information about known issues in this version of Advanced Threat Analytics.\n\n## What's new in the ATA 1.7 update?\nThe update to ATA 1.7 provides improvements in the following areas:\n\n-   New & updated detections\n\n-   Role-based access control\n\n-   Support for Windows Server 2016 and Windows Server Core\n\n-   User experience improvements\n\n\n### New & updated detections\n\n\n- **Reconnaissance using Directory Services Enumeration**\nAs part of the reconnaissance phase, attackers gather information about the entities in the network using different methods. Directory services enumeration using the SAM-R protocol enables attackers to obtain the list of users and groups in a domain and understand the interaction between the different entities. \n\n- **Pass-the-Hash Enhancements**\nTo enhance Pass-the-Hash detection, we added additional behavioral models for the authentication patterns of entities. These models enable ATA to correlate entity behavior with suspicious NTLM authentications, and differentiate real Pass-the-Hash attacks from the behavior of false positive scenarios.\n\n- **Pass-the-Ticket Enhancements**\nTo successfully detect advanced attacks in general and Pass-the-Ticket in particular, the correlation between an IP address and the computer account must be accurate. This is a challenge in environments where IP addresses change rapidly by design (for example Wi-Fi networks and multiple virtual machines sharing the same host). To overcome this challenge and improve the accuracy of the Pass-the-Ticket detection, ATA’s Network Name Resolution (NNR) mechanism was improved significantly to reduce false-positives.\n\n- **Abnormal Behavior Enhancements**\nIn ATA 1.7, NTLM authentication data was added as a data source for the abnormal behavior detections, providing the algorithms with broader coverage of entity behavior in the network. \n\n- **Unusual Protocol Implementation Enhancements**\nATA now detects unusual protocol implementation in the Kerberos protocol, along with additional anomalies in the NTLM protocol. Specifically, these new anomalies for Kerberos are commonly used in Over-pass-the-Hash attacks.\n\n\n### Infrastructure\n\n- **Role based access control**\nRole-Based Access Control (RBAC) capability. ATA 1.7 includes three roles: ATA Administrator, ATA Analyst and ATA Executive.\n\n- **Support for Windows Server 2016 and Windows Server Core**\nATA 1.7 supports the deployment of Lightweight Gateways on domain controllers running Server Core for Windows Server 2012 and Server Core for Windows Server 2012 R2. Additionally, this release supports Windows Server 2016 both for the ATA Center and ATA Gateway components.\n\n### User Experience\n- **Configuration Experience**\nIn this release, the ATA configuration experience was redesigned for a better user experience and to better support of environments with multiple ATA Gateways. This release also introduces the ATA Gateway update page for simpler, better management of automatic updates for the various Gateways.\n\n## Known issues\nThe following known issues exist in this version.\n\n### Gateway automatic update may fail\n**Symptoms:** In environments with slow WAN links, the ATA Gateway update may reach the timeout for the update (100 seconds) and fail to complete successfully.\nIn the ATA Console, the ATA Gateway will have the status of \"Updating (downloading package)\" for a long amount of time and it eventually fails.\n\n**Workaround:** To work around this issue, download the latest ATA Gateway package from the ATA Console, and update the ATA Gateway manually.\n\n### Migration failure when updating from ATA 1.6\nWhen updating to ATA 1.7, the update process may fail with the following error code *0x80070643*:\n\n![Update ATA to 1.7 error](media/ata-update-error.png)\n\nReview the deployment log to find the cause of the failure. The deployment log is located in the following location, **%temp%\\..\\Microsoft Advanced Thread Analytics Center_{date_stamp}_MsiPackage.log**. \n\nIn the table below lists the errors to look for and the corresponding Mongo script to fix the error. See example below the table on how to run the Mongo script:\n\n| Error in deployment log file                                                                                                                  | Mongo script                                                                                                                                                                         |\n|---|---|\n| System.FormatException: Size {size},is larger than MaxDocumentSize 16777216 <br>Further down in the file:<br>  Microsoft.Tri.Center.Deployment.Package.Actions.DatabaseActions.MigrateUniqueEntityProfiles(Boolean isPartial)                                                                                        | db.UniqueEntityProfile.find().forEach(function(obj){if(Object.bsonsize(obj) > 12582912) {print(obj._id);print(Object.bsonsize(obj));db.UniqueEntityProfile.remove({_id:obj._id});}}) |\n| System.OutOfMemoryException: Exception of type 'System.OutOfMemoryException' was thrown<br>Further down in the file:<br>Microsoft.Tri.Center.Deployment.Package.Actions.DatabaseActions.ReduceSuspiciousActivityDetailsRecords(IMongoCollection`1 suspiciousActivityCollection, Int32 deletedDetailRecordMaxCount) | db.SuspiciousActivity.find().forEach(function(obj){if(Object.bsonsize(obj) > 500000),{print(obj._id);print(Object.bsonsize(obj));db.SuspiciousActivity.remove({_id:obj._id});}})     |\n|System.Security.Cryptography.CryptographicException: Bad Length<br>Further down in the file:<br> Microsoft.Tri.Center.Deployment.Package.Actions.DatabaseActions.MigrateCenterSystemProfile(IMongoCollection`1 systemProfileCollection)| CenterThumbprint=db.SystemProfile.find({_t:\"CenterSystemProfile\"}).toArray()[0].Configuration.SecretManagerConfiguration.CertificateThumbprint;db.SystemProfile.update({_t:\"CenterSystemProfile\"},{$set:{\"Configuration.ManagementClientConfiguration.ServerCertificateThumbprint\":CenterThumbprint}})|\n\n\nTo run the appropriate script, follow the following steps. \n\n1.  From an elevated command prompt, browse to the following location: **C:\\Program Files\\Microsoft Advanced Threat Analytics\\Center\\MongoDB\\bin**\n2.  Type – **Mongo.exe ATA**   (*Note*: ATA must be capitalized.)\n3.  Paste the script that matches the error in the deployment log from the table above.\n\n![ATA Mongo Script](media/ATA-mongoDB-script.png)\n\nAt this point you should be able to restart the upgrade.\n\n### ATA reports a large number of “*Reconnaissance using directory services enumerations*” suspicious activities:\n \nThis is most likely happening if there is a network scanning tool running on all (or a lot) of client machines in the\norganization. If you are seeing this problem:\n\n1. In case you can identify the reason or the specific application that running on the client machines, send an email to ATAEval at Microsoft.com with the information.\n2. Use the following mongo script to dismiss all these events (see above how to execute the mongo script):\n\ndb.SuspiciousActivity.update({_t: \"SamrReconnaissanceSuspiciousActivity\"}, {$set: {Status: \"Dismissed\"}}, {multi: true})\n\n### ATA sends notifications for dismissed suspicious activities:\nIf notifications have been configured, ATA may keep sending notifications (email, syslog and event logs) for dismissed suspicious activities.\nThere is no workaround for this issue now. \n\n### ATA Gateway may fail to register with the ATA Center if TLS 1.0 and TLS 1.1 are disbaled:\nIf TLS 1.0 and TLS 1.1 disabled on the ATA Gateway (or Lightweight Gateway), the gateway may fail to register itself on the ATA Center\n\n### Automatic certificate renewal for the certificates used by ATA is not supported\nThe use of automatic certificate renewal may cause ATA to stop functioning when the certificate is automatically renewed. \n\n\n## See Also\n[Check out the ATA forum!](https://social.technet.microsoft.com/Forums/security/home?forum=mata)\n\n[Update ATA to version 1.7 - migration guide](ata-update-1.7-migration-guide.md)\n\n"}