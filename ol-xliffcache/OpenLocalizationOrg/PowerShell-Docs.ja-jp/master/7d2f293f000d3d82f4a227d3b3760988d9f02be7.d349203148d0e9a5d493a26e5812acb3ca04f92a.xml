{"nodes":[{"pos":[11,53],"content":"improvements to just enough administration","needQuote":true,"nodes":[{"content":"improvements to just enough administration","pos":[0,42]}]},{"content":"Constrained file copy to/from JEA endpoints","pos":[82,125]},{"content":"You can now remotely copy files to/from a JEA endpoint and rest assured that the connecting user can't copy just <bpt id=\"p1\">*</bpt>any<ept id=\"p1\">*</ept> file on your system.","pos":[127,266],"source":"You can now remotely copy files to/from a JEA endpoint and rest assured that the connecting user can't copy just *any* file on your system."},{"content":"This is possible by configuring your PSSC file to mount a user drive for connecting users.","pos":[267,357],"source":"\nThis is possible by configuring your PSSC file to mount a user drive for connecting users."},{"content":"The user drive is a new PSDrive that is unique to each connecting user and persists across sessions.","pos":[358,458],"source":"\nThe user drive is a new PSDrive that is unique to each connecting user and persists across sessions."},{"content":"When Copy-Item is used to copy files to or from a JEA session, it is constrained to only allow access to the user drive.","pos":[459,579],"source":"\nWhen Copy-Item is used to copy files to or from a JEA session, it is constrained to only allow access to the user drive."},{"content":"Attempts to copy files to any other PSDrive will fail.","pos":[580,634],"source":"\nAttempts to copy files to any other PSDrive will fail."},{"content":"To set up the user drive in your JEA session configuration file, use the following new fields:","pos":[636,730]},{"pos":[816,940],"content":"The folder backing the user drive will be created at <ph id=\"ph1\">`$env:LOCALAPPDATA\\Microsoft\\Windows\\PowerShell\\DriveRoots\\DOMAIN_USER`</ph>","source":"The folder backing the user drive will be created at `$env:LOCALAPPDATA\\Microsoft\\Windows\\PowerShell\\DriveRoots\\DOMAIN_USER`"},{"pos":[942,1107],"content":"To utilize the user drive and copy files to/from a JEA endpoint configured to expose the User drive, use the <ph id=\"ph1\">`-ToSession`</ph> and <ph id=\"ph2\">`-FromSession`</ph> parameters on Copy-Item.","source":"To utilize the user drive and copy files to/from a JEA endpoint configured to expose the User drive, use the `-ToSession` and `-FromSession` parameters on Copy-Item."},{"content":"You can then write custom functions to process the data stored in the user drive and make those available to users in your Role Capability file.","pos":[1622,1766]},{"content":"Support for Group Managed Service Accounts","pos":[1771,1813]},{"content":"In some cases, a task a user needs to perform in a JEA session may need to access resources beyond the local machine.","pos":[1815,1932]},{"content":"When a JEA session is configured to use a virtual account, any attempt to reach such resources will appear to come from the local machine's identity, not the virtual account or connected user.","pos":[1933,2125],"source":"\nWhen a JEA session is configured to use a virtual account, any attempt to reach such resources will appear to come from the local machine's identity, not the virtual account or connected user."},{"content":"In TP5, we have enabled support for running JEA under the context of a [Group Managed Service Account](https://technet.microsoft.com/en-us/library/jj128431(v=ws.11\\).aspx), making it much easier to access network resources by using a domain identity.","pos":[2126,2376],"source":"\nIn TP5, we have enabled support for running JEA under the context of a [Group Managed Service Account](https://technet.microsoft.com/en-us/library/jj128431(v=ws.11\\).aspx), making it much easier to access network resources by using a domain identity."},{"content":"To configure a JEA session to run under a gMSA account, use the following new key in your PSSC file:","pos":[2378,2478]},{"pos":[2891,3251],"content":"**Note:** Group Managed Service Accounts do not afford the isolation or limited scope of virtual accounts.\nEvery connecting user will share the same gMSA identity, which may have permissions across your entire enterprise.\nBe very careful when selecting to use a gMSA, and always prefer virtual accounts which are limited to the local machine when possible.","leadings":["","> ","> "],"nodes":[{"content":"<bpt id=\"p1\">**</bpt>Note:<ept id=\"p1\">**</ept> Group Managed Service Accounts do not afford the isolation or limited scope of virtual accounts.","pos":[0,106],"source":"**Note:** Group Managed Service Accounts do not afford the isolation or limited scope of virtual accounts."},{"content":"Every connecting user will share the same gMSA identity, which may have permissions across your entire enterprise.","pos":[107,221]},{"content":"Be very careful when selecting to use a gMSA, and always prefer virtual accounts which are limited to the local machine when possible.","pos":[222,356]}]},{"content":"Conditional access policies","pos":[3256,3283]},{"content":"JEA is great at limiting what someone can do when they've connected to a system to manage it, but what if you also want to limit <bpt id=\"p1\">*</bpt>when<ept id=\"p1\">*</ept> someone can use JEA?","pos":[3285,3441],"source":"JEA is great at limiting what someone can do when they've connected to a system to manage it, but what if you also want to limit *when* someone can use JEA?"},{"content":"We have added configuration options into the session configuration files (.pssc) to let you specify security groups to which a user must belong in order to establish a JEA session.","pos":[3442,3622],"source":"\nWe have added configuration options into the session configuration files (.pssc) to let you specify security groups to which a user must belong in order to establish a JEA session."},{"content":"This can be particularly helpful if you have a Just In Time (JIT) system in your environment, and want to make your users elevate their privileges before accessing a highly-privileged JEA endpoint.","pos":[3623,3820],"source":"\nThis can be particularly helpful if you have a Just In Time (JIT) system in your environment, and want to make your users elevate their privileges before accessing a highly-privileged JEA endpoint."},{"content":"The new <bpt id=\"p1\">*</bpt>RequiredGroups<ept id=\"p1\">*</ept> field in the PSSC file allows you to specify the logic to determine if a user can connect to JEA.","pos":[3822,3944],"source":"The new *RequiredGroups* field in the PSSC file allows you to specify the logic to determine if a user can connect to JEA."},{"content":"It consists of specifying a hashtable (optionally nested) that uses the 'And' and 'Or' keys to construct your rules.","pos":[3945,4061],"source":"\nIt consists of specifying a hashtable (optionally nested) that uses the 'And' and 'Or' keys to construct your rules."},{"content":"Here are some examples of how to leverage this field:","pos":[4062,4115],"source":"\nHere are some examples of how to leverage this field:"},{"content":"Fixed: Virtual accounts are now supported on Windows Server 2008 R2","pos":[4740,4807]},{"content":"In WMF 5.1, you are now able to use virtual accounts on Windows Server 2008 R2, enabling consistent configurations and feature parity across Windows Server 2008 R2 - 2016.","pos":[4808,4979]},{"content":"Virtual accounts remain unsupported when using JEA on Windows 7.","pos":[4980,5044],"source":"\nVirtual accounts remain unsupported when using JEA on Windows 7."}],"content":"---\ntitle: improvements to just enough administration\ncontributor: ryanpu\n---\n\n## Constrained file copy to/from JEA endpoints\n\nYou can now remotely copy files to/from a JEA endpoint and rest assured that the connecting user can't copy just *any* file on your system.\nThis is possible by configuring your PSSC file to mount a user drive for connecting users.\nThe user drive is a new PSDrive that is unique to each connecting user and persists across sessions.\nWhen Copy-Item is used to copy files to or from a JEA session, it is constrained to only allow access to the user drive.\nAttempts to copy files to any other PSDrive will fail.\n\nTo set up the user drive in your JEA session configuration file, use the following new fields:\n```powershell\nMountUserDrive = $true\nUserDriveMaximumSize = 10485760    # 10 MB\n```\n\nThe folder backing the user drive will be created at `$env:LOCALAPPDATA\\Microsoft\\Windows\\PowerShell\\DriveRoots\\DOMAIN_USER`\n\nTo utilize the user drive and copy files to/from a JEA endpoint configured to expose the User drive, use the `-ToSession` and `-FromSession` parameters on Copy-Item.\n```powershell\n# Connect to the JEA endpoint\n$jeasession = New-PSSession -ComputerName 'srv01' -ConfigurationName 'UserDemo'\n\n# Copy a file in the local folder to the remote machine.\n# Note: you cannot specify the file name or subfolder on the remote machine. You must exactly type \"User:\"\nCopy-Item -Path .\\SampleFile.txt -Destination User: -ToSession $jeasession\n\n# Copy the file back from the remote machine to your local machine\nCopy-Item -Path User:\\SampleFile.txt -Destination . -FromSession $jeasession\n```\n\nYou can then write custom functions to process the data stored in the user drive and make those available to users in your Role Capability file.\n\n## Support for Group Managed Service Accounts\n\nIn some cases, a task a user needs to perform in a JEA session may need to access resources beyond the local machine.\nWhen a JEA session is configured to use a virtual account, any attempt to reach such resources will appear to come from the local machine's identity, not the virtual account or connected user.\nIn TP5, we have enabled support for running JEA under the context of a [Group Managed Service Account](https://technet.microsoft.com/en-us/library/jj128431(v=ws.11\\).aspx), making it much easier to access network resources by using a domain identity.\n\nTo configure a JEA session to run under a gMSA account, use the following new key in your PSSC file:\n```powershell\n# Provide the name of your gMSA account here (don't include a trailing $)\n# The local machine must be privileged to use this gMSA in Active Directory\nGroupManagedServiceAccount = 'myGMSAforJEA'\n\n# You cannot configure a JEA endpoint to use both a gMSA and virtual account\n# You can leave the RunAsVirtualAccount field commented out or explicitly set it to false\nRunAsVirtualAccount = $false\n```\n\n> **Note:** Group Managed Service Accounts do not afford the isolation or limited scope of virtual accounts.\n> Every connecting user will share the same gMSA identity, which may have permissions across your entire enterprise.\n> Be very careful when selecting to use a gMSA, and always prefer virtual accounts which are limited to the local machine when possible.\n\n## Conditional access policies\n\nJEA is great at limiting what someone can do when they've connected to a system to manage it, but what if you also want to limit *when* someone can use JEA?\nWe have added configuration options into the session configuration files (.pssc) to let you specify security groups to which a user must belong in order to establish a JEA session.\nThis can be particularly helpful if you have a Just In Time (JIT) system in your environment, and want to make your users elevate their privileges before accessing a highly-privileged JEA endpoint.\n\nThe new *RequiredGroups* field in the PSSC file allows you to specify the logic to determine if a user can connect to JEA.\nIt consists of specifying a hashtable (optionally nested) that uses the 'And' and 'Or' keys to construct your rules.\nHere are some examples of how to leverage this field:\n```powershell\n# Example 1: Connecting users must belong to a security group called \"elevated-jea\"\nRequiredGroups = @{ And = 'elevated-jea' }\n\n# Example 2: Connecting users must have signed on with 2 factor authentication or a smart card\n# The 2 factor authentication group name is \"2FA-logon\" and the smart card group name is \"smartcard-logon\"\nRequiredGroups = @{ Or = '2FA-logon', 'smartcard-logon' }\n\n# Example 3: Connecting users must elevate into \"elevated-jea\" with their JIT system and have logged on with 2FA or a smart card\nRequiredGroups = @{ And = 'elevated-jea', @{ Or = '2FA-logon', 'smartcard-logon' }}\n```\n\n## Fixed: Virtual accounts are now supported on Windows Server 2008 R2\nIn WMF 5.1, you are now able to use virtual accounts on Windows Server 2008 R2, enabling consistent configurations and feature parity across Windows Server 2008 R2 - 2016.\nVirtual accounts remain unsupported when using JEA on Windows 7."}