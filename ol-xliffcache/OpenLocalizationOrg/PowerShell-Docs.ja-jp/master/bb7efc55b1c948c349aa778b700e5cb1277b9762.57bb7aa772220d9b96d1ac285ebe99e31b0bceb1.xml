{"nodes":[{"pos":[13,64],"content":"PowerShell Engine Improvements in WMF 5.1 (Preview)","needQuote":true,"nodes":[{"content":"PowerShell Engine Improvements in WMF 5.1 (Preview)","pos":[0,51]}]},{"pos":[97,117],"content":"PowerShell, DSC, WMF","needQuote":true,"nodes":[{"content":"PowerShell, DSC, WMF","pos":[0,20]}]},{"content":"PowerShell Engine Improvements","pos":[232,262]},{"content":"The following improvements to the core PowerShell engine have been implemented in WMF 5.1:","pos":[264,354]},{"content":"Performance","pos":[360,371]},{"content":"Performance has improved in some important areas:","pos":[376,425]},{"content":"Startup","pos":[429,436]},{"content":"Pipelining to cmdlets like ForEach-Object and Where-Object is approximately 50% faster","pos":[439,525]},{"content":"Some example improvements (your results may vary depending on your hardware):","pos":[528,605]},{"content":"Scenario","pos":[610,618]},{"content":"5.0 Time (ms)","pos":[621,634]},{"content":"5.1 Time (ms)","pos":[637,650]},{"content":"900","pos":[741,744]},{"content":"250","pos":[747,750]},{"pos":[755,821],"content":"First ever PowerShell run: <ph id=\"ph1\">`powershell -command \"Unknown-Command\"`</ph>","source":"First ever PowerShell run: `powershell -command \"Unknown-Command\"`"},{"content":"30000","pos":[824,829]},{"content":"13000","pos":[832,837]},{"pos":[842,911],"content":"Command analysis cache built: <ph id=\"ph1\">`powershell -command \"Unknown-Command\"`</ph>","source":"Command analysis cache built: `powershell -command \"Unknown-Command\"`"},{"content":"7000","pos":[914,918]},{"content":"520","pos":[921,924]},{"content":"1400","pos":[968,972]},{"content":"750","pos":[975,978]},{"pos":[986,1438],"content":"Note \nOne change related to startup might impact some unsupported scenarios. \nPowerShell no longer reads the files `$pshome\\*.ps1xml` -- these files have been converted to C# to avoid some file\nand CPU overhead of processing the XML files. \nThe files still exist to support V2 side-by-side, so if you change the file contents, it will not have any effect to V5, only V2. \nNote that changing the contents of these files was never a supported scenario.","leadings":["","> ","","","",""],"nodes":[{"content":"Note One change related to startup might impact some unsupported scenarios.","pos":[0,76],"source":"Note \nOne change related to startup might impact some unsupported scenarios."},{"content":"PowerShell no longer reads the files <ph id=\"ph1\">`$pshome\\*.ps1xml`</ph> -- these files have been converted to C# to avoid some file and CPU overhead of processing the XML files.","pos":[78,239],"source":"PowerShell no longer reads the files `$pshome\\*.ps1xml` -- these files have been converted to C# to avoid some file\nand CPU overhead of processing the XML files."},{"content":"The files still exist to support V2 side-by-side, so if you change the file contents, it will not have any effect to V5, only V2.","pos":[241,370]},{"content":"Note that changing the contents of these files was never a supported scenario.","pos":[372,450]}]},{"content":"Another visible change is how PowerShell caches the exported commands and other information for modules that are installed on a system.","pos":[1440,1575],"source":"Another visible change is how PowerShell caches the exported commands and other information for\nmodules that are installed on a system."},{"content":"Previously, this cache was stored in the directory <ph id=\"ph1\">`$env:LOCALAPPDATA\\Microsoft\\Windows\\PowerShell\\CommandAnalysis`</ph>.","pos":[1576,1693],"source":" \nPreviously, this cache was stored in the directory `$env:LOCALAPPDATA\\Microsoft\\Windows\\PowerShell\\CommandAnalysis`."},{"content":"In WMF 5.1, the cache is a single file <ph id=\"ph1\">`$env:LOCALAPPDATA\\Microsoft\\Windows\\PowerShell\\ModuleAnalysisCache`</ph>.","pos":[1694,1803],"source":" \nIn WMF 5.1, the cache is a single file `$env:LOCALAPPDATA\\Microsoft\\Windows\\PowerShell\\ModuleAnalysisCache`."},{"content":"See <bpt id=\"p1\">[</bpt>Module Analysis Cache<ept id=\"p1\">](scenarios-features.md#module-analysis-cache)</ept> for more details.","pos":[1804,1894],"source":"\nSee [Module Analysis Cache](scenarios-features.md#module-analysis-cache) for more details."}],"content":"---\ntitle:   PowerShell Engine Improvements in WMF 5.1 (Preview)\nms.date:  2016-07-13\nkeywords:  PowerShell, DSC, WMF\ndescription:  \nms.topic:  article\nauthor:  keithb\nmanager:  dongill\nms.prod:  powershell\nms.technology: WMF\n---\n\n#PowerShell Engine Improvements\n\nThe following improvements to the core PowerShell engine have been implemented in WMF 5.1:\n\n\n## Performance ##\n\nPerformance has improved in some important areas:\n\n- Startup\n- Pipelining to cmdlets like ForEach-Object and Where-Object is approximately 50% faster \n\nSome example improvements (your results may vary depending on your hardware): \n\n| Scenario | 5.0 Time (ms) | 5.1 Time (ms) |\n| -------- | :---------------: | :---------------: |\n| `powershell -command \"echo 1\"` | 900 | 250 |\n| First ever PowerShell run: `powershell -command \"Unknown-Command\"` | 30000 | 13000 |\n| Command analysis cache built: `powershell -command \"Unknown-Command\"` | 7000 | 520 |\n| <code>1..1000000 &#124; % { }</code> | 1400 | 750 |\n  \n> Note \n> One change related to startup might impact some unsupported scenarios. \nPowerShell no longer reads the files `$pshome\\*.ps1xml` -- these files have been converted to C# to avoid some file\nand CPU overhead of processing the XML files. \nThe files still exist to support V2 side-by-side, so if you change the file contents, it will not have any effect to V5, only V2. \nNote that changing the contents of these files was never a supported scenario.\n\nAnother visible change is how PowerShell caches the exported commands and other information for\nmodules that are installed on a system. \nPreviously, this cache was stored in the directory `$env:LOCALAPPDATA\\Microsoft\\Windows\\PowerShell\\CommandAnalysis`. \nIn WMF 5.1, the cache is a single file `$env:LOCALAPPDATA\\Microsoft\\Windows\\PowerShell\\ModuleAnalysisCache`.\nSee [Module Analysis Cache](scenarios-features.md#module-analysis-cache) for more details.\n"}