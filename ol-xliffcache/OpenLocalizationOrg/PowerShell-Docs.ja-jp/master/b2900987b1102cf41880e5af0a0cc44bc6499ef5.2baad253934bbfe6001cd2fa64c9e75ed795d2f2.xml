{"nodes":[{"pos":[13,41],"content":"Resource authoring checklist","needQuote":true,"nodes":[{"content":"Resource authoring checklist","pos":[0,28]}]},{"pos":[74,88],"content":"powershell,DSC","needQuote":true,"nodes":[{"content":"powershell,DSC","pos":[0,14]}]},{"content":"Resource authoring checklist","pos":[186,214]},{"content":"This checklist is a list of best practices when authoring a new DSC Resource.","pos":[215,292]},{"content":"Resource module contains .psd1 file and schema.mof for every resource","pos":[296,365]},{"content":"Check that your resource has correct structure and contains all required files.","pos":[367,446]},{"content":"Every resource module should contain a .psd1 file and every non-composite resource should have schema.mof file.","pos":[447,558]},{"content":"Resources that do not contain schema will not be listed by <bpt id=\"p1\">**</bpt>Get-DscResource<ept id=\"p1\">**</ept> and users will not be able to use the intellisense when writing code against those modules in ISE.","pos":[559,736],"source":" Resources that do not contain schema will not be listed by **Get-DscResource** and users will not be able to use the intellisense when writing code against those modules in ISE."},{"content":"The directory structure for xRemoteFile resource, which is part of the <bpt id=\"p1\">[</bpt>xPSDesiredStateConfiguration resource module<ept id=\"p1\">](https://github.com/PowerShell/xPSDesiredStateConfiguration)</ept>, looks as follows:","pos":[737,934],"source":" \nThe directory structure for xRemoteFile resource, which is part of the [xPSDesiredStateConfiguration resource module](https://github.com/PowerShell/xPSDesiredStateConfiguration), looks as follows:"},{"content":"Resource and schema are correct","pos":[1292,1323]},{"content":"Verify the resource schema (*.schema.mof) file.","pos":[1326,1373]},{"content":"You can use the <bpt id=\"p1\">[</bpt>DSC Resource Designer<ept id=\"p1\">](https://www.powershellgallery.com/packages/xDSCResourceDesigner/)</ept> to help develop and test your schema.","pos":[1374,1517],"source":" You can use the [DSC Resource Designer](https://www.powershellgallery.com/packages/xDSCResourceDesigner/) to help develop and test your schema."},{"content":"Make sure that:","pos":[1518,1534],"source":" \nMake sure that:"},{"content":"Property types are correct (e.g. don’t use String for properties which accept numeric values, you should use UInt32 or other numeric types instead)","pos":[1537,1684]},{"content":"Property attributes are specified correctly as: ([key], [required], [write], [read])","pos":[1687,1771]},{"content":"At least one parameter in the schema has to be marked as [key]","pos":[1774,1836]},{"content":"[read] property does not coexist together with any of: [required], [key], [write]","pos":[1839,1920]},{"content":"If multiple qualifiers are specified except [read], then [key] takes precedence","pos":[1923,2002]},{"content":"If [write] and [required] are specified, then [required] takes precedence","pos":[2005,2078]},{"content":"ValueMap is specified where appropriate","pos":[2081,2120]},{"content":"Example:","pos":[2122,2130]},{"content":"Friendly name is specified and confirms to DSC naming conventions","pos":[2291,2356]},{"pos":[2358,2428],"content":"Example: <ph id=\"ph1\">```[ClassVersion(\"1.0.0.0\"), FriendlyName(\"xRemoteFile\")]```</ph>","source":"Example: \n```[ClassVersion(\"1.0.0.0\"), FriendlyName(\"xRemoteFile\")]```"},{"content":"Every field has meaningful description.","pos":[2432,2471]},{"content":"The PowerShell GitHub repository has good examples, such as <bpt id=\"p1\">[</bpt>the .schema.mof for xRemoteFile<ept id=\"p1\">](https://github.com/PowerShell/xPSDesiredStateConfiguration/blob/dev/DSCResources/MSFT_xRemoteFile/MSFT_xRemoteFile.schema.mof)</ept>","pos":[2472,2692],"source":" The PowerShell GitHub repository has good examples, such as [the .schema.mof for xRemoteFile](https://github.com/PowerShell/xPSDesiredStateConfiguration/blob/dev/DSCResources/MSFT_xRemoteFile/MSFT_xRemoteFile.schema.mof)"},{"pos":[2694,2920],"content":"Additionally, you should use <bpt id=\"p1\">**</bpt>Test-xDscResource<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>Test-xDscSchema<ept id=\"p2\">**</ept> cmdlets from <bpt id=\"p3\">[</bpt>DSC Resource Designer<ept id=\"p3\">](https://www.powershellgallery.com/packages/xDSCResourceDesigner/)</ept> to automatically verify the resource and schema:","source":"Additionally, you should use **Test-xDscResource** and **Test-xDscSchema** cmdlets from [DSC Resource Designer](https://www.powershellgallery.com/packages/xDSCResourceDesigner/) to automatically verify the resource and schema:"},{"content":"For example:","pos":[3012,3024]},{"content":"Resource loads without errors","pos":[3175,3204]},{"content":"Check whether the resource module can be successfully loaded.","pos":[3208,3269]},{"content":"This can be achieved manually, by running <ph id=\"ph1\">`Import-Module &lt;resource_module&gt; -force `</ph> and confirming that no errors occurred, or by writing test automation.","pos":[3270,3424],"source":"\nThis can be achieved manually, by running `Import-Module <resource_module> -force ` and confirming that no errors occurred, or by writing test automation."},{"content":"In case of the latter, you can follow this structure in your test case:","pos":[3425,3496]},{"content":"Resource is idempotent in the positive case","pos":[3671,3714]},{"content":"One of the fundamental characteristics of DSC resources is be idempotence.","pos":[3716,3790]},{"content":"It means that applying a DSC configuration containing that resource multiple times will always achieve the same result.","pos":[3791,3910]},{"content":"For example, if we create a configuration which contains the following File resource:","pos":[3911,3996]},{"content":"After applying it for the first time, file test.txt should appear in C:\\test folder.","pos":[4100,4184]},{"content":"However, subsequent runs of the same configuration should not change the state of the machine (e.g. no copies of the test.txt file should be created).","pos":[4185,4335]},{"content":"To ensure a resource is idempotent you can repeatedly call <bpt id=\"p1\">**</bpt>Set-TargetResource<ept id=\"p1\">**</ept> when testing the resource directly, or call <bpt id=\"p2\">**</bpt>Start-DscConfiguration<ept id=\"p2\">**</ept> multiple times when doing end to end testing.","pos":[4336,4534],"source":"\nTo ensure a resource is idempotent you can repeatedly call **Set-TargetResource** when testing the resource directly, or call **Start-DscConfiguration** multiple times when doing end to end testing."},{"content":"The result should be the same after every run.","pos":[4535,4581]},{"content":"Test user modification scenario","pos":[4588,4619]},{"content":"By changing the state of the machine and then rerunning DSC, you can verify that <bpt id=\"p1\">**</bpt>Set-TargetResource<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>Test-TargetResource<ept id=\"p2\">**</ept> function properly.","pos":[4623,4773],"source":"By changing the state of the machine and then rerunning DSC, you can verify that **Set-TargetResource** and **Test-TargetResource** function properly."},{"content":"Here are steps you should take:","pos":[4774,4805]},{"content":"Start with the resource not in the desired state.","pos":[4810,4859]},{"content":"Run configuration with your resource","pos":[4864,4900]},{"pos":[4905,4950],"content":"Verify <bpt id=\"p1\">**</bpt>Test-DscConfiguration<ept id=\"p1\">**</ept> returns True","source":"Verify **Test-DscConfiguration** returns True"},{"content":"Modify the configured item to be out of the desired state","pos":[4955,5012]},{"pos":[5017,5119],"content":"Verify <bpt id=\"p1\">**</bpt>Test-DscConfiguration<ept id=\"p1\">**</ept> returns false Here’s a more concrete example using Registry resource:","source":"Verify **Test-DscConfiguration** returns false\nHere’s a more concrete example using Registry resource:"},{"content":"Start with registry key not in the desired state","pos":[5124,5172]},{"pos":[5177,5281],"content":"Run <bpt id=\"p1\">**</bpt>Start-DscConfiguration<ept id=\"p1\">**</ept> with a configuration to put it in the desired state and verify it passes.","source":"Run **Start-DscConfiguration** with a configuration to put it in the desired state and verify it passes."},{"pos":[5286,5342],"content":"Run <bpt id=\"p1\">**</bpt>Test-DscConfiguration<ept id=\"p1\">**</ept> and verify it returns true","source":"Run **Test-DscConfiguration** and verify it returns true"},{"content":"Modify the value of the key so that it is not in the desired state","pos":[5347,5413]},{"pos":[5418,5475],"content":"Run <bpt id=\"p1\">**</bpt>Test-DscConfiguration<ept id=\"p1\">**</ept> and verify it returns false","source":"Run **Test-DscConfiguration** and verify it returns false"},{"content":"Get-TargetResource functionality was verified using Get-DscConfiguration","pos":[5480,5552]},{"content":"Get-TargetResource should return details of the current state of the resource.","pos":[5554,5632]},{"content":"Make sure to test it by calling Get-DscConfiguration after you apply the configuration and verifying that output correctly reflects the current state of the machine.","pos":[5633,5798]},{"content":"It's important to test it separately, since any issues in this area won't appear when calling Start-DscConfiguration.","pos":[5799,5916]},{"pos":[5921,5976],"content":"Call <bpt id=\"p1\">**</bpt>Get/Set/Test-TargetResource<ept id=\"p1\">**</ept> functions directly","source":"Call **Get/Set/Test-TargetResource** functions directly"},{"pos":[5981,6141],"content":"Make sure you test the <bpt id=\"p1\">**</bpt>Get/Set/Test-TargetResource<ept id=\"p1\">**</ept> functions implemented in your resource by calling them directly and verifying that they work as expected.","source":"Make sure you test the **Get/Set/Test-TargetResource** functions implemented in your resource by calling them directly and verifying that they work as expected."},{"pos":[6146,6196],"content":"Verify End to End using <bpt id=\"p1\">**</bpt>Start-DscConfiguration<ept id=\"p1\">**</ept>","source":"Verify End to End using **Start-DscConfiguration**"},{"content":"Testing <bpt id=\"p1\">**</bpt>Get/Set/Test-TargetResource<ept id=\"p1\">**</ept> functions by calling them directly is important, but not all issues will be discovered this way.","pos":[6201,6337],"source":"Testing **Get/Set/Test-TargetResource** functions by calling them directly is important, but not all issues will be discovered this way."},{"content":"You should focus significant part of your testing on using <bpt id=\"p1\">**</bpt>Start-DscConfiguration<ept id=\"p1\">**</ept> or the pull server.","pos":[6338,6443],"source":" You should focus significant part of your testing on using **Start-DscConfiguration** or the pull server."},{"content":"In fact, this is how users will use the resource, so don’t underestimate the significance of this type of tests.","pos":[6444,6556]},{"content":"Possible types of issues:","pos":[6557,6583],"source":" \nPossible types of issues:"},{"content":"Credential/Session may behave differently because the DSC agent runs as a service.","pos":[6586,6668]},{"content":"Be sure to test any features here end to end.","pos":[6670,6715]},{"pos":[6718,6858],"content":"Errors output by <bpt id=\"p1\">**</bpt>Start-DscConfiguration<ept id=\"p1\">**</ept> may be different than those displayed when calling the <bpt id=\"p2\">**</bpt>Set-TargetResource<ept id=\"p2\">**</ept> function directly.","source":"Errors output by **Start-DscConfiguration** may be different than those displayed when calling the **Set-TargetResource** function directly."},{"content":"Test compatability on all DSC supported platforms","pos":[6863,6912]},{"content":"Resource should work on all DSC supported platforms (Windows Server 2008 R2 and newer).","pos":[6916,7003]},{"content":"Install the latest WMF (Windows Management Framework) on your OS to get the latest version of DSC.","pos":[7004,7102]},{"content":"If your resource does not work on some of these platforms by design, a specific error message should be returned.","pos":[7103,7216]},{"content":"Also, make sure your resource checks whether cmdlets you are calling are present on particular machine.","pos":[7217,7320]},{"content":"Windows Server 2012 added a large number of new cmdlets that are not available on Windows Server 2008R2, even with WMF installed.","pos":[7321,7450]},{"content":"Verify on Windows Client (if applicable)","pos":[7456,7496]},{"content":"One very common test gap is verifying the resource only on server versions of Windows.","pos":[7500,7586]},{"content":"Many resources are also designed to work on Client SKUs, so if that’s true in your case, don’t forget to test it on those platforms as well.","pos":[7587,7727]},{"content":"Get-DSCResource lists the resource","pos":[7732,7766]},{"content":"After deploying the module, calling Get-DscResource should list your resource among others as a result.","pos":[7770,7873]},{"content":"If you can’t find your resource in the list, make sure that schema.mof file for that resource exists.","pos":[7874,7975]},{"content":"Resource module contains examples","pos":[7980,8013]},{"content":"Creating quality examples which will help others understand how to use it.","pos":[8017,8091]},{"content":"This is crucial, especially since many users treat sample code as documentation.","pos":[8092,8172]},{"content":"First, you should determine the examples that will be included with the module – at minimum, you should cover most important use cases for your resource:","pos":[8176,8329]},{"content":"If your module contains several resources that need to work together for an end-to-end scenario, the basic end-to-end example would ideally be first.","pos":[8332,8481]},{"content":"The initial examples should be very simple -- how to get started with your resources in small manageable chunks (e.g. creating a new VHD)","pos":[8484,8621]},{"content":"Subsequent examples should build on those examples (e.g. creating a VM from a VHD, removing VM, modifying VM), and show advanced functionality (e.g. creating a VM with dynamic memory)","pos":[8624,8807]},{"content":"Example configurations should be parameterized (all values should be passed to the configuration as parameters and there should be no hardcoded values):","pos":[8810,8962]},{"content":"It’s a good practice to include (commented out) example of how to call the configuration with the actual values at the end of the example script.","pos":[9677,9822]},{"content":"For example, in the configuration above it isn't neccessarily obvious that the best way to specify UserAgent is:","pos":[9823,9936],"source":" \nFor example, in the configuration above it isn't neccessarily obvious that the best way to specify UserAgent is:"},{"content":"In which case a comment can clarify the intended execution of the configuration:","pos":[10016,10096]},{"content":"For each example, write a short description which explains what it does, and the meaning of the parameters.","pos":[10552,10659]},{"content":"Make sure examples cover most the important scenarios for your resource and if there’s nothing missing, verify that they all execute and put machine in the desired state.","pos":[10663,10833]},{"content":"Error messages are easy to understand and help users solve problems","pos":[10840,10907]},{"content":"Good error messages should be:","pos":[10911,10941]},{"content":"There: The biggest problem with error messages is that they often don’t exist, so make sure they are there.","pos":[10944,11051]},{"content":"Easy to understand: Human readable, no obscure error codes","pos":[11055,11113]},{"content":"Precise: Describe what’s exactly the problem","pos":[11116,11160]},{"content":"Constructive: Advice how to fix the issue","pos":[11163,11204]},{"pos":[11207,11427],"content":"Polite: Don’t blame user or make them feel bad Make sure you verify errors in End to End scenarios (using <bpt id=\"p1\">**</bpt>Start-DscConfiguration<ept id=\"p1\">**</ept>), because they may differ from those returned when running resource functions directly.","source":"Polite: Don’t blame user or make them feel bad\nMake sure you verify errors in End to End scenarios (using **Start-DscConfiguration**), because they may differ from those returned when running resource functions directly."},{"content":"Log messages are easy to understand and informative (including –verbose, –debug and ETW logs)","pos":[11433,11526]},{"content":"Ensure that logs outputted by the resource are easy to understand and provide value to the user.","pos":[11530,11626]},{"content":"Resources should output all information which might be helpful to the user, but more logs is not always better.","pos":[11627,11738]},{"content":"You should avoid redundancy and outputting data which does not provide additional value – don’t make someone go through hundreds of log entries in order to find what they're looking for.","pos":[11739,11925]},{"content":"Of course, no logs is not an acceptable solution for this problem either.","pos":[11926,11999]},{"content":"When testing, you should also analyze verbose and debug logs (by running <bpt id=\"p1\">**</bpt>Start-DscConfiguration<ept id=\"p1\">**</ept> with –verbose and –debug switches appropriately), as well as ETW logs.","pos":[12002,12172],"source":"When testing, you should also analyze verbose and debug logs (by running **Start-DscConfiguration** with –verbose and –debug switches appropriately), as well as ETW logs."},{"content":"To see DSC ETW logs, go to Event Viewer and open the following folder: Applications and Services- Microsoft - Windows - Desired State Configuration.","pos":[12173,12321]},{"content":"By default there will be Operational channel, but make sure you enable Analytic and Debug channels before running the configuration.","pos":[12323,12455]},{"content":"To enable Analytic/Debug channels, you can execute script below:","pos":[12456,12521],"source":" \nTo enable Analytic/Debug channels, you can execute script below:"},{"content":"Resource implementation does not contain hardcoded paths","pos":[13012,13068]},{"content":"Ensure there are no hardcoded paths in the resource implementation, particularly if they assume language (en-us), or when there are system variables that can be used.","pos":[13072,13238]},{"content":"If your resource need to access specific paths, use environment variables instead of hardcoding the path, as it may differ on other machines.","pos":[13239,13380],"source":"\nIf your resource need to access specific paths, use environment variables instead of hardcoding the path, as it may differ on other machines."},{"content":"Example:","pos":[13382,13390]},{"content":"Instead of:","pos":[13392,13403]},{"content":"You can write:","pos":[13519,13533]},{"content":"Resource implementation does not contain user information","pos":[13636,13693]},{"content":"Make sure there are no email names, account information, or names of people in the code.","pos":[13697,13785]},{"content":"Resource was tested with valid/invalid credentials","pos":[13789,13839]},{"content":"If your resource takes a credential as parameter:","pos":[13843,13892]},{"content":"Verify the resource works when Local System (or the computer account for remote resources) does not have access.","pos":[13895,14007]},{"content":"Verify the resource works with a credential specified for Get, Set and Test","pos":[14010,14085]},{"content":"If your resource accesses shares, test all the variants you need to support, such as:","pos":[14089,14174]},{"content":"Standard windows shares.","pos":[14179,14203]},{"content":"DFS shares.","pos":[14208,14219]},{"content":"SAMBA shares (if you want to support Linux.)","pos":[14224,14268]},{"content":"Resource does not require interactive input","pos":[14273,14316]},{"content":"<bpt id=\"p1\">**</bpt>Get/Set/Test-TargetResource<ept id=\"p1\">**</ept> functions should be executed automatically and must not wait for user’s input at any stage of execution (e.g. you should not use <bpt id=\"p2\">**</bpt>Get-Credential<ept id=\"p2\">**</ept> inside these functions).","pos":[14320,14524],"source":"**Get/Set/Test-TargetResource** functions should be executed automatically and must not wait for user’s input at any stage of execution (e.g. you should not use **Get-Credential** inside these functions)."},{"content":"If you need to provide user’s input, you should pass it to the configuration as parameter during the compilation phase.","pos":[14525,14644]},{"content":"Resource functionality was thoroughly tested","pos":[14649,14693]},{"content":"This checklist contains items which are important to be tested and/or are often missed.","pos":[14697,14784]},{"content":"There will be bunch of tests, mainly functional ones which will be specific to the resource you are testing and are not mentioned here.","pos":[14785,14920]},{"content":"Don’t forget about negative test cases.","pos":[14921,14960]},{"content":"Best practice: Resource module contains Tests folder with ResourceDesignerTests.ps1 script","pos":[14965,15055]},{"content":"It’s a good practice to create folder “Tests” inside resource module, create ResourceDesignerTests.ps1 file and add tests using <bpt id=\"p1\">**</bpt>Test-xDscResource<ept id=\"p1\">**</ept> and <bpt id=\"p2\">**</bpt>Test-xDscSchema<ept id=\"p2\">**</ept> for all resources in given module.","pos":[15059,15267],"source":"It’s a good practice to create folder “Tests” inside resource module, create ResourceDesignerTests.ps1 file and add tests using **Test-xDscResource** and **Test-xDscSchema** for all resources in given module."},{"content":"This way you can quickly validate schemas of all resources from the given modules and do a sanity check before publishing.","pos":[15268,15391],"source":" \nThis way you can quickly validate schemas of all resources from the given modules and do a sanity check before publishing."},{"content":"For xRemoteFile, ResourceTests.ps1 could look as simple as:","pos":[15392,15451],"source":"\nFor xRemoteFile, ResourceTests.ps1 could look as simple as:"},{"content":"Best practice: Resource folder contains resource designer script for generating schema","pos":[15601,15687]},{"content":"Each resource should contain a resource designer script which generates a mof schema of the resource.","pos":[15690,15791]},{"content":"This file should be placed in <ph id=\"ph1\">&lt;ResourceName&gt;</ph>\\ResourceDesignerScripts and be named Generate<ph id=\"ph2\">&lt;ResourceName&gt;</ph>Schema.ps1 For xRemoteFile resource this file would be called GenerateXRemoteFileSchema.ps1 and contain:","pos":[15792,16000],"source":" This file should be placed in <ResourceName>\\ResourceDesignerScripts and be named Generate<ResourceName>Schema.ps1\nFor xRemoteFile resource this file would be called GenerateXRemoteFileSchema.ps1 and contain:"},{"content":"Best practice: Resource supports -whatif","pos":[17413,17453]},{"content":"If your resource is performing “dangerous” operations, it’s a good practice to implement -whatif functionality.","pos":[17457,17568]},{"content":"After it’s done, make sure that whatif output correctly describes operations which would happen if command was executed without whatif switch.","pos":[17569,17711]},{"content":"Also, verify that operations does not execute (no changes to the node’s state are made) when –whatif switch is present.","pos":[17712,17831],"source":"\nAlso, verify that operations does not execute (no changes to the node’s state are made) when –whatif switch is present."},{"content":"For example, let’s assume we are testing File resource.","pos":[17832,17888],"source":" \nFor example, let’s assume we are testing File resource."},{"content":"Below is simple configuration which creates file “test.txt” with contents “test”:","pos":[17889,17970]},{"content":"If we compile and then execute the configuration with the –whatif switch, the output is telling us exactly what would happen when we run the configuration.","pos":[18167,18322]},{"content":"The configuration itself however was not executed (test.txt file was not created).","pos":[18323,18405]},{"content":"This list is not exhaustive, but it covers many important issues which can be encountered while designing, developing and testing DSC resources.","pos":[19931,20075]}],"content":"---\ntitle:   Resource authoring checklist\nms.date:  2016-07-11\nkeywords:  powershell,DSC\ndescription:  \nms.topic:  article\nauthor:  eslesar\nmanager:  dongill\nms.prod:  powershell\n---\n\n# Resource authoring checklist\nThis checklist is a list of best practices when authoring a new DSC Resource.\n## Resource module contains .psd1 file and schema.mof for every resource \nCheck that your resource has correct structure and contains all required files. Every resource module should contain a .psd1 file and every non-composite resource should have schema.mof file. Resources that do not contain schema will not be listed by **Get-DscResource** and users will not be able to use the intellisense when writing code against those modules in ISE. \nThe directory structure for xRemoteFile resource, which is part of the [xPSDesiredStateConfiguration resource module](https://github.com/PowerShell/xPSDesiredStateConfiguration), looks as follows:\n\n\n```\nxPSDesiredStateConfiguration\n    DSCResources\n        MSFT_xRemoteFile\n            MSFT_xRemoteFile.psm1\n            MSFT_xRemoteFile.schema.mof\n    Examples\n        xRemoteFile_DownloadFile.ps1\n    ResourceDesignerScripts\n        GenerateXRemoteFileSchema.ps1\n    Tests\n        ResourceDesignerTests.ps1\n    xPSDesiredStateConfiguration.psd1\n```\n\n## Resource and schema are correct##\nVerify the resource schema (*.schema.mof) file. You can use the [DSC Resource Designer](https://www.powershellgallery.com/packages/xDSCResourceDesigner/) to help develop and test your schema. \nMake sure that:\n- Property types are correct (e.g. don’t use String for properties which accept numeric values, you should use UInt32 or other numeric types instead)\n- Property attributes are specified correctly as: ([key], [required], [write], [read])\n- At least one parameter in the schema has to be marked as [key]\n- [read] property does not coexist together with any of: [required], [key], [write]\n- If multiple qualifiers are specified except [read], then [key] takes precedence\n- If [write] and [required] are specified, then [required] takes precedence\n- ValueMap is specified where appropriate\n\nExample:\n```\n[Read, ValueMap{\"Present\", \"Absent\"}, Values{\"Present\", \"Absent\"}, Description(\"Says whether DestinationPath exists on the machine\")] String Ensure;\n```\n\n- Friendly name is specified and confirms to DSC naming conventions\n\nExample: \n```[ClassVersion(\"1.0.0.0\"), FriendlyName(\"xRemoteFile\")]```\n\n- Every field has meaningful description. The PowerShell GitHub repository has good examples, such as [the .schema.mof for xRemoteFile](https://github.com/PowerShell/xPSDesiredStateConfiguration/blob/dev/DSCResources/MSFT_xRemoteFile/MSFT_xRemoteFile.schema.mof)\n\nAdditionally, you should use **Test-xDscResource** and **Test-xDscSchema** cmdlets from [DSC Resource Designer](https://www.powershellgallery.com/packages/xDSCResourceDesigner/) to automatically verify the resource and schema:\n```\nTest-xDscResource <Resource_folder>\nTest-xDscSchema <Path_to_resource_schema_file>\n```\nFor example:\n```powershell\nTest-xDscResource ..\\DSCResources\\MSFT_xRemoteFile\nTest-xDscSchema ..\\DSCResources\\MSFT_xRemoteFile\\MSFT_xRemoteFile.schema.mof\n```\n\n## Resource loads without errors ##\nCheck whether the resource module can be successfully loaded.\nThis can be achieved manually, by running `Import-Module <resource_module> -force ` and confirming that no errors occurred, or by writing test automation. In case of the latter, you can follow this structure in your test case:\n```powershell\n$error = $null\nImport-Module <resource_module> –force\nIf ($error.count –ne 0) {\n    Throw “Module was not imported correctly. Errors returned: $error”\n}\n```\n## Resource is idempotent in the positive case \nOne of the fundamental characteristics of DSC resources is be idempotence. It means that applying a DSC configuration containing that resource multiple times will always achieve the same result. For example, if we create a configuration which contains the following File resource:\n```powershell\nFile file {\n    DestinationPath = \"C:\\test\\test.txt\"\n    Contents = \"Sample text\"\n} \n```\nAfter applying it for the first time, file test.txt should appear in C:\\test folder. However, subsequent runs of the same configuration should not change the state of the machine (e.g. no copies of the test.txt file should be created).\nTo ensure a resource is idempotent you can repeatedly call **Set-TargetResource** when testing the resource directly, or call **Start-DscConfiguration** multiple times when doing end to end testing. The result should be the same after every run. \n\n\n## Test user modification scenario ##\nBy changing the state of the machine and then rerunning DSC, you can verify that **Set-TargetResource** and **Test-TargetResource** function properly. Here are steps you should take:\n1.  Start with the resource not in the desired state.\n2.  Run configuration with your resource\n3.  Verify **Test-DscConfiguration** returns True\n4.  Modify the configured item to be out of the desired state\n5.  Verify **Test-DscConfiguration** returns false\nHere’s a more concrete example using Registry resource:\n1.  Start with registry key not in the desired state\n2.  Run **Start-DscConfiguration** with a configuration to put it in the desired state and verify it passes.\n3.  Run **Test-DscConfiguration** and verify it returns true\n4.  Modify the value of the key so that it is not in the desired state\n5.  Run **Test-DscConfiguration** and verify it returns false\n6.  Get-TargetResource functionality was verified using Get-DscConfiguration\n\nGet-TargetResource should return details of the current state of the resource. Make sure to test it by calling Get-DscConfiguration after you apply the configuration and verifying that output correctly reflects the current state of the machine. It's important to test it separately, since any issues in this area won't appear when calling Start-DscConfiguration.\n\n## Call **Get/Set/Test-TargetResource** functions directly ##\n\nMake sure you test the **Get/Set/Test-TargetResource** functions implemented in your resource by calling them directly and verifying that they work as expected.\n\n## Verify End to End using **Start-DscConfiguration** ##\n\nTesting **Get/Set/Test-TargetResource** functions by calling them directly is important, but not all issues will be discovered this way. You should focus significant part of your testing on using **Start-DscConfiguration** or the pull server. In fact, this is how users will use the resource, so don’t underestimate the significance of this type of tests. \nPossible types of issues:\n- Credential/Session may behave differently because the DSC agent runs as a service.  Be sure to test any features here end to end.\n- Errors output by **Start-DscConfiguration** may be different than those displayed when calling the **Set-TargetResource** function directly.\n\n## Test compatability on all DSC supported platforms ##\nResource should work on all DSC supported platforms (Windows Server 2008 R2 and newer). Install the latest WMF (Windows Management Framework) on your OS to get the latest version of DSC. If your resource does not work on some of these platforms by design, a specific error message should be returned. Also, make sure your resource checks whether cmdlets you are calling are present on particular machine. Windows Server 2012 added a large number of new cmdlets that are not available on Windows Server 2008R2, even with WMF installed. \n\n## Verify on Windows Client (if applicable) ##\nOne very common test gap is verifying the resource only on server versions of Windows. Many resources are also designed to work on Client SKUs, so if that’s true in your case, don’t forget to test it on those platforms as well. \n## Get-DSCResource lists the resource ##\nAfter deploying the module, calling Get-DscResource should list your resource among others as a result. If you can’t find your resource in the list, make sure that schema.mof file for that resource exists. \n## Resource module contains examples ##\nCreating quality examples which will help others understand how to use it. This is crucial, especially since many users treat sample code as documentation. \n- First, you should determine the examples that will be included with the module – at minimum, you should cover most important use cases for your resource:\n- If your module contains several resources that need to work together for an end-to-end scenario, the basic end-to-end example would ideally be first.\n- The initial examples should be very simple -- how to get started with your resources in small manageable chunks (e.g. creating a new VHD)\n- Subsequent examples should build on those examples (e.g. creating a VM from a VHD, removing VM, modifying VM), and show advanced functionality (e.g. creating a VM with dynamic memory)\n- Example configurations should be parameterized (all values should be passed to the configuration as parameters and there should be no hardcoded values):\n```powershell\nconfiguration Sample_xRemoteFile_DownloadFile\n{\n    param\n    (\n        [string[]] $nodeName = 'localhost',\n\n        [parameter(Mandatory = $true)]\n        [ValidateNotNullOrEmpty()]\n        [String] $destinationPath,\n\n        [parameter(Mandatory = $true)]\n        [ValidateNotNullOrEmpty()]\n        [String] $uri,\n\n        [String] $userAgent,\n\n        [Hashtable] $headers\n    )\n\n    Import-DscResource -Name MSFT_xRemoteFile -ModuleName xPSDesiredStateConfiguration\n\n    Node $nodeName\n    {\n        xRemoteFile DownloadFile\n        {\n            DestinationPath = $destinationPath\n            Uri = $uri\n            UserAgent = $userAgent\n            Headers = $headers\n        }\n    }\n} \n```\n- It’s a good practice to include (commented out) example of how to call the configuration with the actual values at the end of the example script. \nFor example, in the configuration above it isn't neccessarily obvious that the best way to specify UserAgent is:\n\n`UserAgent = [Microsoft.PowerShell.Commands.PSUserAgent]::InternetExplorer`  \nIn which case a comment can clarify the intended execution of the configuration:\n```\n<# \nSample use (parameter values need to be changed according to your scenario):\n\nSample_xRemoteFile_DownloadFile -destinationPath \"$env:SystemDrive\\fileName.jpg\" -uri \"http://www.contoso.com/image.jpg\"\n\nSample_xRemoteFile_DownloadFile -destinationPath \"$env:SystemDrive\\fileName.jpg\" -uri \"http://www.contoso.com/image.jpg\" `\n-userAgent [Microsoft.PowerShell.Commands.PSUserAgent]::InternetExplorer -headers @{\"Accept-Language\" = \"en-US\"}\n#>  \n```\n- For each example, write a short description which explains what it does, and the meaning of the parameters. \n- Make sure examples cover most the important scenarios for your resource and if there’s nothing missing, verify that they all execute and put machine in the desired state.  \n\n## Error messages are easy to understand and help users solve problems ##\nGood error messages should be:\n- There: The biggest problem with error messages is that they often don’t exist, so make sure they are there. \n- Easy to understand: Human readable, no obscure error codes\n- Precise: Describe what’s exactly the problem\n- Constructive: Advice how to fix the issue\n- Polite: Don’t blame user or make them feel bad\nMake sure you verify errors in End to End scenarios (using **Start-DscConfiguration**), because they may differ from those returned when running resource functions directly. \n\n## Log messages are easy to understand and informative (including –verbose, –debug and ETW logs) ##\nEnsure that logs outputted by the resource are easy to understand and provide value to the user. Resources should output all information which might be helpful to the user, but more logs is not always better. You should avoid redundancy and outputting data which does not provide additional value – don’t make someone go through hundreds of log entries in order to find what they're looking for. Of course, no logs is not an acceptable solution for this problem either. \n\nWhen testing, you should also analyze verbose and debug logs (by running **Start-DscConfiguration** with –verbose and –debug switches appropriately), as well as ETW logs. To see DSC ETW logs, go to Event Viewer and open the following folder: Applications and Services- Microsoft - Windows - Desired State Configuration.  By default there will be Operational channel, but make sure you enable Analytic and Debug channels before running the configuration. \nTo enable Analytic/Debug channels, you can execute script below:\n```powershell\n$statusEnabled = $true\n# Use \"Analytic\" to enable Analytic channel\n$eventLogFullName = \"Microsoft-Windows-Dsc/Debug\" \n$commandToExecute = \"wevtutil set-log $eventLogFullName /e:$statusEnabled /q:$statusEnabled   \"\n$log = New-Object System.Diagnostics.Eventing.Reader.EventLogConfiguration $eventLogFullName\nif($statusEnabled -eq $log.IsEnabled)\n{\n    Write-Host -Verbose \"The channel event log is already enabled\"\n    return\n}     \nInvoke-Expression $commandToExecute \n```\n## Resource implementation does not contain hardcoded paths ##\nEnsure there are no hardcoded paths in the resource implementation, particularly if they assume language (en-us), or when there are system variables that can be used.\nIf your resource need to access specific paths, use environment variables instead of hardcoding the path, as it may differ on other machines.\n\nExample:\n\nInstead of:\n```\n$tempPath = \"C:\\Users\\kkaczma\\AppData\\Local\\Temp\\MyResource\"\n$programFilesPath = \"C:\\Program Files (x86)\"\n ```\nYou can write:\n```\n$tempPath = Join-Path $env:temp \"MyResource\"\n$programFilesPath = ${env:ProgramFiles(x86)} \n```\n## Resource implementation does not contain user information ##\nMake sure there are no email names, account information, or names of people in the code.\n## Resource was tested with valid/invalid credentials ##\nIf your resource takes a credential as parameter:\n- Verify the resource works when Local System (or the computer account for remote resources) does not have access.\n- Verify the resource works with a credential specified for Get, Set and Test \n- If your resource accesses shares, test all the variants you need to support, such as:\n  - Standard windows shares.\n  - DFS shares.\n  - SAMBA shares (if you want to support Linux.)\n\n## Resource does not require interactive input ##\n**Get/Set/Test-TargetResource** functions should be executed automatically and must not wait for user’s input at any stage of execution (e.g. you should not use **Get-Credential** inside these functions). If you need to provide user’s input, you should pass it to the configuration as parameter during the compilation phase. \n## Resource functionality was thoroughly tested ##\nThis checklist contains items which are important to be tested and/or are often missed. There will be bunch of tests, mainly functional ones which will be specific to the resource you are testing and are not mentioned here. Don’t forget about negative test cases. \n## Best practice: Resource module contains Tests folder with ResourceDesignerTests.ps1 script ##\nIt’s a good practice to create folder “Tests” inside resource module, create ResourceDesignerTests.ps1 file and add tests using **Test-xDscResource** and **Test-xDscSchema** for all resources in given module. \nThis way you can quickly validate schemas of all resources from the given modules and do a sanity check before publishing.\nFor xRemoteFile, ResourceTests.ps1 could look as simple as:\n```powershell\nTest-xDscResource ..\\DSCResources\\MSFT_xRemoteFile\nTest-xDscSchema ..\\DSCResources\\MSFT_xRemoteFile\\MSFT_xRemoteFile.schema.mof \n```\n##Best practice: Resource folder contains resource designer script for generating schema##\nEach resource should contain a resource designer script which generates a mof schema of the resource. This file should be placed in <ResourceName>\\ResourceDesignerScripts and be named Generate<ResourceName>Schema.ps1\nFor xRemoteFile resource this file would be called GenerateXRemoteFileSchema.ps1 and contain:\n```powershell \n$DestinationPath = New-xDscResourceProperty -Name DestinationPath -Type String -Attribute Key -Description 'Path under which downloaded or copied file should be accessible after operation.'\n$Uri = New-xDscResourceProperty -Name Uri -Type String -Attribute Required -Description 'Uri of a file which should be copied or downloaded. This parameter supports HTTP and HTTPS values.'\n$Headers = New-xDscResourceProperty -Name Headers -Type Hashtable[] -Attribute Write -Description 'Headers of the web request.'\n$UserAgent = New-xDscResourceProperty -Name UserAgent -Type String -Attribute Write -Description 'User agent for the web request.' \n$Ensure = New-xDscResourceProperty -Name Ensure -Type String -Attribute Read -ValidateSet \"Present\", \"Absent\" -Description 'Says whether DestinationPath exists on the machine'\n$Credential = New-xDscResourceProperty -Name Credential -Type PSCredential -Attribute Write -Description 'Specifies a user account that has permission to send the request.'\n$CertificateThumbprint = New-xDscResourceProperty -Name CertificateThumbprint -Type String -Attribute Write -Description 'Digital public key certificate that is used to send the request.'\n\nNew-xDscResource -Name MSFT_xRemoteFile -Property @($DestinationPath, $Uri, $Headers, $UserAgent, $Ensure, $Credential, $CertificateThumbprint) -ModuleName xPSDesiredStateConfiguration2 -FriendlyName xRemoteFile \n```\n## Best practice: Resource supports -whatif ##\nIf your resource is performing “dangerous” operations, it’s a good practice to implement -whatif functionality. After it’s done, make sure that whatif output correctly describes operations which would happen if command was executed without whatif switch.\nAlso, verify that operations does not execute (no changes to the node’s state are made) when –whatif switch is present. \nFor example, let’s assume we are testing File resource. Below is simple configuration which creates file “test.txt” with contents “test”:\n```powershell\nconfiguration config\n{\n    node localhost \n    {\n        File file\n        {\n            Contents=\"test\"\n            DestinationPath=\"C:\\test\\test.txt\"\n        }\n    }\n}\nconfig \n```\nIf we compile and then execute the configuration with the –whatif switch, the output is telling us exactly what would happen when we run the configuration. The configuration itself however was not executed (test.txt file was not created).\n```powershell \nStart-DscConfiguration -path .\\config -ComputerName localhost -wait -verbose -whatif\nVERBOSE: Perform operation 'Invoke CimMethod' with following parameters, ''methodName' =\nSendConfigurationApply,'className' = MSFT_DSCLocalConfigurationManager,'namespaceName' =\nroot/Microsoft/Windows/DesiredStateConfiguration'.\nVERBOSE: An LCM method call arrived from computer CHARLESX1 with user sid\nS-1-5-21-397955417-626881126-188441444-5179871.\nWhat if: [X]: LCM:  [ Start  Set      ]\nWhat if: [X]: LCM:  [ Start  Resource ]  [[File]file]\nWhat if: [X]: LCM:  [ Start  Test     ]  [[File]file]\nWhat if: [X]:                            [[File]file] The system cannot find the file specified.\nWhat if: [X]:                            [[File]file] The related file/directory is: C:\\test\\test.txt.\nWhat if: [X]: LCM:  [ End    Test     ]  [[File]file]  in 0.0270 seconds.\nWhat if: [X]: LCM:  [ Start  Set      ]  [[File]file]\nWhat if: [X]:                            [[File]file] The system cannot find the file specified.\nWhat if: [X]:                            [[File]file] The related file/directory is: C:\\test\\test.txt.\nWhat if: [X]:                            [C:\\test\\test.txt] Creating and writing contents and setting attributes.\nWhat if: [X]: LCM:  [ End    Set      ]  [[File]file]  in 0.0180 seconds.\nWhat if: [X]: LCM:  [ End    Resource ]  [[File]file]\nWhat if: [X]: LCM:  [ End    Set      ]\nVERBOSE: [X]: LCM:  [ End    Set      ]    in  0.1050 seconds.\nVERBOSE: Operation 'Invoke CimMethod' complete.\n```\n\nThis list is not exhaustive, but it covers many important issues which can be encountered while designing, developing and testing DSC resources.\n"}