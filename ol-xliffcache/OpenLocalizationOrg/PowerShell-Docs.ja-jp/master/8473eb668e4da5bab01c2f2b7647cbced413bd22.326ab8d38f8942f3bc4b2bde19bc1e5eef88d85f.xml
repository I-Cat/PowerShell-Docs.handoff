{"nodes":[{"pos":[105,126],"content":"powershell,cmdlet,jea","needQuote":true,"nodes":[{"content":"powershell,cmdlet,jea","pos":[0,21]}]},{"pos":[156,184],"content":"creating a domain controller","needQuote":true,"nodes":[{"content":"creating a domain controller","pos":[0,28]}]},{"content":"Creating a Domain Controller","pos":[221,249]},{"content":"This document assumes that your machine is domain joined.","pos":[251,308]},{"content":"If you currently don't have a domain to join, this section can help you quickly stand up a domain controller using DSC.","pos":[309,428],"source":"\nIf you currently don't have a domain to join, this section can help you quickly stand up a domain controller using DSC."},{"content":"Prerequisites","pos":[435,448]},{"content":"The machine is on an internal network","pos":[454,491]},{"content":"The machine is not joined to an existing domain","pos":[496,543]},{"content":"The machine is running Windows Server 2016 or has WMF 5.0 installed","pos":[548,615]},{"content":"Install xActiveDirectory","pos":[622,646]},{"content":"If your machine has an active internet connection, run the following command in an elevated PowerShell window:","pos":[647,757]},{"content":"If you do not have an internet connection, install xActiveDirectory to another machine and then copy the xActiveDirectory folder to the \"C:\\Program Files\\WindowsPowerShell\\Modules\" folder on your machine.","pos":[815,1019]},{"content":"To confirm the installation succeeded, run the following command:","pos":[1021,1086]},{"content":"Set up a domain with DSC","pos":[1154,1178]},{"content":"Copy the following script in PowerShell to make your machine a Domain Controller in a new domain.","pos":[1179,1276]},{"content":"<bpt id=\"p1\">**</bpt>AUTHOR'S NOTE: THERE IS A KNOWN ISSUE WITH THE CREDENTIALS PROVIDED NOT BEING USED.  TO BE SAFE, DON'T FORGET YOUR LOCAL ADMIN PASSWORD.<ept id=\"p1\">**</ept>","pos":[1277,1417],"source":"**AUTHOR'S NOTE: THERE IS A KNOWN ISSUE WITH THE CREDENTIALS PROVIDED NOT BEING USED.  TO BE SAFE, DON'T FORGET YOUR LOCAL ADMIN PASSWORD.**"},{"content":"Your machine will restart a few times.","pos":[3213,3251]},{"content":"You will know the process is complete once you see a file called \"C:\\temp.txt\" containing \"Domain has been created.\"","pos":[3252,3368],"source":"\nYou will know the process is complete once you see a file called \"C:\\temp.txt\" containing \"Domain has been created.\""},{"content":"Set up Users and Groups","pos":[3375,3398]},{"content":"The following commands will set up an Operator and Helpdesk group in your domain and a corresponding non-administrator user who is a member of that group.","pos":[3399,3553]}],"content":"---\ndescription:  \nmanager:  dongill\nms.topic:  article\nauthor:  jpjofre\nms.prod:  powershell\nkeywords:  powershell,cmdlet,jea\nms.date:  2016-06-22\ntitle:  creating a domain controller\nms.technology:  powershell\n---\n\n### Creating a Domain Controller\n\nThis document assumes that your machine is domain joined.\nIf you currently don't have a domain to join, this section can help you quickly stand up a domain controller using DSC.\n\n#### Prerequisites\n\n1.  The machine is on an internal network\n2.  The machine is not joined to an existing domain\n3.  The machine is running Windows Server 2016 or has WMF 5.0 installed\n\n#### Install xActiveDirectory\nIf your machine has an active internet connection, run the following command in an elevated PowerShell window:\n```PowerShell\nInstall-Module xActiveDirectory -Force\n```\nIf you do not have an internet connection, install xActiveDirectory to another machine and then copy the xActiveDirectory folder to the \"C:\\Program Files\\WindowsPowerShell\\Modules\" folder on your machine.\n\nTo confirm the installation succeeded, run the following command:\n```PowerShell\nGet-Module xActiveDirectory -ListAvailable\n```\n\n#### Set up a domain with DSC\nCopy the following script in PowerShell to make your machine a Domain Controller in a new domain.\n**AUTHOR'S NOTE: THERE IS A KNOWN ISSUE WITH THE CREDENTIALS PROVIDED NOT BEING USED.  TO BE SAFE, DON'T FORGET YOUR LOCAL ADMIN PASSWORD.**\n\n```PowerShell\nSet-Item WSMan:\\localhost\\Client\\TrustedHosts -Value $env:COMPUTERNAME -Force\n\n# This \"MetaConfiguration\" sets the DSC Engine to automatically reboot if required\n[DscLocalConfigurationManager()]\nConfiguration MetaConfiguration\n{\n    Node $env:Computername\n    {\n        Settings\n        {\n            RebootNodeIfNeeded = $true\n        }\n    }\n\n}\n\nMetaConfiguration\n# Apply the MetaConfiguration\nSet-DscLocalConfigurationManager .\\MetaConfiguration\n\n# Configure a domain controller of a new \"Contoso\" domain\nconfiguration DomainController\n{\n    param\n    (\n        $node,\n        $cred\n    )\n    Import-DscResource -ModuleName xActiveDirectory\n\n    Node $node\n    {\n        WindowsFeature ADDS\n        {\n            Ensure = 'Present'\n            Name = 'AD-Domain-Services'\n        }\n\n        xADDomain Contoso\n        {\n            DomainName = 'contoso.com'\n            DomainAdministratorCredential = $cred\n            SafemodeAdministratorPassword = $cred\n            DependsOn = '[WindowsFeature]ADDS'\n        }\n\n        file temp\n        {\n            DestinationPath = 'C:\\temp.txt'\n            Contents = 'Domain has been created'\n            DependsOn = '[xADDomain]Contoso'\n        }\n    }\n}\n\n$ConfigData = @{\n    AllNodes = @(\n        @{\n            NodeName = $env:Computername\n            PSDscAllowPlainTextPassword = $true\n        }\n    )\n}\n\n# Enter your desired password for the domain administrator (note, this will be stored as plain text)\nDomainController -cred (Get-Credential -Message \"Enter desired credential for domain administrator\") -node $env:Computername -configurationData $ConfigData\n\n# Apply the configuration to create the domain controller\nStart-DSCConfiguration -path .\\DomainController -ComputerName $env:Computername -Wait -Force -Verbose\n```\nYour machine will restart a few times.\nYou will know the process is complete once you see a file called \"C:\\temp.txt\" containing \"Domain has been created.\"\n\n#### Set up Users and Groups\nThe following commands will set up an Operator and Helpdesk group in your domain and a corresponding non-administrator user who is a member of that group.\n```PowerShell\n# Make Groups\n$NonAdminOperatorGroup = New-ADGroup -Name \"JEA_NonAdmin_Operator\" -GroupScope DomainLocal -PassThru\n$NonAdminHelpDeskGroup = New-ADGroup -Name \"JEA_NonAdmin_HelpDesk\" -GroupScope DomainLocal -PassThru\n$TestGroup = New-ADGroup -Name \"Test_Group\" -GroupScope DomainLocal -PassThru\n\n# Make Users\n$OperatorUser = New-ADUser -Name \"OperatorUser\" -AccountPassword (ConvertTo-SecureString 'pa$$w0rd' -AsPlainText -Force) -PassThru\nEnable-ADAccount -Identity $OperatorUser\n\n$HelpDeskUser = New-ADUser -name \"HelpDeskUser\" -AccountPassword (ConvertTo-SecureString 'pa$$w0rd' -AsPlainText -Force) -PassThru\nEnable-ADAccount -Identity $HelpDeskUser\n\n# Add Users to Groups\nAdd-ADGroupMember -Identity $NonAdminOperatorGroup -Members $OperatorUser\nAdd-ADGroupMember -Identity $NonAdminHelpDeskGroup -Members $HelpDeskUser\n```\n\n"}