{"nodes":[{"pos":[105,126],"content":"powershell,cmdlet,jea","needQuote":true,"nodes":[{"content":"powershell,cmdlet,jea","pos":[0,21]}]},{"pos":[156,172],"content":"reporting on jea","needQuote":true,"nodes":[{"content":"reporting on jea","pos":[0,16]}]},{"content":"Reporting on JEA","pos":[207,223]},{"content":"Because JEA allows non-privileged users to run in a privileged context, logging and auditing are extremely important.","pos":[224,341]},{"content":"In this section, we'll run through the tools you can use to help you with logging and reporting.","pos":[342,438],"source":"\nIn this section, we'll run through the tools you can use to help you with logging and reporting."},{"content":"Reporting on JEA Actions","pos":[443,467]},{"content":"Over-the-Shoulder Transcription","pos":[472,503]},{"content":"One of the quickest ways to get a summary of what's happening in a PowerShell session is to look over the shoulder of the person typing.","pos":[504,640]},{"content":"You see their commands, the output of those commands, and all is well.","pos":[641,711],"source":"\nYou see their commands, the output of those commands, and all is well."},{"content":"Or it's not, but at least you'll know.","pos":[712,750],"source":"\nOr it's not, but at least you'll know."},{"content":"PowerShell transcription is designed to give you a similar view after the fact.","pos":[751,830],"source":"\nPowerShell transcription is designed to give you a similar view after the fact."},{"content":"When using the \"TranscriptDirectory\" field in your Session Configuration, PowerShell will automatically record a transcript of all actions taken in a given session.","pos":[832,996]},{"content":"You can find transcripts from your sessions in this document here: \"$env:ProgramData\\JEAConfiguration\\Transcripts\"","pos":[997,1111],"source":"\nYou can find transcripts from your sessions in this document here: \"$env:ProgramData\\JEAConfiguration\\Transcripts\""},{"content":"As you can tell, the transcript records information about the \"Connected\" user, the \"Run As\" user, the commands run in the session, and more.","pos":[1113,1254]},{"content":"For more information about PowerShell transcription, check out <bpt id=\"p1\">[</bpt>this blog post<ept id=\"p1\">](http://blogs.msdn.com/b/powershell/archive/2015/06/09/powershell-the-blue-team.aspx)</ept>.","pos":[1255,1420],"source":"\nFor more information about PowerShell transcription, check out [this blog post](http://blogs.msdn.com/b/powershell/archive/2015/06/09/powershell-the-blue-team.aspx)."},{"content":"PowerShell Event Logs","pos":[1426,1447]},{"content":"When you have module logging turned on, all PowerShell actions are also recorded in regular Windows Event logs.","pos":[1448,1559]},{"content":"This is slightly messier to deal with when compared to transcripts, but the level of detail it gives you can be useful.","pos":[1560,1679],"source":"\nThis is slightly messier to deal with when compared to transcripts, but the level of detail it gives you can be useful."},{"content":"In the \"PowerShell\" operational log, Event ID 4104 will record each command invoked if you have enabled module logging.","pos":[1681,1800]},{"content":"Other Event Logs","pos":[1806,1822]},{"content":"Unlike PowerShell logs and transcripts, other logging mechanisms will not capture the \"Connected User\".","pos":[1823,1926]},{"content":"You will need to do some correlation between other logs and PowerShell logs to match up actions taken.","pos":[1927,2029],"source":"\nYou will need to do some correlation between other logs and PowerShell logs to match up actions taken."},{"content":"In the \"Windows Remote Management\" operational log, Event ID 193 will record the Connecting User's SID and Name, as well as the RunAs Virtual Account's SID to assist with this correlation.","pos":[2031,2219]},{"content":"You may have also noticed that the name of the RunAs Virtual Account includes the connecting user's domain and username at the end.","pos":[2220,2351],"source":"\nYou may have also noticed that the name of the RunAs Virtual Account includes the connecting user's domain and username at the end."},{"content":"Reporting on JEA Configuration","pos":[2356,2386]},{"content":"Get-PSSessionConfiguration","pos":[2391,2417]},{"content":"In order to accurately report on the state of your environment, it's important to know how many JEA endpoints you have set up on your machine.","pos":[2418,2560]},{"content":"<ph id=\"ph1\">`Get-PSSessionConfiguration`</ph> does just that.","pos":[2561,2605],"source":"`Get-PSSessionConfiguration` does just that."},{"content":"Get-PSSessionCapability","pos":[2611,2634]},{"content":"Manually reporting on the capabilities of any given user through a JEA endpoint can be quite complex.","pos":[2635,2736]},{"content":"You would potentially need to inspect several role capabilities.","pos":[2737,2801],"source":"\nYou would potentially need to inspect several role capabilities."},{"content":"Fortunately, the \"Get-PSSessionCapability\" cmdlet does this.","pos":[2802,2862],"source":"\nFortunately, the \"Get-PSSessionCapability\" cmdlet does this."},{"content":"To test this out, run the following command from an administrator PowerShell prompt:","pos":[2864,2948]}],"content":"---\ndescription:  \nmanager:  dongill\nms.topic:  article\nauthor:  jpjofre\nms.prod:  powershell\nkeywords:  powershell,cmdlet,jea\nms.date:  2016-06-22\ntitle:  reporting on jea\nms.technology:  powershell\n---\n\n# Reporting on JEA\nBecause JEA allows non-privileged users to run in a privileged context, logging and auditing are extremely important.\nIn this section, we'll run through the tools you can use to help you with logging and reporting.\n\n## Reporting on JEA Actions\n### Over-the-Shoulder Transcription\nOne of the quickest ways to get a summary of what's happening in a PowerShell session is to look over the shoulder of the person typing.\nYou see their commands, the output of those commands, and all is well.\nOr it's not, but at least you'll know.\nPowerShell transcription is designed to give you a similar view after the fact.\n\nWhen using the \"TranscriptDirectory\" field in your Session Configuration, PowerShell will automatically record a transcript of all actions taken in a given session.\nYou can find transcripts from your sessions in this document here: \"$env:ProgramData\\JEAConfiguration\\Transcripts\"\n\nAs you can tell, the transcript records information about the \"Connected\" user, the \"Run As\" user, the commands run in the session, and more.\nFor more information about PowerShell transcription, check out [this blog post](http://blogs.msdn.com/b/powershell/archive/2015/06/09/powershell-the-blue-team.aspx).\n\n### PowerShell Event Logs\nWhen you have module logging turned on, all PowerShell actions are also recorded in regular Windows Event logs.\nThis is slightly messier to deal with when compared to transcripts, but the level of detail it gives you can be useful.\n\nIn the \"PowerShell\" operational log, Event ID 4104 will record each command invoked if you have enabled module logging.\n\n### Other Event Logs\nUnlike PowerShell logs and transcripts, other logging mechanisms will not capture the \"Connected User\".\nYou will need to do some correlation between other logs and PowerShell logs to match up actions taken.\n\nIn the \"Windows Remote Management\" operational log, Event ID 193 will record the Connecting User's SID and Name, as well as the RunAs Virtual Account's SID to assist with this correlation.\nYou may have also noticed that the name of the RunAs Virtual Account includes the connecting user's domain and username at the end.\n\n## Reporting on JEA Configuration\n### Get-PSSessionConfiguration\nIn order to accurately report on the state of your environment, it's important to know how many JEA endpoints you have set up on your machine.\n`Get-PSSessionConfiguration` does just that.\n\n### Get-PSSessionCapability\nManually reporting on the capabilities of any given user through a JEA endpoint can be quite complex.\nYou would potentially need to inspect several role capabilities.\nFortunately, the \"Get-PSSessionCapability\" cmdlet does this.\n\nTo test this out, run the following command from an administrator PowerShell prompt:\n```PowerShell\nGet-PSSessionCapability -Username 'CONTOSO\\OperatorUser' -ConfigurationName JEADemo\n```\n\n"}