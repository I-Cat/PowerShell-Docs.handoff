{"nodes":[{"pos":[11,74],"content":"Configure certificate infrastructure for SCEP |Microsoft Intune","needQuote":true,"nodes":[{"content":"Configure certificate infrastructure for SCEP |Microsoft Intune","pos":[0,63]}]},{"pos":[88,156],"content":"Infrastructure for creating and deploying SCEP certificate profiles.","needQuote":true,"nodes":[{"content":"Infrastructure for creating and deploying SCEP certificate profiles.","pos":[0,68]}]},{"content":"Configure certificate infrastructure for SCEP","pos":[464,509]},{"content":"This topic describes what infrastructure you need in order to create and deploy SCEP certificate profiles.","pos":[510,616]},{"content":"On-premises infrastructure","pos":[622,648]},{"pos":[655,812],"content":"<bpt id=\"p1\">**</bpt>Active Directory domain<ept id=\"p1\">**</ept>: All servers listed in this section (except for the Web Application Proxy Server) must be joined to your Active Directory domain.","source":"**Active Directory domain**: All servers listed in this section (except for the Web Application Proxy Server) must be joined to your Active Directory domain."},{"pos":[817,1288],"content":"**Certification Authority** (CA): An Enterprise Certification Authority (CA) that runs on an Enterprise edition of Windows Server 2008 R2 or later. A Standalone CA is not supported. For instructions on how to set up a Certification Authority, see [Install the Certification Authority](http://technet.microsoft.com/library/jj125375.aspx).\n If your CA runs Windows Server 2008 R2, you must [install the hotfix from KB2483564](http://support.microsoft.com/kb/2483564/).\nI","leadings":["","   ",""],"nodes":[{"content":"<bpt id=\"p1\">**</bpt>Certification Authority<ept id=\"p1\">**</ept> (CA): An Enterprise Certification Authority (CA) that runs on an Enterprise edition of Windows Server 2008 R2 or later.","pos":[0,147],"source":"**Certification Authority** (CA): An Enterprise Certification Authority (CA) that runs on an Enterprise edition of Windows Server 2008 R2 or later."},{"content":"A Standalone CA is not supported.","pos":[148,181]},{"content":"For instructions on how to set up a Certification Authority, see <bpt id=\"p1\">[</bpt>Install the Certification Authority<ept id=\"p1\">](http://technet.microsoft.com/library/jj125375.aspx)</ept>.","pos":[182,337],"source":" For instructions on how to set up a Certification Authority, see [Install the Certification Authority](http://technet.microsoft.com/library/jj125375.aspx)."},{"content":"If your CA runs Windows Server 2008 R2, you must <bpt id=\"p1\">[</bpt>install the hotfix from KB2483564<ept id=\"p1\">](http://support.microsoft.com/kb/2483564/)</ept>.","pos":[339,466],"source":" If your CA runs Windows Server 2008 R2, you must [install the hotfix from KB2483564](http://support.microsoft.com/kb/2483564/)."},{"content":"I","pos":[467,468]}]},{"content":"<bpt id=\"p1\">**</bpt>NDES Server<ept id=\"p1\">**</ept>: On a server that runs Windows Server 2012 R2 or later, you must setup up the Network Device Enrollment Service (NDES).","pos":[1292,1427],"source":"**NDES Server**: On a server that runs Windows Server 2012 R2 or later, you must setup up the Network Device Enrollment Service (NDES)."},{"content":"Intune does not support using NDES when it runs on a server that also runs the Enterprise CA.","pos":[1428,1521]},{"content":"See <bpt id=\"p1\">[</bpt>Network Device Enrollment Service Guidance<ept id=\"p1\">](http://technet.microsoft.com/library/hh831498.aspx)</ept> for instructions on how to configure Windows Server 2012 R2 to host the Network Device Enrollment Service.","pos":[1522,1729],"source":" See [Network Device Enrollment Service Guidance](http://technet.microsoft.com/library/hh831498.aspx) for instructions on how to configure Windows Server 2012 R2 to host the Network Device Enrollment Service."},{"content":"The NDES server must be domain joined to the domain that hosts the CA, and not be on the same server as the CA.","pos":[1730,1841]},{"content":"More information about deploying the NDES server in a separate forest, isolated network or internal domain can be found in <bpt id=\"p1\">[</bpt>Using a Policy Module with the Network Device Enrollment Service<ept id=\"p1\">](https://technet.microsoft.com/en-us/library/dn473016.aspx)</ept>.","pos":[1842,2091],"source":" More information about deploying the NDES server in a separate forest, isolated network or internal domain can be found in [Using a Policy Module with the Network Device Enrollment Service](https://technet.microsoft.com/en-us/library/dn473016.aspx)."},{"content":"<bpt id=\"p1\">**</bpt>Microsoft Intune Certificate Connector<ept id=\"p1\">**</ept>: You use the Intune admin console to download the <bpt id=\"p2\">**</bpt>Certificate Connector<ept id=\"p2\">**</ept> installer (<bpt id=\"p3\">**</bpt>ndesconnectorssetup.exe<ept id=\"p3\">**</ept>).","pos":[2096,2255],"source":"**Microsoft Intune Certificate Connector**: You use the Intune admin console to download the **Certificate Connector** installer (**ndesconnectorssetup.exe**)."},{"content":"Then you can run <bpt id=\"p1\">**</bpt>ndesconnectorssetup.exe<ept id=\"p1\">**</ept> on the computer where you want to install the Certificate Connector.","pos":[2256,2369],"source":" Then you can run **ndesconnectorssetup.exe** on the computer where you want to install the Certificate Connector."},{"content":"<bpt id=\"p1\">**</bpt>Web Application Proxy Server<ept id=\"p1\">**</ept> (optional): You can use a server that runs Windows Server 2012 R2  or later as a Web Application Proxy (WAP) server.","pos":[2373,2522],"source":"**Web Application Proxy Server** (optional): You can use a server that runs Windows Server 2012 R2  or later as a Web Application Proxy (WAP) server."},{"content":"This configuration:","pos":[2523,2542]},{"content":"Allows devices to receive certificates using an Internet connection.","pos":[2550,2618]},{"content":"Is a security recommendation when devices connect through the Internet to receive and renew certificates.","pos":[2626,2731]},{"content":"The server that hosts WAP <bpt id=\"p1\">[</bpt>must install an update<ept id=\"p1\">](http://blogs.technet.com/b/ems/archive/2014/12/11/hotfix-large-uri-request-in-web-application-proxy-on-windows-server-2012-r2.aspx)</ept> that enables support for the long URLs that are used by the Network Device Enrollment Service.","pos":[2762,3039],"source":"The server that hosts WAP [must install an update](http://blogs.technet.com/b/ems/archive/2014/12/11/hotfix-large-uri-request-in-web-application-proxy-on-windows-server-2012-r2.aspx) that enables support for the long URLs that are used by the Network Device Enrollment Service."},{"content":"This update is included with the <bpt id=\"p1\">[</bpt>December 2014 update rollup<ept id=\"p1\">](http://support.microsoft.com/kb/3013769)</ept>, or individually from <bpt id=\"p2\">[</bpt>KB3011135<ept id=\"p2\">](http://support.microsoft.com/kb/3011135)</ept>.","pos":[3040,3219],"source":" This update is included with the [December 2014 update rollup](http://support.microsoft.com/kb/3013769), or individually from [KB3011135](http://support.microsoft.com/kb/3011135)."},{"pos":[3224,3894],"content":"Also, the server that hosts WAP must have a SSL certificate that matches the name being published to external clients as well as trust the SSL certificate that is used on the NDES server. These certificates enable the WAP server to terminate the SSL connection from clients, and create a new SSL connection to the NDES server.\n For information about certificates for WAP, see the **Plan certificates** section of [Planning to Publish Applications Using Web Application Proxy](https://technet.microsoft.com/library/dn383650.aspx). For general information about WAP servers, see [Working with Web Application Proxy](http://technet.microsoft.com/library/dn584113.aspx).|","leadings":["","   "],"nodes":[{"content":"Also, the server that hosts WAP must have a SSL certificate that matches the name being published to external clients as well as trust the SSL certificate that is used on the NDES server.","pos":[0,187]},{"content":"These certificates enable the WAP server to terminate the SSL connection from clients, and create a new SSL connection to the NDES server.","pos":[188,326]},{"content":"For information about certificates for WAP, see the <bpt id=\"p1\">**</bpt>Plan certificates<ept id=\"p1\">**</ept> section of <bpt id=\"p2\">[</bpt>Planning to Publish Applications Using Web Application Proxy<ept id=\"p2\">](https://technet.microsoft.com/library/dn383650.aspx)</ept>.","pos":[328,529],"source":" For information about certificates for WAP, see the **Plan certificates** section of [Planning to Publish Applications Using Web Application Proxy](https://technet.microsoft.com/library/dn383650.aspx)."},{"content":"For general information about WAP servers, see <bpt id=\"p1\">[</bpt>Working with Web Application Proxy<ept id=\"p1\">](http://technet.microsoft.com/library/dn584113.aspx)</ept>.|","pos":[530,667],"source":" For general information about WAP servers, see [Working with Web Application Proxy](http://technet.microsoft.com/library/dn584113.aspx).|"}]},{"content":"Network requirements","pos":[3900,3920]},{"content":"From the Internet to perimeter network, allow port 443 from all hosts/IP addressess on the internet to the NDES server.","pos":[3922,4041]},{"content":"From the perimeter network to trusted network, allow all ports and protocols needed for domain access on the domain-joined NDES server.","pos":[4043,4178]},{"content":"The NDES server needs access to the certificate servers, DNS servers, Configuration Manager servers and domain controllers.","pos":[4179,4302]},{"pos":[4304,4607],"content":"We recommend publishing the NDES server through a proxy, such as the <bpt id=\"p1\">[</bpt>Azure AD application proxy<ept id=\"p1\">](https://azure.microsoft.com/en-us/documentation/articles/active-directory-application-proxy-publish/)</ept>, <bpt id=\"p2\">[</bpt>Web Access Proxy<ept id=\"p2\">](https://technet.microsoft.com/en-us/library/dn584107.aspx)</ept>, or a third-party proxy.","source":"We recommend publishing the NDES server through a proxy, such as the [Azure AD application proxy](https://azure.microsoft.com/en-us/documentation/articles/active-directory-application-proxy-publish/), [Web Access Proxy](https://technet.microsoft.com/en-us/library/dn584107.aspx), or a third-party proxy."},{"pos":[4614,4677],"content":"<ph id=\"ph1\">&lt;a name=\"BKMK_CertsAndTemplates\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Certificates and Templates","source":"<a name=\"BKMK_CertsAndTemplates\"></a>Certificates and Templates"},{"content":"Object","pos":[4680,4686]},{"content":"Details","pos":[4687,4694]},{"pos":[4722,4746],"content":"<bpt id=\"p1\">**</bpt>Certificate Template<ept id=\"p1\">**</ept>","source":"**Certificate Template**"},{"content":"You configure this template on your issuing CA.","pos":[4747,4794]},{"pos":[4797,4834],"content":"<bpt id=\"p1\">**</bpt>Client authentication certificate<ept id=\"p1\">**</ept>","source":"**Client authentication certificate**"},{"content":"Requested from your issuing CA or public CA, you install this certificate on the NDES Server.","pos":[4835,4928]},{"pos":[4931,4968],"content":"<bpt id=\"p1\">**</bpt>Server authentication certificate<ept id=\"p1\">**</ept>","source":"**Server authentication certificate**"},{"content":"Requested from your issuing CA or public CA, you install and bind this SSL certificate in IIS on the NDES server.","pos":[4969,5082]},{"pos":[5085,5116],"content":"<bpt id=\"p1\">**</bpt>Trusted Root CA certificate<ept id=\"p1\">**</ept>","source":"**Trusted Root CA certificate**"},{"content":"You export this as a <bpt id=\"p1\">**</bpt>.cer<ept id=\"p1\">**</ept> file from the root CA or any device which trusts the root CA, and deploy it to devices by using the Trusted CA certificate profile.","pos":[5117,5278],"source":"You export this as a **.cer** file from the root CA or any device which trusts the root CA, and deploy it to devices by using the Trusted CA certificate profile."},{"content":"You use a single Trusted Root CA certificate per operating system platform, and associate it with each Trusted Root Certificate profile you create.","pos":[5290,5437]},{"content":"You can use additional Trusted Root CA certificates when needed.","pos":[5449,5513]},{"content":"For example, you might do this to provide a trust to a CA that signs the server authentication certificates for your Wi-Fi access points.","pos":[5514,5651]},{"pos":[5658,5694],"content":"<ph id=\"ph1\">&lt;a name=\"BKMK_Accounts\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Accounts","source":"<a name=\"BKMK_Accounts\"></a>Accounts"},{"content":"Name","pos":[5697,5701]},{"content":"Details","pos":[5702,5709]},{"pos":[5735,5759],"content":"<bpt id=\"p1\">**</bpt>NDES service account<ept id=\"p1\">**</ept>","source":"**NDES service account**"},{"content":"You specify a domain user account to use as the NDES Service account.","pos":[5760,5829]},{"pos":[5835,5907],"content":"<ph id=\"ph1\">&lt;a name=\"BKMK_ConfigureInfrastructure\"&gt;</ph><ph id=\"ph2\">&lt;/a&gt;</ph>Configure your infrastructure","source":"<a name=\"BKMK_ConfigureInfrastructure\"></a>Configure your infrastructure"},{"content":"Before you can configure certificate profiles you must complete the following tasks, which require knowledge of Windows Server 2012 R2 and Active Directory Certificate Services (ADCS):","pos":[5908,6092]},{"pos":[6094,6136],"content":"<bpt id=\"p1\">**</bpt>Task 1<ept id=\"p1\">**</ept>: Create an NDES service account","source":"**Task 1**: Create an NDES service account"},{"pos":[6138,6212],"content":"<bpt id=\"p1\">**</bpt>Task 2<ept id=\"p1\">**</ept>: Configure certificate templates on the certification authority","source":"**Task 2**: Configure certificate templates on the certification authority"},{"pos":[6214,6268],"content":"<bpt id=\"p1\">**</bpt>Task 3<ept id=\"p1\">**</ept>: Configure prerequisites on the NDES server","source":"**Task 3**: Configure prerequisites on the NDES server"},{"pos":[6270,6316],"content":"<bpt id=\"p1\">**</bpt>Task 4<ept id=\"p1\">**</ept>: Configure NDES for use with Intune","source":"**Task 4**: Configure NDES for use with Intune"},{"pos":[6318,6393],"content":"<bpt id=\"p1\">**</bpt>Task 5<ept id=\"p1\">**</ept>: Enable, install, and configure the Intune Certificate Connector","source":"**Task 5**: Enable, install, and configure the Intune Certificate Connector"},{"content":"Task 1 - Create an NDES service account","pos":[6399,6438]},{"content":"Create a domain user account to use as the NDES service account.","pos":[6440,6504]},{"content":"You will specify this account when you configure templates on the issuing CA before you install and configure NDES.","pos":[6505,6620]},{"content":"Make sure the user has the default rights, <bpt id=\"p1\">**</bpt>Logon Localy<ept id=\"p1\">**</ept>, <bpt id=\"p2\">**</bpt>Logon as a Service<ept id=\"p2\">**</ept> and <bpt id=\"p3\">**</bpt>Logon as a batch job<ept id=\"p3\">**</ept> rights.","pos":[6621,6741],"source":" Make sure the user has the default rights, **Logon Localy**, **Logon as a Service** and **Logon as a batch job** rights."},{"content":"Some organizations have hardening policies that disable those rights.","pos":[6742,6811]},{"content":"Task 2 - Configure certificate templates on the certification authority","pos":[6820,6891]},{"content":"In this task you will:","pos":[6892,6914]},{"content":"Configure a certificate template for NDES","pos":[6920,6961]},{"content":"Publish the certificate template for NDES","pos":[6967,7008]},{"content":"To configure the certification authority","pos":[7016,7056]},{"content":"Log on as an enterprise administrator.","pos":[7062,7100]},{"content":"On the issuing CA, use the Certificate Templates snap-in to create a new custom template or copy an existing template and then edit an existing template (like the User template), for use with NDES.","pos":[7107,7304]},{"content":"The template must have the following configurations:","pos":[7310,7362]},{"pos":[7372,7434],"content":"Specify a friendly <bpt id=\"p1\">**</bpt>Template display name<ept id=\"p1\">**</ept> for the template.","source":"Specify a friendly **Template display name** for the template."},{"content":"On the <bpt id=\"p1\">**</bpt>Subject Name<ept id=\"p1\">**</ept> tab, select <bpt id=\"p2\">**</bpt>Supply in the request<ept id=\"p2\">**</ept>.","pos":[7444,7506],"source":"On the **Subject Name** tab, select **Supply in the request**."},{"content":"(Security is enforced by the Intune policy module for NDES).","pos":[7507,7567]},{"pos":[7577,7690],"content":"On the <bpt id=\"p1\">**</bpt>Extensions<ept id=\"p1\">**</ept> tab, ensure the <bpt id=\"p2\">**</bpt>Description of Application Policies<ept id=\"p2\">**</ept> includes <bpt id=\"p3\">**</bpt>Client Authentication<ept id=\"p3\">**</ept>.","source":"On the **Extensions** tab, ensure the **Description of Application Policies** includes **Client Authentication**."},{"pos":[7702,7875],"content":"[!IMPORTANT]\nFor iOS and Mac OS X certificate templates, on the **Extensions** tab, edit **Key Usage** and ensure **Signature is proof of origin** is not selected.","leadings":["","        > "],"nodes":[{"content":"For iOS and Mac OS X certificate templates, on the <bpt id=\"p1\">**</bpt>Extensions<ept id=\"p1\">**</ept> tab, edit <bpt id=\"p2\">**</bpt>Key Usage<ept id=\"p2\">**</ept> and ensure <bpt id=\"p3\">**</bpt>Signature is proof of origin<ept id=\"p3\">**</ept> is not selected.","pos":[13,163],"source":"For iOS and Mac OS X certificate templates, on the **Extensions** tab, edit **Key Usage** and ensure **Signature is proof of origin** is not selected."}]},{"content":"On the <bpt id=\"p1\">**</bpt>Security<ept id=\"p1\">**</ept> tab, add the NDES service account, and give it <bpt id=\"p2\">**</bpt>Enroll<ept id=\"p2\">**</ept> permissions to the template.","pos":[7885,7991],"source":"On the **Security** tab, add the NDES service account, and give it **Enroll** permissions to the template."},{"content":"Intune admins who will create SCEP profiles require <bpt id=\"p1\">**</bpt>Read<ept id=\"p1\">**</ept> rights so that they can browse to the template when creating SCEP profiles.","pos":[7992,8128],"source":" Intune admins who will create SCEP profiles require **Read** rights so that they can browse to the template when creating SCEP profiles."},{"pos":[8140,8307],"content":"[!NOTE]\nTo revoke certificates the NDES service account needs *Issue and Manage Certificates* rights for each certificate template used by a certificate profile.","leadings":["","    > "],"nodes":[{"content":"To revoke certificates the NDES service account needs <bpt id=\"p1\">*</bpt>Issue and Manage Certificates<ept id=\"p1\">*</ept> rights for each certificate template used by a certificate profile.","pos":[8,161],"source":"To revoke certificates the NDES service account needs *Issue and Manage Certificates* rights for each certificate template used by a certificate profile."}]},{"content":"Review the <bpt id=\"p1\">**</bpt>Validity period<ept id=\"p1\">**</ept> on the <bpt id=\"p2\">**</bpt>General<ept id=\"p2\">**</ept> tab of the template.","pos":[8313,8383],"source":"Review the **Validity period** on the **General** tab of the template."},{"content":"By default, Intune uses the value configured in the template.","pos":[8384,8445]},{"content":"However, you have the option to configure the CA to allow the requester to specify a different value, which you can then set from within the Intune Administrator console.","pos":[8446,8616]},{"content":"If you want to always use the value in the template, skip the remainder of this step.","pos":[8617,8702]},{"pos":[8710,8846],"content":"[!IMPORTANT]\nThe iOS and Mac OS X platforms always uses the value set in the template regardless of other configurations you make.","leadings":["","    > "],"nodes":[{"content":"The iOS and Mac OS X platforms always uses the value set in the template regardless of other configurations you make.","pos":[13,130]}]},{"content":"Here are screenshots of an example template configuration.","pos":[8848,8906]},{"content":"Template, request handling tab","pos":[8910,8940]},{"content":"Template, subject name tab","pos":[8987,9013]},{"content":"Template, security tab","pos":[9056,9078]},{"content":"Template, extensions tab","pos":[9117,9141]},{"content":"Template, issuance requirements tab","pos":[9182,9217]},{"pos":[9263,9423],"content":"[!IMPORTANT]\nFor Application Policies (in the 4th screenshot), only add the application policies required. Confirm your choices with your security admins.","leadings":["","    > "],"nodes":[{"content":"For Application Policies (in the 4th screenshot), only add the application policies required. Confirm your choices with your security admins.","pos":[13,154],"nodes":[{"content":"For Application Policies (in the 4th screenshot), only add the application policies required.","pos":[0,93]},{"content":"Confirm your choices with your security admins.","pos":[94,141]}]}]},{"content":"To configure the CA to allow the requester to specify the validity period, on the CA run the following commands:","pos":[9430,9542]},{"pos":[9551,9612],"content":"<bpt id=\"p1\">**</bpt>certutil -setreg Policy\\EditFlags +EDITF_ATTRIBUTEENDDATE<ept id=\"p1\">**</ept>","source":"**certutil -setreg Policy\\EditFlags +EDITF_ATTRIBUTEENDDATE**"},{"pos":[9620,9640],"content":"<bpt id=\"p1\">**</bpt>net stop certsvc<ept id=\"p1\">**</ept>","source":"**net stop certsvc**"},{"pos":[9649,9670],"content":"<bpt id=\"p1\">**</bpt>net start certsvc<ept id=\"p1\">**</ept>","source":"**net start certsvc**"},{"content":"On the issuing CA, use the Certification Authority snap-in to publish the certificate template.","pos":[9676,9771]},{"pos":[9781,9945],"content":"Select the <bpt id=\"p1\">**</bpt>Certificate Templates<ept id=\"p1\">**</ept> node, click <bpt id=\"p2\">**</bpt>Action<ept id=\"p2\">**</ept><ph id=\"ph1\">-</ph><ph id=\"ph2\">&amp;gt;</ph> <bpt id=\"p3\">**</bpt>New<ept id=\"p3\">**</ept> <ph id=\"ph3\">&amp;gt;</ph> <bpt id=\"p4\">**</bpt>Certificate Template to Issue<ept id=\"p4\">**</ept>, and then select the template you created in step 2.","source":"Select the **Certificate Templates** node, click **Action**-&gt; **New** &gt; **Certificate Template to Issue**, and then select the template you created in step 2."},{"pos":[9955,10049],"content":"Validate that the template published by viewing it under the <bpt id=\"p1\">**</bpt>Certificate Templates<ept id=\"p1\">**</ept> folder.","source":"Validate that the template published by viewing it under the **Certificate Templates** folder."},{"content":"Task 3 - Configure prerequisites on the NDES server","pos":[10056,10107]},{"content":"In this task you will:","pos":[10108,10130]},{"content":"Add NDES to a Windows Server and configure IIS to support NDES","pos":[10136,10198]},{"content":"Add the NDES Service account to the IIS_IUSR group","pos":[10204,10254]},{"content":"Set the SPN for the NDES Service account","pos":[10260,10300]},{"pos":[10312,10520],"content":"On the server that will hosts NDES, you must log on as a an <bpt id=\"p1\">**</bpt>Enterprise Administrator<ept id=\"p1\">**</ept>, and then use the <bpt id=\"p2\">[</bpt>Add Roles and Features Wizard<ept id=\"p2\">](https://technet.microsoft.com/library/hh831809.aspx)</ept> to install NDES:","source":"On the server that will hosts NDES, you must log on as a an **Enterprise Administrator**, and then use the [Add Roles and Features Wizard](https://technet.microsoft.com/library/hh831809.aspx) to install NDES:"},{"content":"In the Wizard, select <bpt id=\"p1\">**</bpt>Active Directory Certificate Services<ept id=\"p1\">**</ept> to gain access to the AD CS Role Services.","pos":[10530,10636],"source":"In the Wizard, select **Active Directory Certificate Services** to gain access to the AD CS Role Services."},{"content":"Select the <bpt id=\"p1\">**</bpt>Network Device Enrollment Service<ept id=\"p1\">**</ept>, uncheck <bpt id=\"p2\">**</bpt>Certification Authority<ept id=\"p2\">**</ept>, and then complete the wizard.","pos":[10637,10753],"source":" Select the **Network Device Enrollment Service**, uncheck **Certification Authority**, and then complete the wizard."},{"pos":[10765,11125],"content":"[!TIP]\nOn the **Installation progress** page of the wizard, do not click **Close**. Instead, click the link for **Configure Active Directory Certificate Services on the destination server**. This opens the **AD CS Configuration** wizard that you use for the next task. After AD CS Configuration opens, you can close the Add Roles and Features wizard.","leadings":["","        > "],"nodes":[{"content":"On the **Installation progress** page of the wizard, do not click **Close**. Instead, click the link for **Configure Active Directory Certificate Services on the destination server**. This opens the **AD CS Configuration** wizard that you use for the next task. After AD CS Configuration opens, you can close the Add Roles and Features wizard.","pos":[7,350],"nodes":[{"content":"On the <bpt id=\"p1\">**</bpt>Installation progress<ept id=\"p1\">**</ept> page of the wizard, do not click <bpt id=\"p2\">**</bpt>Close<ept id=\"p2\">**</ept>.","pos":[0,76],"source":"On the **Installation progress** page of the wizard, do not click **Close**."},{"content":"Instead, click the link for <bpt id=\"p1\">**</bpt>Configure Active Directory Certificate Services on the destination server<ept id=\"p1\">**</ept>.","pos":[77,183],"source":" Instead, click the link for **Configure Active Directory Certificate Services on the destination server**."},{"content":"This opens the <bpt id=\"p1\">**</bpt>AD CS Configuration<ept id=\"p1\">**</ept> wizard that you use for the next task.","pos":[184,261],"source":" This opens the **AD CS Configuration** wizard that you use for the next task."},{"content":"After AD CS Configuration opens, you can close the Add Roles and Features wizard.","pos":[262,343]}]}]},{"content":"When NDES is added to the server, the wizard also installs IIS.","pos":[11135,11198]},{"content":"Ensure IIS has the following configurations:","pos":[11199,11243]},{"pos":[11257,11316],"content":"<bpt id=\"p1\">**</bpt>Web Server<ept id=\"p1\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p2\">**</bpt>Security<ept id=\"p2\">**</ept> <ph id=\"ph2\">&amp;gt;</ph> <bpt id=\"p3\">**</bpt>Request Filtering<ept id=\"p3\">**</ept>","source":"**Web Server** &gt; **Security** &gt; **Request Filtering**"},{"content":"<bpt id=\"p1\">**</bpt>Web Server<ept id=\"p1\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p2\">**</bpt>Application Development<ept id=\"p2\">**</ept> <ph id=\"ph2\">&amp;gt;</ph> <bpt id=\"p3\">**</bpt>ASP.NET 3.5<ept id=\"p3\">**</ept>.","pos":[11330,11399],"source":"**Web Server** &gt; **Application Development** &gt; **ASP.NET 3.5**."},{"content":"Installing ASP.NET 3.5 will install .NET Framework 3.5.","pos":[11400,11455]},{"content":"When installing .NET Framework 3.5, install both the core <bpt id=\"p1\">**</bpt>.NET Framework 3.5<ept id=\"p1\">**</ept> feature and <bpt id=\"p2\">**</bpt>HTTP Activation<ept id=\"p2\">**</ept>.","pos":[11456,11569],"source":" When installing .NET Framework 3.5, install both the core **.NET Framework 3.5** feature and **HTTP Activation**."},{"content":"<bpt id=\"p1\">**</bpt>Web Server<ept id=\"p1\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p2\">**</bpt>Application Development<ept id=\"p2\">**</ept> <ph id=\"ph2\">&amp;gt;</ph> <bpt id=\"p3\">**</bpt>ASP.NET 4.5<ept id=\"p3\">**</ept>.","pos":[11583,11652],"source":"**Web Server** &gt; **Application Development** &gt; **ASP.NET 4.5**."},{"content":"Installing ASP.NET 4.5 will install .NET Framework 4.5.","pos":[11653,11708]},{"content":"When installing .NET Framework 4.5, install the core <bpt id=\"p1\">**</bpt>.NET Framework 4.5<ept id=\"p1\">**</ept> feature, <bpt id=\"p2\">**</bpt>ASP.NET 4.5<ept id=\"p2\">**</ept>, and the <bpt id=\"p3\">**</bpt>WCF Services<ept id=\"p3\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p4\">**</bpt>HTTP Activation<ept id=\"p4\">**</ept> feature.","pos":[11709,11869],"source":" When installing .NET Framework 4.5, install the core **.NET Framework 4.5** feature, **ASP.NET 4.5**, and the **WCF Services** &gt; **HTTP Activation** feature."},{"pos":[11883,11981],"content":"<bpt id=\"p1\">**</bpt>Management Tools<ept id=\"p1\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p2\">**</bpt>IIS 6 Management Compatibility<ept id=\"p2\">**</ept> <ph id=\"ph2\">&amp;gt;</ph> <bpt id=\"p3\">**</bpt>IIS 6 Metabase Compatibility<ept id=\"p3\">**</ept>","source":"**Management Tools** &gt; **IIS 6 Management Compatibility** &gt; **IIS 6 Metabase Compatibility**"},{"pos":[11995,12088],"content":"<bpt id=\"p1\">**</bpt>Management Tools<ept id=\"p1\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p2\">**</bpt>IIS 6 Management Compatibility<ept id=\"p2\">**</ept> <ph id=\"ph2\">&amp;gt;</ph> <bpt id=\"p3\">**</bpt>IIS 6 WMI Compatibility<ept id=\"p3\">**</ept>","source":"**Management Tools** &gt; **IIS 6 Management Compatibility** &gt; **IIS 6 WMI Compatibility**"},{"pos":[12096,12178],"content":"On the server, add the NDES service account as a member of the <bpt id=\"p1\">**</bpt>IIS_IUSR<ept id=\"p1\">**</ept> group.","source":"On the server, add the NDES service account as a member of the **IIS_IUSR** group."},{"content":"In an elevated command prompt, run the following command to set the SPN of the NDES Service account:","pos":[12187,12287]},{"pos":[12400,12536],"content":"For example, if your NDES Server is named <bpt id=\"p1\">**</bpt>Server01<ept id=\"p1\">**</ept>, your domain is <bpt id=\"p2\">**</bpt>Contoso.com<ept id=\"p2\">**</ept>, and the service account is <bpt id=\"p3\">**</bpt>NDESService<ept id=\"p3\">**</ept>, use:","source":"For example, if your NDES Server is named **Server01**, your domain is **Contoso.com**, and the service account is **NDESService**, use:"},{"content":"Task 4 - Configure NDES for use with Intune","pos":[12605,12648]},{"content":"In this task you will:","pos":[12649,12671]},{"content":"Configure NDES for use with the issuing CA","pos":[12677,12719]},{"content":"Bind the server authentication (SSL) certificate in IIS","pos":[12725,12780]},{"content":"Configure Request Filtering in IIS","pos":[12786,12820]},{"content":"To configure NDES for use with Intune","pos":[12828,12865]},{"content":"On the NDES Server, open the AD CS Configuration wizard and then make the following configurations.","pos":[12871,12970]},{"pos":[12978,13183],"content":"[!TIP]\nIf you clicked the link in the previous task, this wizard is already open. Otherwise, open Server Manager to access the post-deployment configuration for Active Directory Certificate Services.","leadings":["","    > "],"nodes":[{"content":"If you clicked the link in the previous task, this wizard is already open. Otherwise, open Server Manager to access the post-deployment configuration for Active Directory Certificate Services.","pos":[7,199],"nodes":[{"content":"If you clicked the link in the previous task, this wizard is already open.","pos":[0,74]},{"content":"Otherwise, open Server Manager to access the post-deployment configuration for Active Directory Certificate Services.","pos":[75,192]}]}]},{"pos":[13193,13273],"content":"On the <bpt id=\"p1\">**</bpt>Role Services<ept id=\"p1\">**</ept> Page, select the <bpt id=\"p2\">**</bpt>Network Device Enrollment Service<ept id=\"p2\">**</ept>.","source":"On the **Role Services** Page, select the **Network Device Enrollment Service**."},{"pos":[13283,13358],"content":"On the <bpt id=\"p1\">**</bpt>Service Account for NDES<ept id=\"p1\">**</ept> page, specify the NDES Service Account.","source":"On the **Service Account for NDES** page, specify the NDES Service Account."},{"pos":[13368,13492],"content":"On the <bpt id=\"p1\">**</bpt>CA for NDES<ept id=\"p1\">**</ept> page, click <bpt id=\"p2\">**</bpt>Select<ept id=\"p2\">**</ept>, and then select the issuing CA where you configured the certificate template.","source":"On the **CA for NDES** page, click **Select**, and then select the issuing CA where you configured the certificate template."},{"pos":[13502,13594],"content":"On the <bpt id=\"p1\">**</bpt>Cryptography for NDES<ept id=\"p1\">**</ept> page, set the key length to meet your company requirements.","source":"On the **Cryptography for NDES** page, set the key length to meet your company requirements."},{"pos":[13600,13673],"content":"On the <bpt id=\"p1\">**</bpt>Confirmation<ept id=\"p1\">**</ept> page, click <bpt id=\"p2\">**</bpt>Configure<ept id=\"p2\">**</ept> to complete the wizard.","source":"On the **Confirmation** page, click **Configure** to complete the wizard."},{"content":"After the wizard completes, edit the following registry key on the NDES Server:","pos":[13679,13758]},{"pos":[13768,13829],"content":"<ph id=\"ph1\">*</ph><bpt id=\"p1\">*</bpt>HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Cryptography\\MSCEP\\*<ept id=\"p1\">*</ept>","source":"**HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Cryptography\\MSCEP\\**"},{"content":"To edit this key, identify the certificate template's <bpt id=\"p1\">**</bpt>Purpose<ept id=\"p1\">**</ept>, as found on its <bpt id=\"p2\">**</bpt>Request Handling<ept id=\"p2\">**</ept> tab, and then edit the corresponding entry in the registry by replacing the existing data with the name of the certificate template (not the display name of the template) that you specified in Task 1.","pos":[13835,14139],"source":"To edit this key, identify the certificate template's **Purpose**, as found on its **Request Handling** tab, and then edit the corresponding entry in the registry by replacing the existing data with the name of the certificate template (not the display name of the template) that you specified in Task 1."},{"content":"The following table maps the certificate template purpose to the values in the registry:","pos":[14140,14228]},{"content":"Certificate template Purpose (On the Request Handling tab)","pos":[14235,14293]},{"content":"Registry value to edit","pos":[14294,14316]},{"content":"Value seen in the Intune admin console for the SCEP profile","pos":[14317,14376]},{"content":"Signature","pos":[14588,14597]},{"content":"SignatureTemplate","pos":[14598,14615]},{"content":"Digital Signature","pos":[14616,14633]},{"content":"Encryption","pos":[14640,14650]},{"content":"EncryptionTemplate","pos":[14651,14669]},{"content":"Key Encipherment","pos":[14670,14686]},{"content":"Signature and encryption","pos":[14693,14717]},{"content":"GeneralPurposeTemplate","pos":[14718,14740]},{"content":"Key Encipherment","pos":[14741,14757]},{"content":"Digital Signature","pos":[14769,14786]},{"pos":[14792,14955],"content":"For example, if the Purpose of your certificate template is <bpt id=\"p1\">**</bpt>Encryption<ept id=\"p1\">**</ept>, then edit the <bpt id=\"p2\">**</bpt>EncryptionTemplate<ept id=\"p2\">**</ept> value to be the name of your certificate template.","source":"For example, if the Purpose of your certificate template is **Encryption**, then edit the **EncryptionTemplate** value to be the name of your certificate template."},{"content":"The NDES server will receive very long URL’s (queries), which require that you add two registry entries:","pos":[14960,15064]},{"content":"Location","pos":[15071,15079]},{"content":"Value","pos":[15080,15085]},{"content":"Type","pos":[15086,15090]},{"content":"Data","pos":[15091,15095]},{"content":"HKLM\\SYSTEM\\CurrentControlSet\\Services\\HTTP\\Parameters","pos":[15132,15186]},{"content":"MaxFieldLength","pos":[15187,15201]},{"content":"DWORD","pos":[15202,15207]},{"content":"65534 (decimal)","pos":[15208,15223]},{"content":"HKLM\\SYSTEM\\CurrentControlSet\\Services\\HTTP\\Parameters","pos":[15230,15284]},{"content":"MaxRequestBytes","pos":[15285,15300]},{"content":"DWORD","pos":[15301,15306]},{"content":"65534 (decimal)","pos":[15307,15322]},{"pos":[15329,15515],"content":"In IIS manager, choose <bpt id=\"p1\">**</bpt>Default Web Site<ept id=\"p1\">**</ept><ph id=\"ph1\"> -&gt; </ph><bpt id=\"p2\">**</bpt>Request Filtering<ept id=\"p2\">**</ept><ph id=\"ph2\"> -&gt; </ph><bpt id=\"p3\">**</bpt>Edit Feature Setting<ept id=\"p3\">**</ept>, and change the <bpt id=\"p4\">**</bpt>Maximum URL length<ept id=\"p4\">**</ept> and <bpt id=\"p5\">**</bpt>Maximum query string<ept id=\"p5\">**</ept> to <bpt id=\"p6\">*</bpt>65534<ept id=\"p6\">*</ept>, as shown.","source":"In IIS manager, choose **Default Web Site** -> **Request Filtering** -> **Edit Feature Setting**, and change the **Maximum URL length** and **Maximum query string** to *65534*, as shown."},{"content":"IIS max URL and query length","pos":[15523,15551]},{"content":"Restart the server.","pos":[15590,15609]},{"content":"Running <bpt id=\"p1\">**</bpt>iisreset<ept id=\"p1\">**</ept> on the server will not be sufficient to finalize these changes.","pos":[15610,15694],"source":" Running **iisreset** on the server will not be sufficient to finalize these changes."},{"content":"Browse to http://<bpt id=\"p1\">*</bpt>FQDN<ept id=\"p1\">*</ept>/certsrv/mscep/mscep.dll.","pos":[15698,15746],"source":"Browse to http://*FQDN*/certsrv/mscep/mscep.dll."},{"content":"You should see an NDES page similar to this:","pos":[15747,15791]},{"content":"Test NDES","pos":[15799,15808]},{"content":"If you get a <bpt id=\"p1\">**</bpt>503 Service unavailable<ept id=\"p1\">**</ept>, check the eventviewer.","pos":[15844,15908],"source":"If you get a **503 Service unavailable**, check the eventviewer."},{"content":"It's likely that the application pool is stopped due to a missing right for the NDES user.","pos":[15909,15999]},{"content":"Those rights are described in Task 1.","pos":[16000,16037]},{"content":"To Install and bind certificates on the NDES Server","pos":[16045,16096]},{"content":"On your NDES Server, request and install a <bpt id=\"p1\">**</bpt>server authentication<ept id=\"p1\">**</ept> certificate from your internal CA or public CA.","pos":[16102,16218],"source":"On your NDES Server, request and install a **server authentication** certificate from your internal CA or public CA."},{"content":"You will then bind this SSL certificate in IIS.","pos":[16219,16266]},{"pos":[16274,16724],"content":"[!TIP]\nAfter you bind the SSL certificate in IIS, you will also install a client authentication certificate. This certificate can be issued by any CA that is trusted by the NDES Server. Although it is not a best practice, you can use the same certificate for both server and client authentication as long as the certificate has both Enhance Key Usages (EKU’s). Review the following steps for information about these authentication certificates.","leadings":["","    > "],"nodes":[{"content":"After you bind the SSL certificate in IIS, you will also install a client authentication certificate. This certificate can be issued by any CA that is trusted by the NDES Server. Although it is not a best practice, you can use the same certificate for both server and client authentication as long as the certificate has both Enhance Key Usages (EKU’s). Review the following steps for information about these authentication certificates.","pos":[7,444],"nodes":[{"content":"After you bind the SSL certificate in IIS, you will also install a client authentication certificate.","pos":[0,101]},{"content":"This certificate can be issued by any CA that is trusted by the NDES Server.","pos":[102,178]},{"content":"Although it is not a best practice, you can use the same certificate for both server and client authentication as long as the certificate has both Enhance Key Usages (EKU’s).","pos":[179,353]},{"content":"Review the following steps for information about these authentication certificates.","pos":[354,437]}]}]},{"pos":[16734,16925],"content":"After you obtain the server authentication certificate, open <bpt id=\"p1\">**</bpt>IIS Manager<ept id=\"p1\">**</ept>, select the <bpt id=\"p2\">**</bpt>Default Web Site<ept id=\"p2\">**</ept> in the <bpt id=\"p3\">**</bpt>Connections<ept id=\"p3\">**</ept> pane, and then click <bpt id=\"p4\">**</bpt>Bindings<ept id=\"p4\">**</ept> in the <bpt id=\"p5\">**</bpt>Actions<ept id=\"p5\">**</ept> pane.","source":"After you obtain the server authentication certificate, open **IIS Manager**, select the **Default Web Site** in the **Connections** pane, and then click **Bindings** in the **Actions** pane."},{"content":"Click <bpt id=\"p1\">**</bpt>Add<ept id=\"p1\">**</ept>, set <bpt id=\"p2\">**</bpt>Type<ept id=\"p2\">**</ept> to <bpt id=\"p3\">**</bpt>https<ept id=\"p3\">**</ept>, and then ensure the port is <bpt id=\"p4\">**</bpt>443<ept id=\"p4\">**</ept>.","pos":[16935,17013],"source":"Click **Add**, set **Type** to **https**, and then ensure the port is **443**."},{"content":"(Only port 443 is supported for standalone Intune.","pos":[17014,17064]},{"pos":[17074,17145],"content":"For <bpt id=\"p1\">**</bpt>SSL certificate<ept id=\"p1\">**</ept>, specify the server authentication certificate.","source":"For **SSL certificate**, specify the server authentication certificate."},{"pos":[17157,17442],"content":"[!NOTE]\nIf the NDES server uses both an external and internal name for a single network address, the server authentication certificate must have a **Subject Name** with an external public server name, and a **Subject Alternative Name** that includes the internal server name.","leadings":["","        > "],"nodes":[{"content":"If the NDES server uses both an external and internal name for a single network address, the server authentication certificate must have a <bpt id=\"p1\">**</bpt>Subject Name<ept id=\"p1\">**</ept> with an external public server name, and a <bpt id=\"p2\">**</bpt>Subject Alternative Name<ept id=\"p2\">**</ept> that includes the internal server name.","pos":[8,275],"source":"If the NDES server uses both an external and internal name for a single network address, the server authentication certificate must have a **Subject Name** with an external public server name, and a **Subject Alternative Name** that includes the internal server name."}]},{"content":"On your NDES Server, request and install a <bpt id=\"p1\">**</bpt>client authentication<ept id=\"p1\">**</ept> certificate from your internal CA, or a public certificate authority.","pos":[17448,17586],"source":"On your NDES Server, request and install a **client authentication** certificate from your internal CA, or a public certificate authority."},{"content":"This can be the same certificate as the server authentication certificate if that certificate has both capabilities.","pos":[17587,17703]},{"content":"The client authentication certificate must have the following properties:","pos":[17709,17782]},{"pos":[17788,17857],"content":"<bpt id=\"p1\">**</bpt>Enhanced Key Usage<ept id=\"p1\">**</ept> - This must include <bpt id=\"p2\">**</bpt>Client Authentication<ept id=\"p2\">**</ept>.","source":"**Enhanced Key Usage** - This must include **Client Authentication**."},{"pos":[17863,17990],"content":"<bpt id=\"p1\">**</bpt>Subject Name<ept id=\"p1\">**</ept> - This must be equal to the DNS name of the server where you are installing the certificate (the NDES Server).","source":"**Subject Name** - This must be equal to the DNS name of the server where you are installing the certificate (the NDES Server)."},{"content":"To configure IIS Request Filtering","pos":[17998,18032]},{"pos":[18038,18176],"content":"On the NDES Server open <bpt id=\"p1\">**</bpt>IIS Manager<ept id=\"p1\">**</ept>, select the <bpt id=\"p2\">**</bpt>Default Web Site<ept id=\"p2\">**</ept> in the <bpt id=\"p3\">**</bpt>Connections<ept id=\"p3\">**</ept> pane, and then open <bpt id=\"p4\">**</bpt>Request Filtering<ept id=\"p4\">**</ept>.","source":"On the NDES Server open **IIS Manager**, select the **Default Web Site** in the **Connections** pane, and then open **Request Filtering**."},{"pos":[18182,18242],"content":"Click <bpt id=\"p1\">**</bpt>Edit Feature Settings<ept id=\"p1\">**</ept>, and then set the following:","source":"Click **Edit Feature Settings**, and then set the following:"},{"pos":[18248,18284],"content":"<bpt id=\"p1\">**</bpt>query string (Bytes)<ept id=\"p1\">**</ept><ph id=\"ph1\"> = </ph><bpt id=\"p2\">**</bpt>65534<ept id=\"p2\">**</ept>","source":"**query string (Bytes)** = **65534**"},{"pos":[18290,18332],"content":"<bpt id=\"p1\">**</bpt>Maximum URL length (Bytes)<ept id=\"p1\">**</ept><ph id=\"ph1\"> = </ph><bpt id=\"p2\">**</bpt>65534<ept id=\"p2\">**</ept>","source":"**Maximum URL length (Bytes)** = **65534**"},{"content":"Review the following registry key:","pos":[18338,18372]},{"pos":[18378,18450],"content":"<bpt id=\"p1\">**</bpt>HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\HTTP\\Parameters<ept id=\"p1\">**</ept>","source":"**HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\HTTP\\Parameters**"},{"content":"Ensure the following values are set as DWORD entries:","pos":[18456,18509]},{"pos":[18515,18574],"content":"Name: <bpt id=\"p1\">**</bpt>MaxFieldLength<ept id=\"p1\">**</ept>, with a decimal value of <bpt id=\"p2\">**</bpt>65534<ept id=\"p2\">**</ept>","source":"Name: **MaxFieldLength**, with a decimal value of **65534**"},{"pos":[18580,18640],"content":"Name: <bpt id=\"p1\">**</bpt>MaxRequestBytes<ept id=\"p1\">**</ept>, with a decimal value of <bpt id=\"p2\">**</bpt>65534<ept id=\"p2\">**</ept>","source":"Name: **MaxRequestBytes**, with a decimal value of **65534**"},{"content":"Reboot the NDES server.","pos":[18646,18669]},{"content":"The server is now ready to support the Certificate Connector.","pos":[18670,18731]},{"content":"Task 5 - Enable, install, and configure the Intune Certificate Connector","pos":[18737,18809]},{"content":"In this task you will:","pos":[18810,18832]},{"content":"Enable support for NDES in Intune.","pos":[18834,18868]},{"content":"Download, install, and configure the Certificate Connector on the NDES Server.","pos":[18870,18948]},{"content":"To enable support for the Certificate Connector","pos":[18956,19003]},{"pos":[19009,19128],"content":"Open the <bpt id=\"p1\">[</bpt>Intune administration console<ept id=\"p1\">](https://manage.microsoft.com)</ept>, click <bpt id=\"p2\">**</bpt>Admin<ept id=\"p2\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p3\">**</bpt>Certificate Connector<ept id=\"p3\">**</ept>.","source":"Open the [Intune administration console](https://manage.microsoft.com), click **Admin** &gt; **Certificate Connector**."},{"pos":[19134,19188],"content":"Click <bpt id=\"p1\">**</bpt>Configure On-Premises Certificate Connector<ept id=\"p1\">**</ept>.","source":"Click **Configure On-Premises Certificate Connector**."},{"pos":[19194,19257],"content":"Select <bpt id=\"p1\">**</bpt>Enable Certificate Connector<ept id=\"p1\">**</ept>, and then click <bpt id=\"p2\">**</bpt>OK<ept id=\"p2\">**</ept>.","source":"Select **Enable Certificate Connector**, and then click **OK**."},{"content":"To download, install and configure the Certificate Connector","pos":[19265,19325]},{"pos":[19331,19533],"content":"Open the <bpt id=\"p1\">[</bpt>Intune administration console<ept id=\"p1\">](https://manage.microsoft.com)</ept>, and then click <bpt id=\"p2\">**</bpt>Admin<ept id=\"p2\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p3\">**</bpt>Mobile Device Management<ept id=\"p3\">**</ept> <ph id=\"ph2\">&amp;gt;</ph> <bpt id=\"p4\">**</bpt>Certificate Connector<ept id=\"p4\">**</ept> <ph id=\"ph3\">&amp;gt;</ph> <bpt id=\"p5\">**</bpt>Download Certificate Connector<ept id=\"p5\">**</ept>.","source":"Open the [Intune administration console](https://manage.microsoft.com), and then click **Admin** &gt; **Mobile Device Management** &gt; **Certificate Connector** &gt; **Download Certificate Connector**."},{"content":"After the download completes, run the downloaded installer (<bpt id=\"p1\">**</bpt>ndesconnectorssetup.exe<ept id=\"p1\">**</ept>) on a Windows Server 2012 R2 server.","pos":[19539,19663],"source":"After the download completes, run the downloaded installer (**ndesconnectorssetup.exe**) on a Windows Server 2012 R2 server."},{"content":"The installer also installs the policy module for NDES and the CRP Web Service.","pos":[19664,19743]},{"content":"(The CRP Web Service, CertificateRegistrationSvc, runs as an application in IIS.)","pos":[19744,19825]},{"pos":[19833,20089],"content":"[!NOTE]\nWhen you install NDES for standalone Intune, the CRP service automatically installs with the Certificate Connector. When you use Intune with Configuration Manager, you install the Certificate Registration Point as a separate site system role.","leadings":["","    > "],"nodes":[{"content":"When you install NDES for standalone Intune, the CRP service automatically installs with the Certificate Connector. When you use Intune with Configuration Manager, you install the Certificate Registration Point as a separate site system role.","pos":[8,250],"nodes":[{"content":"When you install NDES for standalone Intune, the CRP service automatically installs with the Certificate Connector.","pos":[0,115]},{"content":"When you use Intune with Configuration Manager, you install the Certificate Registration Point as a separate site system role.","pos":[116,242]}]}]},{"pos":[20095,20282],"content":"When prompted for the client certificate for the Certificate Connector, click <bpt id=\"p1\">**</bpt>Select<ept id=\"p1\">**</ept>, and select the <bpt id=\"p2\">**</bpt>client authentication<ept id=\"p2\">**</ept> certificate you installed on your NDES Server in Task 3.","source":"When prompted for the client certificate for the Certificate Connector, click **Select**, and select the **client authentication** certificate you installed on your NDES Server in Task 3."},{"content":"After you select the client authentication certificate, you are returned to the <bpt id=\"p1\">**</bpt>Client Certificate for Microsoft Intune Certificate Connector<ept id=\"p1\">**</ept> surface.","pos":[20288,20442],"source":"After you select the client authentication certificate, you are returned to the **Client Certificate for Microsoft Intune Certificate Connector** surface."},{"content":"Although the certificate you selected is not shown, click <bpt id=\"p1\">**</bpt>Next<ept id=\"p1\">**</ept> to view the properties of that certificate.","pos":[20443,20553],"source":" Although the certificate you selected is not shown, click **Next** to view the properties of that certificate."},{"content":"Then click <bpt id=\"p1\">**</bpt>Next<ept id=\"p1\">**</ept>, and then click <bpt id=\"p2\">**</bpt>Install<ept id=\"p2\">**</ept>.","pos":[20554,20602],"source":" Then click **Next**, and then click **Install**."},{"pos":[20608,20713],"content":"After the wizard completes, but before closing the wizard, click <bpt id=\"p1\">**</bpt>Launch the Certificate Connector UI<ept id=\"p1\">**</ept>.","source":"After the wizard completes, but before closing the wizard, click **Launch the Certificate Connector UI**."},{"pos":[20721,20856],"content":"[!TIP]\nIf you close the wizard before launching the Certificate Connector UI, you can reopen it by running the following command:","leadings":["","    > "],"nodes":[{"content":"If you close the wizard before launching the Certificate Connector UI, you can reopen it by running the following command:","pos":[7,129]}]},{"pos":[20869,20929],"content":"<bpt id=\"p1\">**</bpt><ph id=\"ph1\">&amp;lt;</ph>install_Path<ph id=\"ph2\">&amp;gt;</ph>\\NDESConnectorUI\\NDESConnectorUI.exe<ept id=\"p1\">**</ept>","source":"**&lt;install_Path&gt;\\NDESConnectorUI\\NDESConnectorUI.exe**"},{"pos":[20935,20971],"content":"In the <bpt id=\"p1\">**</bpt>Certificate Connector<ept id=\"p1\">**</ept> UI:","source":"In the **Certificate Connector** UI:"},{"pos":[20977,21136],"content":"Click <bpt id=\"p1\">**</bpt>Sign In<ept id=\"p1\">**</ept> and enter your Intune service administrator credentials, or credentials for a tenant administrator with the global administration permission.","source":"Click **Sign In** and enter your Intune service administrator credentials, or credentials for a tenant administrator with the global administration permission."},{"pos":[21142,21359],"content":"If your organization uses a proxy server and the proxy is needed for the NDES server to access the Internet, click <bpt id=\"p1\">**</bpt>Use proxy server<ept id=\"p1\">**</ept> and then provide the proxy server name, port, and account credentials to connect.","source":"If your organization uses a proxy server and the proxy is needed for the NDES server to access the Internet, click **Use proxy server** and then provide the proxy server name, port, and account credentials to connect."},{"pos":[21365,21560],"content":"Select the <bpt id=\"p1\">**</bpt>Advanced<ept id=\"p1\">**</ept> tab, and then provide credentials for an account that has the <bpt id=\"p2\">**</bpt>Issue and Manage Certificates<ept id=\"p2\">**</ept> permission on your issuing Certificate Authority, and then click <bpt id=\"p3\">**</bpt>Apply<ept id=\"p3\">**</ept>.","source":"Select the **Advanced** tab, and then provide credentials for an account that has the **Issue and Manage Certificates** permission on your issuing Certificate Authority, and then click **Apply**."},{"content":"You can now close the Certificate Connector UI.","pos":[21566,21613]},{"pos":[21619,21767],"content":"Open a command prompt and type <bpt id=\"p1\">**</bpt>services.msc<ept id=\"p1\">**</ept>, and then press <bpt id=\"p2\">**</bpt>Enter<ept id=\"p2\">**</ept>, right-click the <bpt id=\"p3\">**</bpt>Intune Connector Service<ept id=\"p3\">**</ept>, and then click <bpt id=\"p4\">**</bpt>Restart<ept id=\"p4\">**</ept>.","source":"Open a command prompt and type **services.msc**, and then press **Enter**, right-click the **Intune Connector Service**, and then click **Restart**."},{"pos":[21769,21890],"content":"To validate that the service is running, open a browser and enter the following URL, which should return a <bpt id=\"p1\">**</bpt>403<ept id=\"p1\">**</ept> error:","source":"To validate that the service is running, open a browser and enter the following URL, which should return a **403** error:"},{"pos":[21892,21960],"content":"<bpt id=\"p1\">**</bpt>http:// <ph id=\"ph1\">&amp;lt;</ph>FQDN_of_your_NDES_server<ph id=\"ph2\">&amp;gt;</ph>/certsrv/mscep/mscep.dll<ept id=\"p1\">**</ept>","source":"**http:// &lt;FQDN_of_your_NDES_server&gt;/certsrv/mscep/mscep.dll**"},{"content":"Next steps","pos":[21965,21975]},{"pos":[21976,22120],"content":"You are now ready to configure certificate profiles, as described in <bpt id=\"p1\">[</bpt>Configure certificate profiles<ept id=\"p1\">](Configure-Intune-certificate-profiles.md)</ept>.","source":"You are now ready to configure certificate profiles, as described in [Configure certificate profiles](Configure-Intune-certificate-profiles.md)."}],"content":"---\ntitle: Configure certificate infrastructure for SCEP |Microsoft Intune\ndescription: Infrastructure for creating and deploying SCEP certificate profiles.\nkeywords:\nauthor: nbigman\nmanager: angrobe\nms.date: 07/25/2016\nms.topic: article\nms.prod:\nms.service: microsoft-intune\nms.technology:\nms.assetid: 4ae137ae-34e5-4a45-950c-983de831270f\n\n\n# optional metadata\n\n#ROBOTS:\n#audience:\n#ms.devlang:\nms.reviewer: kmyrup\nms.suite: ems\n#ms.tgt_pltfrm:\n#ms.custom:\n---\n# Configure certificate infrastructure for SCEP\nThis topic describes what infrastructure you need in order to create and deploy SCEP certificate profiles.\n\n### On-premises infrastructure\n\n-    **Active Directory domain**: All servers listed in this section (except for the Web Application Proxy Server) must be joined to your Active Directory domain.\n\n-  **Certification Authority** (CA): An Enterprise Certification Authority (CA) that runs on an Enterprise edition of Windows Server 2008 R2 or later. A Standalone CA is not supported. For instructions on how to set up a Certification Authority, see [Install the Certification Authority](http://technet.microsoft.com/library/jj125375.aspx).\n    If your CA runs Windows Server 2008 R2, you must [install the hotfix from KB2483564](http://support.microsoft.com/kb/2483564/).\nI\n-  **NDES Server**: On a server that runs Windows Server 2012 R2 or later, you must setup up the Network Device Enrollment Service (NDES). Intune does not support using NDES when it runs on a server that also runs the Enterprise CA. See [Network Device Enrollment Service Guidance](http://technet.microsoft.com/library/hh831498.aspx) for instructions on how to configure Windows Server 2012 R2 to host the Network Device Enrollment Service. The NDES server must be domain joined to the domain that hosts the CA, and not be on the same server as the CA. More information about deploying the NDES server in a separate forest, isolated network or internal domain can be found in [Using a Policy Module with the Network Device Enrollment Service](https://technet.microsoft.com/en-us/library/dn473016.aspx).\n\n-  **Microsoft Intune Certificate Connector**: You use the Intune admin console to download the **Certificate Connector** installer (**ndesconnectorssetup.exe**). Then you can run **ndesconnectorssetup.exe** on the computer where you want to install the Certificate Connector.\n-  **Web Application Proxy Server** (optional): You can use a server that runs Windows Server 2012 R2  or later as a Web Application Proxy (WAP) server. This configuration:\n    -  Allows devices to receive certificates using an Internet connection.\n    -  Is a security recommendation when devices connect through the Internet to receive and renew certificates.\n\n > [!NOTE]           \n> -    The server that hosts WAP [must install an update](http://blogs.technet.com/b/ems/archive/2014/12/11/hotfix-large-uri-request-in-web-application-proxy-on-windows-server-2012-r2.aspx) that enables support for the long URLs that are used by the Network Device Enrollment Service. This update is included with the [December 2014 update rollup](http://support.microsoft.com/kb/3013769), or individually from [KB3011135](http://support.microsoft.com/kb/3011135).\n>-  Also, the server that hosts WAP must have a SSL certificate that matches the name being published to external clients as well as trust the SSL certificate that is used on the NDES server. These certificates enable the WAP server to terminate the SSL connection from clients, and create a new SSL connection to the NDES server.\n    For information about certificates for WAP, see the **Plan certificates** section of [Planning to Publish Applications Using Web Application Proxy](https://technet.microsoft.com/library/dn383650.aspx). For general information about WAP servers, see [Working with Web Application Proxy](http://technet.microsoft.com/library/dn584113.aspx).|\n\n### Network requirements\n\nFrom the Internet to perimeter network, allow port 443 from all hosts/IP addressess on the internet to the NDES server.\n\nFrom the perimeter network to trusted network, allow all ports and protocols needed for domain access on the domain-joined NDES server. The NDES server needs access to the certificate servers, DNS servers, Configuration Manager servers and domain controllers.\n\nWe recommend publishing the NDES server through a proxy, such as the [Azure AD application proxy](https://azure.microsoft.com/en-us/documentation/articles/active-directory-application-proxy-publish/), [Web Access Proxy](https://technet.microsoft.com/en-us/library/dn584107.aspx), or a third-party proxy.\n\n\n### <a name=\"BKMK_CertsAndTemplates\"></a>Certificates and Templates\n\n|Object|Details|\n|----------|-----------|\n|**Certificate Template**|You configure this template on your issuing CA.|\n|**Client authentication certificate**|Requested from your issuing CA or public CA, you install this certificate on the NDES Server.|\n|**Server authentication certificate**|Requested from your issuing CA or public CA, you install and bind this SSL certificate in IIS on the NDES server.|\n|**Trusted Root CA certificate**|You export this as a **.cer** file from the root CA or any device which trusts the root CA, and deploy it to devices by using the Trusted CA certificate profile.<br /><br />You use a single Trusted Root CA certificate per operating system platform, and associate it with each Trusted Root Certificate profile you create.<br /><br />You can use additional Trusted Root CA certificates when needed. For example, you might do this to provide a trust to a CA that signs the server authentication certificates for your Wi-Fi access points.|\n\n### <a name=\"BKMK_Accounts\"></a>Accounts\n\n|Name|Details|\n|--------|-----------|\n|**NDES service account**|You specify a domain user account to use as the NDES Service account.|\n\n## <a name=\"BKMK_ConfigureInfrastructure\"></a>Configure your infrastructure\nBefore you can configure certificate profiles you must complete the following tasks, which require knowledge of Windows Server 2012 R2 and Active Directory Certificate Services (ADCS):\n\n**Task 1**: Create an NDES service account\n\n**Task 2**: Configure certificate templates on the certification authority\n\n**Task 3**: Configure prerequisites on the NDES server\n\n**Task 4**: Configure NDES for use with Intune\n\n**Task 5**: Enable, install, and configure the Intune Certificate Connector\n\n### Task 1 - Create an NDES service account\n\nCreate a domain user account to use as the NDES service account. You will specify this account when you configure templates on the issuing CA before you install and configure NDES. Make sure the user has the default rights, **Logon Localy**, **Logon as a Service** and **Logon as a batch job** rights. Some organizations have hardening policies that disable those rights.\n\n\n\n\n### Task 2 - Configure certificate templates on the certification authority\nIn this task you will:\n\n-   Configure a certificate template for NDES\n\n-   Publish the certificate template for NDES\n\n##### To configure the certification authority\n\n1.  Log on as an enterprise administrator. \n\n2.  On the issuing CA, use the Certificate Templates snap-in to create a new custom template or copy an existing template and then edit an existing template (like the User template), for use with NDES.\n\n    The template must have the following configurations:\n\n    -   Specify a friendly **Template display name** for the template.\n\n    -   On the **Subject Name** tab, select **Supply in the request**. (Security is enforced by the Intune policy module for NDES).\n\n    -   On the **Extensions** tab, ensure the **Description of Application Policies** includes **Client Authentication**.\n\n        > [!IMPORTANT]\n        > For iOS and Mac OS X certificate templates, on the **Extensions** tab, edit **Key Usage** and ensure **Signature is proof of origin** is not selected.\n\n    -   On the **Security** tab, add the NDES service account, and give it **Enroll** permissions to the template. Intune admins who will create SCEP profiles require **Read** rights so that they can browse to the template when creating SCEP profiles.\n    \n    > [!NOTE]\n    > To revoke certificates the NDES service account needs *Issue and Manage Certificates* rights for each certificate template used by a certificate profile.\n\n3.  Review the **Validity period** on the **General** tab of the template. By default, Intune uses the value configured in the template. However, you have the option to configure the CA to allow the requester to specify a different value, which you can then set from within the Intune Administrator console. If you want to always use the value in the template, skip the remainder of this step.\n\n    > [!IMPORTANT]\n    > The iOS and Mac OS X platforms always uses the value set in the template regardless of other configurations you make.\n\nHere are screenshots of an example template configuration.\n\n![Template, request handling tab](..\\media\\scep_ndes_request_handling.png) \n\n![Template, subject name tab](..\\media\\scep_ndes_subject_name.jpg) \n\n![Template, security tab](..\\media\\scep_ndes_security.jpg) \n\n![Template, extensions tab](..\\media\\scep_ndes_extensions.jpg) \n\n![Template, issuance requirements tab](..\\media\\scep_ndes_issuance_reqs.jpg) \n\n>   [!IMPORTANT]\n    > For Application Policies (in the 4th screenshot), only add the application policies required. Confirm your choices with your security admins.\n   \n\n\nTo configure the CA to allow the requester to specify the validity period, on the CA run the following commands:\n\n   1.  **certutil -setreg Policy\\EditFlags +EDITF_ATTRIBUTEENDDATE**\n   2.  **net stop certsvc**\n\n   3.  **net start certsvc**\n\n4.  On the issuing CA, use the Certification Authority snap-in to publish the certificate template.\n\n    1.  Select the **Certificate Templates** node, click **Action**-&gt; **New** &gt; **Certificate Template to Issue**, and then select the template you created in step 2.\n\n    2.  Validate that the template published by viewing it under the **Certificate Templates** folder.\n\n\n### Task 3 - Configure prerequisites on the NDES server\nIn this task you will:\n\n-   Add NDES to a Windows Server and configure IIS to support NDES\n\n-   Add the NDES Service account to the IIS_IUSR group\n\n-   Set the SPN for the NDES Service account\n\n\n\n\n   1.  On the server that will hosts NDES, you must log on as a an **Enterprise Administrator**, and then use the [Add Roles and Features Wizard](https://technet.microsoft.com/library/hh831809.aspx) to install NDES:\n\n    1.  In the Wizard, select **Active Directory Certificate Services** to gain access to the AD CS Role Services. Select the **Network Device Enrollment Service**, uncheck **Certification Authority**, and then complete the wizard.\n\n        > [!TIP]\n        > On the **Installation progress** page of the wizard, do not click **Close**. Instead, click the link for **Configure Active Directory Certificate Services on the destination server**. This opens the **AD CS Configuration** wizard that you use for the next task. After AD CS Configuration opens, you can close the Add Roles and Features wizard.\n\n    2.  When NDES is added to the server, the wizard also installs IIS. Ensure IIS has the following configurations:\n\n        -   **Web Server** &gt; **Security** &gt; **Request Filtering**\n\n        -   **Web Server** &gt; **Application Development** &gt; **ASP.NET 3.5**. Installing ASP.NET 3.5 will install .NET Framework 3.5. When installing .NET Framework 3.5, install both the core **.NET Framework 3.5** feature and **HTTP Activation**.\n\n        -   **Web Server** &gt; **Application Development** &gt; **ASP.NET 4.5**. Installing ASP.NET 4.5 will install .NET Framework 4.5. When installing .NET Framework 4.5, install the core **.NET Framework 4.5** feature, **ASP.NET 4.5**, and the **WCF Services** &gt; **HTTP Activation** feature.\n\n        -   **Management Tools** &gt; **IIS 6 Management Compatibility** &gt; **IIS 6 Metabase Compatibility**\n\n        -   **Management Tools** &gt; **IIS 6 Management Compatibility** &gt; **IIS 6 WMI Compatibility**\n\n  2.  On the server, add the NDES service account as a member of the **IIS_IUSR** group.\n\n   3.  In an elevated command prompt, run the following command to set the SPN of the NDES Service account:\n\n`**setspn -s http/&lt;DNS name of NDES Server&gt; &lt;Domain name&gt;\\&lt;NDES Service account name&gt;**`\n\n   For example, if your NDES Server is named **Server01**, your domain is **Contoso.com**, and the service account is **NDESService**, use:\n\n`**setspn –s http/Server01.contoso.com contoso\\NDESService**`\n\n### Task 4 - Configure NDES for use with Intune\nIn this task you will:\n\n-   Configure NDES for use with the issuing CA\n\n-   Bind the server authentication (SSL) certificate in IIS\n\n-   Configure Request Filtering in IIS\n\n##### To configure NDES for use with Intune\n\n1.  On the NDES Server, open the AD CS Configuration wizard and then make the following configurations.\n\n    > [!TIP]\n    > If you clicked the link in the previous task, this wizard is already open. Otherwise, open Server Manager to access the post-deployment configuration for Active Directory Certificate Services.\n\n    -   On the **Role Services** Page, select the **Network Device Enrollment Service**.\n\n    -   On the **Service Account for NDES** page, specify the NDES Service Account.\n\n    -   On the **CA for NDES** page, click **Select**, and then select the issuing CA where you configured the certificate template.\n\n    -   On the **Cryptography for NDES** page, set the key length to meet your company requirements.\n\n    On the **Confirmation** page, click **Configure** to complete the wizard.\n\n2.  After the wizard completes, edit the following registry key on the NDES Server:\n\n    -   **HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Cryptography\\MSCEP\\**\n\n    To edit this key, identify the certificate template's **Purpose**, as found on its **Request Handling** tab, and then edit the corresponding entry in the registry by replacing the existing data with the name of the certificate template (not the display name of the template) that you specified in Task 1. The following table maps the certificate template purpose to the values in the registry:\n\n    |Certificate template Purpose (On the Request Handling tab)|Registry value to edit|Value seen in the Intune admin console for the SCEP profile|\n    |--------------------------------------------------------------|--------------------------|------------------------------------------------------------------------------------------------------------|\n    |Signature|SignatureTemplate|Digital Signature|\n    |Encryption|EncryptionTemplate|Key Encipherment|\n    |Signature and encryption|GeneralPurposeTemplate|Key Encipherment<br /><br />Digital Signature|\n    For example, if the Purpose of your certificate template is **Encryption**, then edit the **EncryptionTemplate** value to be the name of your certificate template.\n\n3. The NDES server will receive very long URL’s (queries), which require that you add two registry entries:\n\n    |Location|Value|Type|Data|\n    |-------|-----|----|----|\n    |HKLM\\SYSTEM\\CurrentControlSet\\Services\\HTTP\\Parameters|MaxFieldLength|DWORD|65534 (decimal)|\n    |HKLM\\SYSTEM\\CurrentControlSet\\Services\\HTTP\\Parameters|MaxRequestBytes|DWORD|65534 (decimal)|\n\n\n4. In IIS manager, choose **Default Web Site** -> **Request Filtering** -> **Edit Feature Setting**, and change the **Maximum URL length** and **Maximum query string** to *65534*, as shown.\n\n    ![IIS max URL and query length](..\\media\\SCEP_IIS_max_URL.png) \n\n5.  Restart the server. Running **iisreset** on the server will not be sufficient to finalize these changes.\n6. Browse to http://*FQDN*/certsrv/mscep/mscep.dll. You should see an NDES page similar to this:\n\n    ![Test NDES](..\\media\\SCEP_NDES_URL.png) \n\n    If you get a **503 Service unavailable**, check the eventviewer. It's likely that the application pool is stopped due to a missing right for the NDES user. Those rights are described in Task 1.\n\n##### To Install and bind certificates on the NDES Server\n\n1.  On your NDES Server, request and install a **server authentication** certificate from your internal CA or public CA. You will then bind this SSL certificate in IIS.\n\n    > [!TIP]\n    > After you bind the SSL certificate in IIS, you will also install a client authentication certificate. This certificate can be issued by any CA that is trusted by the NDES Server. Although it is not a best practice, you can use the same certificate for both server and client authentication as long as the certificate has both Enhance Key Usages (EKU’s). Review the following steps for information about these authentication certificates.\n\n    1.  After you obtain the server authentication certificate, open **IIS Manager**, select the **Default Web Site** in the **Connections** pane, and then click **Bindings** in the **Actions** pane.\n\n    2.  Click **Add**, set **Type** to **https**, and then ensure the port is **443**. (Only port 443 is supported for standalone Intune.\n\n    3.  For **SSL certificate**, specify the server authentication certificate.\n\n        > [!NOTE]\n        > If the NDES server uses both an external and internal name for a single network address, the server authentication certificate must have a **Subject Name** with an external public server name, and a **Subject Alternative Name** that includes the internal server name.\n\n2.  On your NDES Server, request and install a **client authentication** certificate from your internal CA, or a public certificate authority. This can be the same certificate as the server authentication certificate if that certificate has both capabilities.\n\n    The client authentication certificate must have the following properties:\n\n    **Enhanced Key Usage** - This must include **Client Authentication**.\n\n    **Subject Name** - This must be equal to the DNS name of the server where you are installing the certificate (the NDES Server).\n\n##### To configure IIS Request Filtering\n\n1.  On the NDES Server open **IIS Manager**, select the **Default Web Site** in the **Connections** pane, and then open **Request Filtering**.\n\n2.  Click **Edit Feature Settings**, and then set the following:\n\n    **query string (Bytes)** = **65534**\n\n    **Maximum URL length (Bytes)** = **65534**\n\n3.  Review the following registry key:\n\n    **HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\HTTP\\Parameters**\n\n    Ensure the following values are set as DWORD entries:\n\n    Name: **MaxFieldLength**, with a decimal value of **65534**\n\n    Name: **MaxRequestBytes**, with a decimal value of **65534**\n\n4.  Reboot the NDES server. The server is now ready to support the Certificate Connector.\n\n### Task 5 - Enable, install, and configure the Intune Certificate Connector\nIn this task you will:\n\nEnable support for NDES in Intune.\n\nDownload, install, and configure the Certificate Connector on the NDES Server.\n\n##### To enable support for the Certificate Connector\n\n1.  Open the [Intune administration console](https://manage.microsoft.com), click **Admin** &gt; **Certificate Connector**.\n\n2.  Click **Configure On-Premises Certificate Connector**.\n\n3.  Select **Enable Certificate Connector**, and then click **OK**.\n\n##### To download, install and configure the Certificate Connector\n\n1.  Open the [Intune administration console](https://manage.microsoft.com), and then click **Admin** &gt; **Mobile Device Management** &gt; **Certificate Connector** &gt; **Download Certificate Connector**.\n\n2.  After the download completes, run the downloaded installer (**ndesconnectorssetup.exe**) on a Windows Server 2012 R2 server. The installer also installs the policy module for NDES and the CRP Web Service. (The CRP Web Service, CertificateRegistrationSvc, runs as an application in IIS.)\n\n    > [!NOTE]\n    > When you install NDES for standalone Intune, the CRP service automatically installs with the Certificate Connector. When you use Intune with Configuration Manager, you install the Certificate Registration Point as a separate site system role.\n\n3.  When prompted for the client certificate for the Certificate Connector, click **Select**, and select the **client authentication** certificate you installed on your NDES Server in Task 3.\n\n    After you select the client authentication certificate, you are returned to the **Client Certificate for Microsoft Intune Certificate Connector** surface. Although the certificate you selected is not shown, click **Next** to view the properties of that certificate. Then click **Next**, and then click **Install**.\n\n4.  After the wizard completes, but before closing the wizard, click **Launch the Certificate Connector UI**.\n\n    > [!TIP]\n    > If you close the wizard before launching the Certificate Connector UI, you can reopen it by running the following command:\n    >\n    > **&lt;install_Path&gt;\\NDESConnectorUI\\NDESConnectorUI.exe**\n\n5.  In the **Certificate Connector** UI:\n\n    Click **Sign In** and enter your Intune service administrator credentials, or credentials for a tenant administrator with the global administration permission.\n\n    If your organization uses a proxy server and the proxy is needed for the NDES server to access the Internet, click **Use proxy server** and then provide the proxy server name, port, and account credentials to connect.\n\n    Select the **Advanced** tab, and then provide credentials for an account that has the **Issue and Manage Certificates** permission on your issuing Certificate Authority, and then click **Apply**.\n\n    You can now close the Certificate Connector UI.\n\n6.  Open a command prompt and type **services.msc**, and then press **Enter**, right-click the **Intune Connector Service**, and then click **Restart**.\n\nTo validate that the service is running, open a browser and enter the following URL, which should return a **403** error:\n\n**http:// &lt;FQDN_of_your_NDES_server&gt;/certsrv/mscep/mscep.dll**\n\n## Next steps\nYou are now ready to configure certificate profiles, as described in [Configure certificate profiles](Configure-Intune-certificate-profiles.md).\n"}