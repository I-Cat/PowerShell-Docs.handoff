{"nodes":[{"pos":[11,74],"content":"Configure certificate infrastructure for PFX | Microsoft Intune","needQuote":true,"nodes":[{"content":"Configure certificate infrastructure for PFX | Microsoft Intune","pos":[0,63]}]},{"pos":[88,132],"content":"Create and deploy .PFX certificate profiles.","needQuote":true,"nodes":[{"content":"Create and deploy .PFX certificate profiles.","pos":[0,44]}]},{"content":"Configure certificate infrastructure","pos":[443,479]},{"content":"This topic describes what you need in order to create and deploy .PFX certificate profiles.","pos":[480,571]},{"content":"To do any certificate-based authentication in your organization, you need an Enterprise Certification Authority.","pos":[573,685]},{"content":"To use .PFX Certificate profiles, in addition to the Enterprise Certification Authority, you  also need:","pos":[687,791]},{"content":"A computer that can communicate with the Certification Authority, or you can use the Certification Authority computer itself.","pos":[797,922]},{"content":"The Intune Certificate Connector, which runs on the computer that can communicate with the Certification Authority.","pos":[927,1042]},{"content":"On-premises infrastructure description","pos":[1047,1085]},{"pos":[1093,1250],"content":"<bpt id=\"p1\">**</bpt>Active Directory domain<ept id=\"p1\">**</ept>: All servers listed in this section (except for the Web Application Proxy Server) must be joined to your Active Directory domain.","source":"**Active Directory domain**: All servers listed in this section (except for the Web Application Proxy Server) must be joined to your Active Directory domain."},{"pos":[1255,1719],"content":"**Certification Authority**: An Enterprise Certification Authority (CA) that runs on an Enterprise edition of Windows Server 2008 R2 or later. A Standalone CA is not supported. For instructions on how to set up a Certification Authority, see [Install the Certification Authority](http://technet.microsoft.com/library/jj125375.aspx).\n If your CA runs Windows Server 2008 R2, you must [install the hotfix from KB2483564](http://support.microsoft.com/kb/2483564/).","leadings":["","   "],"nodes":[{"content":"<bpt id=\"p1\">**</bpt>Certification Authority<ept id=\"p1\">**</ept>: An Enterprise Certification Authority (CA) that runs on an Enterprise edition of Windows Server 2008 R2 or later.","pos":[0,142],"source":"**Certification Authority**: An Enterprise Certification Authority (CA) that runs on an Enterprise edition of Windows Server 2008 R2 or later."},{"content":"A Standalone CA is not supported.","pos":[143,176]},{"content":"For instructions on how to set up a Certification Authority, see <bpt id=\"p1\">[</bpt>Install the Certification Authority<ept id=\"p1\">](http://technet.microsoft.com/library/jj125375.aspx)</ept>.","pos":[177,332],"source":" For instructions on how to set up a Certification Authority, see [Install the Certification Authority](http://technet.microsoft.com/library/jj125375.aspx)."},{"content":"If your CA runs Windows Server 2008 R2, you must <bpt id=\"p1\">[</bpt>install the hotfix from KB2483564<ept id=\"p1\">](http://support.microsoft.com/kb/2483564/)</ept>.","pos":[334,461],"source":" If your CA runs Windows Server 2008 R2, you must [install the hotfix from KB2483564](http://support.microsoft.com/kb/2483564/)."}]},{"pos":[1724,1851],"content":"<bpt id=\"p1\">**</bpt>Computer that can communicate with Certification Authority<ept id=\"p1\">**</ept>: Alternatively, use the Certification Authority computer itself.","source":"**Computer that can communicate with Certification Authority**: Alternatively, use the Certification Authority computer itself."},{"content":"<bpt id=\"p1\">**</bpt>Microsoft Intune Certificate Connector<ept id=\"p1\">**</ept>: You use the Intune admin console to download the <bpt id=\"p2\">**</bpt>Certificate Connector<ept id=\"p2\">**</ept> installer (<bpt id=\"p3\">**</bpt>ndesconnectorssetup.exe<ept id=\"p3\">**</ept>).","pos":[1855,2014],"source":"**Microsoft Intune Certificate Connector**: You use the Intune admin console to download the **Certificate Connector** installer (**ndesconnectorssetup.exe**)."},{"content":"Then you can run <bpt id=\"p1\">**</bpt>ndesconnectorssetup.exe<ept id=\"p1\">**</ept> on the computer where you want to install the Certificate Connector.","pos":[2015,2128],"source":" Then you can run **ndesconnectorssetup.exe** on the computer where you want to install the Certificate Connector."},{"content":"For .PFX Certificate profiles, install the Certificate Connector on the computer that communicates with the Certification Authority.","pos":[2129,2261]},{"content":"<bpt id=\"p1\">**</bpt>Web Application Proxy server<ept id=\"p1\">**</ept> (optional): You can use a server that runs Windows Server 2012 R2 or later as a Web Application Proxy (WAP) server.","pos":[2265,2413],"source":"**Web Application Proxy server** (optional): You can use a server that runs Windows Server 2012 R2 or later as a Web Application Proxy (WAP) server."},{"content":"This configuration:","pos":[2414,2433]},{"content":"Allows devices to receive certificates using an Internet connection.","pos":[2441,2509]},{"content":"Is a security recommendation when devices connect through the Internet to receive and renew certificates.","pos":[2517,2622]},{"content":"The server that hosts WAP <bpt id=\"p1\">[</bpt>must install an update<ept id=\"p1\">](http://blogs.technet.com/b/ems/archive/2014/12/11/hotfix-large-uri-request-in-web-application-proxy-on-windows-server-2012-r2.aspx)</ept> that enables support for the long URLs that are used by the Network Device Enrollment Service (NDES).","pos":[2653,2937],"source":"The server that hosts WAP [must install an update](http://blogs.technet.com/b/ems/archive/2014/12/11/hotfix-large-uri-request-in-web-application-proxy-on-windows-server-2012-r2.aspx) that enables support for the long URLs that are used by the Network Device Enrollment Service (NDES)."},{"content":"This update is included with the <bpt id=\"p1\">[</bpt>December 2014 update rollup<ept id=\"p1\">](http://support.microsoft.com/kb/3013769)</ept>, or individually from <bpt id=\"p2\">[</bpt>KB3011135<ept id=\"p2\">](http://support.microsoft.com/kb/3011135)</ept>.","pos":[2938,3117],"source":" This update is included with the [December 2014 update rollup](http://support.microsoft.com/kb/3013769), or individually from [KB3011135](http://support.microsoft.com/kb/3011135)."},{"pos":[3122,3793],"content":"Also, the server that hosts WAP must have an SSL certificate that matches the name being published to external clients as well as trust the SSL certificate that is used on the NDES server. These certificates enable the WAP server to terminate the SSL connection from clients, and create a new SSL connection to the NDES server.\n For information about certificates for WAP, see the **Plan certificates** section of [Planning to Publish Applications Using Web Application Proxy](https://technet.microsoft.com/library/dn383650.aspx). For general information about WAP servers, see [Working with Web Application Proxy](http://technet.microsoft.com/library/dn584113.aspx).|","leadings":["","   "],"nodes":[{"content":"Also, the server that hosts WAP must have an SSL certificate that matches the name being published to external clients as well as trust the SSL certificate that is used on the NDES server.","pos":[0,188]},{"content":"These certificates enable the WAP server to terminate the SSL connection from clients, and create a new SSL connection to the NDES server.","pos":[189,327]},{"content":"For information about certificates for WAP, see the <bpt id=\"p1\">**</bpt>Plan certificates<ept id=\"p1\">**</ept> section of <bpt id=\"p2\">[</bpt>Planning to Publish Applications Using Web Application Proxy<ept id=\"p2\">](https://technet.microsoft.com/library/dn383650.aspx)</ept>.","pos":[329,530],"source":" For information about certificates for WAP, see the **Plan certificates** section of [Planning to Publish Applications Using Web Application Proxy](https://technet.microsoft.com/library/dn383650.aspx)."},{"content":"For general information about WAP servers, see <bpt id=\"p1\">[</bpt>Working with Web Application Proxy<ept id=\"p1\">](http://technet.microsoft.com/library/dn584113.aspx)</ept>.|","pos":[531,668],"source":" For general information about WAP servers, see [Working with Web Application Proxy](http://technet.microsoft.com/library/dn584113.aspx).|"}]},{"content":"Certificates and Templates","pos":[3800,3826]},{"content":"Object","pos":[3829,3835]},{"content":"Details","pos":[3836,3843]},{"pos":[3871,3895],"content":"<bpt id=\"p1\">**</bpt>Certificate Template<ept id=\"p1\">**</ept>","source":"**Certificate Template**"},{"content":"You configure this template on your issuing CA.","pos":[3896,3943]},{"pos":[3946,3977],"content":"<bpt id=\"p1\">**</bpt>Trusted Root CA certificate<ept id=\"p1\">**</ept>","source":"**Trusted Root CA certificate**"},{"content":"You export this as a <bpt id=\"p1\">**</bpt>.cer<ept id=\"p1\">**</ept> file from the issuing CA or any device which trusts the issuing CA, and deploy it to devices by using the Trusted CA certificate profile.","pos":[3978,4145],"source":"You export this as a **.cer** file from the issuing CA or any device which trusts the issuing CA, and deploy it to devices by using the Trusted CA certificate profile."},{"content":"You use a single Trusted Root CA certificate per operating system platform, and associate it with each Trusted Root Certificate profile you create.","pos":[4157,4304]},{"content":"You can use additional Trusted Root CA certificates when needed.","pos":[4316,4380]},{"content":"For example, you might do this to provide a trust to a CA that signs the server authentication certificates for your Wi-Fi access points.","pos":[4381,4518]},{"content":"Configure your infrastructure","pos":[4525,4554]},{"content":"Before you can configure certificate profiles, you must complete the following tasks.","pos":[4555,4640]},{"content":"These tasks require knowledge of Windows Server 2012 R2 and Active Directory Certificate Services (ADCS):","pos":[4641,4746]},{"pos":[4750,4826],"content":"<bpt id=\"p1\">**</bpt>Task 1<ept id=\"p1\">**</ept> - Configure certificate templates on the certification authority.","source":"**Task 1** - Configure certificate templates on the certification authority."},{"pos":[4829,4906],"content":"<bpt id=\"p1\">**</bpt>Task 2<ept id=\"p1\">**</ept> - Enable, install, and configure the Intune Certificate Connector.","source":"**Task 2** - Enable, install, and configure the Intune Certificate Connector."},{"content":"Task 1 - Configure certificate templates on the certification authority","pos":[4912,4983]},{"content":"In this task, you will publish the certificate template.","pos":[4984,5040]},{"content":"To configure the certification authority","pos":[5048,5088]},{"content":"On the issuing CA, use the Certificate Templates snap-in to create a new custom template, or copy and edit an existing template (like the User template), for use with .PFX.","pos":[5094,5266]},{"content":"The template must include the following:","pos":[5272,5312]},{"pos":[5322,5384],"content":"Specify a friendly <bpt id=\"p1\">**</bpt>Template display name<ept id=\"p1\">**</ept> for the template.","source":"Specify a friendly **Template display name** for the template."},{"content":"On the <bpt id=\"p1\">**</bpt>Subject Name<ept id=\"p1\">**</ept> tab, select <bpt id=\"p2\">**</bpt>Supply in the request<ept id=\"p2\">**</ept>.","pos":[5394,5456],"source":"On the **Subject Name** tab, select **Supply in the request**."},{"content":"(Security is enforced by the Intune policy module for NDES).","pos":[5457,5517]},{"pos":[5527,5640],"content":"On the <bpt id=\"p1\">**</bpt>Extensions<ept id=\"p1\">**</ept> tab, ensure the <bpt id=\"p2\">**</bpt>Description of Application Policies<ept id=\"p2\">**</ept> includes <bpt id=\"p3\">**</bpt>Client Authentication<ept id=\"p3\">**</ept>.","source":"On the **Extensions** tab, ensure the **Description of Application Policies** includes **Client Authentication**."},{"pos":[5652,5830],"content":"[!IMPORTANT]\nFor iOS and Mac OS X certificate templates, on the **Extensions** tab, edit **Key Usage** and ensure that **Signature is proof of origin** is not selected.","leadings":["","        > "],"nodes":[{"content":"For iOS and Mac OS X certificate templates, on the <bpt id=\"p1\">**</bpt>Extensions<ept id=\"p1\">**</ept> tab, edit <bpt id=\"p2\">**</bpt>Key Usage<ept id=\"p2\">**</ept> and ensure that <bpt id=\"p3\">**</bpt>Signature is proof of origin<ept id=\"p3\">**</ept> is not selected.","pos":[13,168],"source":"For iOS and Mac OS X certificate templates, on the **Extensions** tab, edit **Key Usage** and ensure that **Signature is proof of origin** is not selected."}]},{"content":"Review the <bpt id=\"p1\">**</bpt>Validity period<ept id=\"p1\">**</ept> on the <bpt id=\"p2\">**</bpt>General<ept id=\"p2\">**</ept> tab of the template.","pos":[5836,5906],"source":"Review the **Validity period** on the **General** tab of the template."},{"content":"By default, Intune uses the value configured in the template.","pos":[5907,5968]},{"content":"However, you have the option to configure the CA to allow the requester to specify a different value, which you can then set from within the Intune Administrator console.","pos":[5969,6139]},{"content":"If you want to always use the value in the template, skip the remainder of this step.","pos":[6140,6225]},{"pos":[6233,6370],"content":"[!IMPORTANT]\nThe iOS and Mac OS X platforms always uses the value set in the template, regardless of other configurations you make.","leadings":["","    > "],"nodes":[{"content":"The iOS and Mac OS X platforms always uses the value set in the template, regardless of other configurations you make.","pos":[13,131]}]},{"content":"To configure the CA to allow the requester to specify the validity period, run the following commands on the CA:","pos":[6376,6488]},{"content":"a.","pos":[6494,6496]},{"content":"<bpt id=\"p1\">**</bpt>certutil -setreg Policy\\EditFlags +EDITF_ATTRIBUTEENDDATE<ept id=\"p1\">**</ept>","pos":[6498,6559],"source":"**certutil -setreg Policy\\EditFlags +EDITF_ATTRIBUTEENDDATE**"},{"content":"b.","pos":[6565,6567]},{"content":"<bpt id=\"p1\">**</bpt>net stop certsvc<ept id=\"p1\">**</ept>","pos":[6569,6589],"source":"**net stop certsvc**"},{"content":"c.","pos":[6595,6597]},{"content":"<bpt id=\"p1\">**</bpt>net start certsvc<ept id=\"p1\">**</ept>","pos":[6599,6620],"source":"**net start certsvc**"},{"content":"On the issuing CA, use the Certification Authority snap-in to publish the certificate template.","pos":[6626,6721]},{"content":"a.","pos":[6727,6729]},{"content":"Select the <bpt id=\"p1\">**</bpt>Certificate Templates<ept id=\"p1\">**</ept> node, click <bpt id=\"p2\">**</bpt>Action<ept id=\"p2\">**</ept><ph id=\"ph1\">-</ph><ph id=\"ph2\">&amp;gt;</ph> <bpt id=\"p3\">**</bpt>New<ept id=\"p3\">**</ept> <ph id=\"ph3\">&amp;gt;</ph> <bpt id=\"p4\">**</bpt>Certificate Template to Issue<ept id=\"p4\">**</ept>, and then select the template you created in step 2.","pos":[6731,6895],"source":"  Select the **Certificate Templates** node, click **Action**-&gt; **New** &gt; **Certificate Template to Issue**, and then select the template you created in step 2."},{"content":"b.","pos":[6901,6903]},{"content":"Validate that the template published by viewing it under the <bpt id=\"p1\">**</bpt>Certificate Templates<ept id=\"p1\">**</ept> folder.","pos":[6905,6999],"source":"  Validate that the template published by viewing it under the **Certificate Templates** folder."},{"content":"On the CA computer, ensure that the computer that hosts the Intune Certificate Connector has enroll permission, so that it can access the template used in creating the .PFX profile.","pos":[7005,7186]},{"content":"Set that permission on the <bpt id=\"p1\">**</bpt>Security<ept id=\"p1\">**</ept> tab of the CA computer properties.","pos":[7187,7261],"source":" Set that permission on the **Security** tab of the CA computer properties."},{"content":"Task 2 - Enable, install, and configure the Intune Certificate Connector","pos":[7267,7339]},{"content":"In this task you will:","pos":[7340,7362]},{"content":"Download, install, and configure the Certificate Connector.","pos":[7364,7423]},{"content":"To enable support for the Certificate Connector","pos":[7431,7478]},{"pos":[7484,7608],"content":"Open the <bpt id=\"p1\">[</bpt>Intune administration console<ept id=\"p1\">](https://manage.microsoft.com)</ept>, and choose <bpt id=\"p2\">**</bpt>Admin<ept id=\"p2\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p3\">**</bpt>Certificate Connector<ept id=\"p3\">**</ept>.","source":"Open the [Intune administration console](https://manage.microsoft.com), and choose **Admin** &gt; **Certificate Connector**."},{"pos":[7614,7669],"content":"Choose <bpt id=\"p1\">**</bpt>Configure On-Premises Certificate Connector<ept id=\"p1\">**</ept>.","source":"Choose **Configure On-Premises Certificate Connector**."},{"pos":[7675,7739],"content":"Select <bpt id=\"p1\">**</bpt>Enable Certificate Connector<ept id=\"p1\">**</ept>, and then choose <bpt id=\"p2\">**</bpt>OK<ept id=\"p2\">**</ept>.","source":"Select **Enable Certificate Connector**, and then choose **OK**."},{"content":"To download, install, and configure the Certificate Connector","pos":[7747,7808]},{"pos":[7814,8017],"content":"Open the <bpt id=\"p1\">[</bpt>Intune administration console<ept id=\"p1\">](https://manage.microsoft.com)</ept>, and then choose <bpt id=\"p2\">**</bpt>Admin<ept id=\"p2\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p3\">**</bpt>Mobile Device Management<ept id=\"p3\">**</ept> <ph id=\"ph2\">&amp;gt;</ph> <bpt id=\"p4\">**</bpt>Certificate Connector<ept id=\"p4\">**</ept> <ph id=\"ph3\">&amp;gt;</ph> <bpt id=\"p5\">**</bpt>Download Certificate Connector<ept id=\"p5\">**</ept>.","source":"Open the [Intune administration console](https://manage.microsoft.com), and then choose **Admin** &gt; **Mobile Device Management** &gt; **Certificate Connector** &gt; **Download Certificate Connector**."},{"pos":[8023,8112],"content":"After the download completes, run the downloaded installer (<bpt id=\"p1\">**</bpt>ndesconnectorssetup.exe<ept id=\"p1\">**</ept>).","source":"After the download completes, run the downloaded installer (**ndesconnectorssetup.exe**)."},{"content":"Run the installer on the computer that is able to connect with the Certification Authority.","pos":[8116,8207]},{"content":"Choose the .PFX Distribution option, and then choose <bpt id=\"p1\">**</bpt>Install<ept id=\"p1\">**</ept>.","pos":[8208,8273],"source":" Choose the .PFX Distribution option, and then choose **Install**."},{"content":"When the installation has completed, continue by creating a certificate profile as described in <bpt id=\"p1\">[</bpt>Configure certificate profiles<ept id=\"p1\">](configure-intune-certificate-profiles.md)</ept>.","pos":[8274,8445],"source":" When the installation has completed, continue by creating a certificate profile as described in [Configure certificate profiles](configure-intune-certificate-profiles.md)."},{"pos":[8492,8660],"content":"When prompted for the client certificate for the Certificate Connector, choose <bpt id=\"p1\">**</bpt>Select<ept id=\"p1\">**</ept>, and select the <bpt id=\"p2\">**</bpt>client authentication<ept id=\"p2\">**</ept> certificate you installed in Task 3.","source":"When prompted for the client certificate for the Certificate Connector, choose **Select**, and select the **client authentication** certificate you installed in Task 3."},{"content":"After you select the client authentication certificate, you are returned to the <bpt id=\"p1\">**</bpt>Client Certificate for Microsoft Intune Certificate Connector<ept id=\"p1\">**</ept> surface.","pos":[8666,8820],"source":"After you select the client authentication certificate, you are returned to the **Client Certificate for Microsoft Intune Certificate Connector** surface."},{"content":"Although the certificate you selected is not shown, choose <bpt id=\"p1\">**</bpt>Next<ept id=\"p1\">**</ept> to view the properties of that certificate.","pos":[8821,8932],"source":" Although the certificate you selected is not shown, choose **Next** to view the properties of that certificate."},{"content":"Then choose <bpt id=\"p1\">**</bpt>Next<ept id=\"p1\">**</ept>, and then <bpt id=\"p2\">**</bpt>Install<ept id=\"p2\">**</ept>.","pos":[8933,8976],"source":" Then choose **Next**, and then **Install**."},{"pos":[8982,9087],"content":"After the wizard completes, but before closing the wizard, click <bpt id=\"p1\">**</bpt>Launch the Certificate Connector UI<ept id=\"p1\">**</ept>.","source":"After the wizard completes, but before closing the wizard, click **Launch the Certificate Connector UI**."},{"pos":[9095,9230],"content":"[!TIP]\nIf you close the wizard before launching the Certificate Connector UI, you can reopen it by running the following command:","leadings":["","    > "],"nodes":[{"content":"If you close the wizard before launching the Certificate Connector UI, you can reopen it by running the following command:","pos":[7,129]}]},{"pos":[9243,9303],"content":"<bpt id=\"p1\">**</bpt><ph id=\"ph1\">&amp;lt;</ph>install_Path<ph id=\"ph2\">&amp;gt;</ph>\\NDESConnectorUI\\NDESConnectorUI.exe<ept id=\"p1\">**</ept>","source":"**&lt;install_Path&gt;\\NDESConnectorUI\\NDESConnectorUI.exe**"},{"pos":[9309,9345],"content":"In the <bpt id=\"p1\">**</bpt>Certificate Connector<ept id=\"p1\">**</ept> UI:","source":"In the **Certificate Connector** UI:"},{"content":"a.","pos":[9351,9353]},{"content":"Choose <bpt id=\"p1\">**</bpt>Sign In<ept id=\"p1\">**</ept> and enter your Intune service administrator credentials, or credentials for a tenant administrator with the global administration permission.","pos":[9354,9514],"source":" Choose **Sign In** and enter your Intune service administrator credentials, or credentials for a tenant administrator with the global administration permission."},{"content":"b.","pos":[9750,9752]},{"content":"Select the <bpt id=\"p1\">**</bpt>Advanced<ept id=\"p1\">**</ept> tab, and then provide credentials for an account that has the <bpt id=\"p2\">**</bpt>Issue and Manage Certificates<ept id=\"p2\">**</ept> permission on your issuing Certificate Authority.","pos":[9753,9922],"source":" Select the **Advanced** tab, and then provide credentials for an account that has the **Issue and Manage Certificates** permission on your issuing Certificate Authority."},{"content":"c.","pos":[9928,9930]},{"content":"Choose <bpt id=\"p1\">**</bpt>Apply<ept id=\"p1\">**</ept>.","pos":[9931,9948],"source":" Choose **Apply**."},{"content":"You can now close the Certificate Connector UI.","pos":[9954,10001]},{"content":"Open a command prompt and type <bpt id=\"p1\">**</bpt>services.msc<ept id=\"p1\">**</ept>.","pos":[10007,10055],"source":"Open a command prompt and type **services.msc**."},{"content":"Then press <bpt id=\"p1\">**</bpt>Enter<ept id=\"p1\">**</ept>, right-click the <bpt id=\"p2\">**</bpt>Intune Connector Service<ept id=\"p2\">**</ept>, and choose <bpt id=\"p3\">**</bpt>Restart<ept id=\"p3\">**</ept>.","pos":[10056,10147],"source":" Then press **Enter**, right-click the **Intune Connector Service**, and choose **Restart**."},{"pos":[10149,10270],"content":"To validate that the service is running, open a browser and enter the following URL, which should return a <bpt id=\"p1\">**</bpt>403<ept id=\"p1\">**</ept> error:","source":"To validate that the service is running, open a browser and enter the following URL, which should return a **403** error:"},{"pos":[10272,10340],"content":"<bpt id=\"p1\">**</bpt>http:// <ph id=\"ph1\">&amp;lt;</ph>FQDN_of_your_NDES_server<ph id=\"ph2\">&amp;gt;</ph>/certsrv/mscep/mscep.dll<ept id=\"p1\">**</ept>","source":"**http:// &lt;FQDN_of_your_NDES_server&gt;/certsrv/mscep/mscep.dll**"},{"content":"Next steps","pos":[10346,10356]},{"pos":[10357,10498],"content":"You are now ready to set up certificate profiles, as described in <bpt id=\"p1\">[</bpt>Configure certificate profiles<ept id=\"p1\">](Configure-Intune-certificate-profiles.md)</ept>.","source":"You are now ready to set up certificate profiles, as described in [Configure certificate profiles](Configure-Intune-certificate-profiles.md)."}],"content":"---\ntitle: Configure certificate infrastructure for PFX | Microsoft Intune\ndescription: Create and deploy .PFX certificate profiles.\nkeywords:\nauthor: nbigman\nmanager: angrobe\nms.date: 08/24/2016\nms.topic: article\nms.prod:\nms.service: microsoft-intune\nms.technology:\nms.assetid: 2c543a02-44a5-4964-8000-a45e3bf2cc69\n\n# optional metadata\n\n#ROBOTS:\n#audience:\n#ms.devlang:\nms.reviewer: vinaybha\nms.suite: ems\n#ms.tgt_pltfrm:\n#ms.custom:\n\n\n---\n# Configure certificate infrastructure\nThis topic describes what you need in order to create and deploy .PFX certificate profiles.\n\nTo do any certificate-based authentication in your organization, you need an Enterprise Certification Authority.\n\nTo use .PFX Certificate profiles, in addition to the Enterprise Certification Authority, you  also need:\n\n-   A computer that can communicate with the Certification Authority, or you can use the Certification Authority computer itself.\n\n-  The Intune Certificate Connector, which runs on the computer that can communicate with the Certification Authority.\n\n## On-premises infrastructure description\n\n\n-    **Active Directory domain**: All servers listed in this section (except for the Web Application Proxy Server) must be joined to your Active Directory domain.\n\n-  **Certification Authority**: An Enterprise Certification Authority (CA) that runs on an Enterprise edition of Windows Server 2008 R2 or later. A Standalone CA is not supported. For instructions on how to set up a Certification Authority, see [Install the Certification Authority](http://technet.microsoft.com/library/jj125375.aspx).\n    If your CA runs Windows Server 2008 R2, you must [install the hotfix from KB2483564](http://support.microsoft.com/kb/2483564/).\n\n-  **Computer that can communicate with Certification Authority**: Alternatively, use the Certification Authority computer itself.\n-  **Microsoft Intune Certificate Connector**: You use the Intune admin console to download the **Certificate Connector** installer (**ndesconnectorssetup.exe**). Then you can run **ndesconnectorssetup.exe** on the computer where you want to install the Certificate Connector. For .PFX Certificate profiles, install the Certificate Connector on the computer that communicates with the Certification Authority.\n-  **Web Application Proxy server** (optional): You can use a server that runs Windows Server 2012 R2 or later as a Web Application Proxy (WAP) server. This configuration:\n    -  Allows devices to receive certificates using an Internet connection.\n    -  Is a security recommendation when devices connect through the Internet to receive and renew certificates.\n\n > [!NOTE]           \n> -    The server that hosts WAP [must install an update](http://blogs.technet.com/b/ems/archive/2014/12/11/hotfix-large-uri-request-in-web-application-proxy-on-windows-server-2012-r2.aspx) that enables support for the long URLs that are used by the Network Device Enrollment Service (NDES). This update is included with the [December 2014 update rollup](http://support.microsoft.com/kb/3013769), or individually from [KB3011135](http://support.microsoft.com/kb/3011135).\n>-  Also, the server that hosts WAP must have an SSL certificate that matches the name being published to external clients as well as trust the SSL certificate that is used on the NDES server. These certificates enable the WAP server to terminate the SSL connection from clients, and create a new SSL connection to the NDES server.\n    For information about certificates for WAP, see the **Plan certificates** section of [Planning to Publish Applications Using Web Application Proxy](https://technet.microsoft.com/library/dn383650.aspx). For general information about WAP servers, see [Working with Web Application Proxy](http://technet.microsoft.com/library/dn584113.aspx).|\n\n\n### Certificates and Templates\n\n|Object|Details|\n|----------|-----------|\n|**Certificate Template**|You configure this template on your issuing CA.|\n|**Trusted Root CA certificate**|You export this as a **.cer** file from the issuing CA or any device which trusts the issuing CA, and deploy it to devices by using the Trusted CA certificate profile.<br /><br />You use a single Trusted Root CA certificate per operating system platform, and associate it with each Trusted Root Certificate profile you create.<br /><br />You can use additional Trusted Root CA certificates when needed. For example, you might do this to provide a trust to a CA that signs the server authentication certificates for your Wi-Fi access points.|\n\n\n## Configure your infrastructure\nBefore you can configure certificate profiles, you must complete the following tasks. These tasks require knowledge of Windows Server 2012 R2 and Active Directory Certificate Services (ADCS):\n\n- **Task 1** - Configure certificate templates on the certification authority.\n- **Task 2** - Enable, install, and configure the Intune Certificate Connector.\n\n### Task 1 - Configure certificate templates on the certification authority\nIn this task, you will publish the certificate template.\n\n##### To configure the certification authority\n\n1.  On the issuing CA, use the Certificate Templates snap-in to create a new custom template, or copy and edit an existing template (like the User template), for use with .PFX.\n\n    The template must include the following:\n\n    -   Specify a friendly **Template display name** for the template.\n\n    -   On the **Subject Name** tab, select **Supply in the request**. (Security is enforced by the Intune policy module for NDES).\n\n    -   On the **Extensions** tab, ensure the **Description of Application Policies** includes **Client Authentication**.\n\n        > [!IMPORTANT]\n        > For iOS and Mac OS X certificate templates, on the **Extensions** tab, edit **Key Usage** and ensure that **Signature is proof of origin** is not selected.\n\n2.  Review the **Validity period** on the **General** tab of the template. By default, Intune uses the value configured in the template. However, you have the option to configure the CA to allow the requester to specify a different value, which you can then set from within the Intune Administrator console. If you want to always use the value in the template, skip the remainder of this step.\n\n    > [!IMPORTANT]\n    > The iOS and Mac OS X platforms always uses the value set in the template, regardless of other configurations you make.\n\n    To configure the CA to allow the requester to specify the validity period, run the following commands on the CA:\n\n    a.  **certutil -setreg Policy\\EditFlags +EDITF_ATTRIBUTEENDDATE**\n\n    b.  **net stop certsvc**\n\n    c.  **net start certsvc**\n\n3.  On the issuing CA, use the Certification Authority snap-in to publish the certificate template.\n\n    a.  Select the **Certificate Templates** node, click **Action**-&gt; **New** &gt; **Certificate Template to Issue**, and then select the template you created in step 2.\n\n    b.  Validate that the template published by viewing it under the **Certificate Templates** folder.\n\n4.  On the CA computer, ensure that the computer that hosts the Intune Certificate Connector has enroll permission, so that it can access the template used in creating the .PFX profile. Set that permission on the **Security** tab of the CA computer properties.\n\n### Task 2 - Enable, install, and configure the Intune Certificate Connector\nIn this task you will:\n\nDownload, install, and configure the Certificate Connector.\n\n##### To enable support for the Certificate Connector\n\n1.  Open the [Intune administration console](https://manage.microsoft.com), and choose **Admin** &gt; **Certificate Connector**.\n\n2.  Choose **Configure On-Premises Certificate Connector**.\n\n3.  Select **Enable Certificate Connector**, and then choose **OK**.\n\n##### To download, install, and configure the Certificate Connector\n\n1.  Open the [Intune administration console](https://manage.microsoft.com), and then choose **Admin** &gt; **Mobile Device Management** &gt; **Certificate Connector** &gt; **Download Certificate Connector**.\n\n2.  After the download completes, run the downloaded installer (**ndesconnectorssetup.exe**).\n\n  Run the installer on the computer that is able to connect with the Certification Authority. Choose the .PFX Distribution option, and then choose **Install**. When the installation has completed, continue by creating a certificate profile as described in [Configure certificate profiles](configure-intune-certificate-profiles.md).\n\n   <!-- Not sure about step 3 below -->\n\n3.  When prompted for the client certificate for the Certificate Connector, choose **Select**, and select the **client authentication** certificate you installed in Task 3.\n\n    After you select the client authentication certificate, you are returned to the **Client Certificate for Microsoft Intune Certificate Connector** surface. Although the certificate you selected is not shown, choose **Next** to view the properties of that certificate. Then choose **Next**, and then **Install**.\n\n4.  After the wizard completes, but before closing the wizard, click **Launch the Certificate Connector UI**.\n\n    > [!TIP]\n    > If you close the wizard before launching the Certificate Connector UI, you can reopen it by running the following command:\n    >\n    > **&lt;install_Path&gt;\\NDESConnectorUI\\NDESConnectorUI.exe**\n\n5.  In the **Certificate Connector** UI:\n\n    a. Choose **Sign In** and enter your Intune service administrator credentials, or credentials for a tenant administrator with the global administration permission.\n\n  <!--  If your organization uses a proxy server and the proxy is needed for the NDES server to access the Internet, click **Use proxy server** and then provide the proxy server name, port, and account credentials to connect.-->\n\n    b. Select the **Advanced** tab, and then provide credentials for an account that has the **Issue and Manage Certificates** permission on your issuing Certificate Authority.\n\n    c. Choose **Apply**.\n\n    You can now close the Certificate Connector UI.\n\n6.  Open a command prompt and type **services.msc**. Then press **Enter**, right-click the **Intune Connector Service**, and choose **Restart**.\n\nTo validate that the service is running, open a browser and enter the following URL, which should return a **403** error:\n\n**http:// &lt;FQDN_of_your_NDES_server&gt;/certsrv/mscep/mscep.dll**\n\n### Next steps\nYou are now ready to set up certificate profiles, as described in [Configure certificate profiles](Configure-Intune-certificate-profiles.md).\n"}