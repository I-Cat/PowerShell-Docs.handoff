{"nodes":[{"pos":[32,76],"content":"Planning your ATA Deployment | Microsoft ATA","needQuote":true,"nodes":[{"content":"Planning your ATA Deployment | Microsoft ATA","pos":[0,44]}]},{"pos":[90,191],"content":"Helps you plan your deployment and decide how many ATA servers will be needed to support your network","needQuote":true,"nodes":[{"content":"Helps you plan your deployment and decide how many ATA servers will be needed to support your network","pos":[0,101]}]},{"pos":[505,556],"content":"<bpt id=\"p1\">*</bpt>Applies to: Advanced Threat Analytics version 1.7<ept id=\"p1\">*</ept>","source":"*Applies to: Advanced Threat Analytics version 1.7*"},{"content":"ATA Capacity Planning","pos":[562,583]},{"content":"This topic helps you determine how many ATA servers will be needed to monitor your network, including understanding how many ATA Gateways and/or ATA Lightweight Gateways you need and the server capacity for your ATA Center and ATA Gateways.","pos":[584,824]},{"content":"Using the sizing tool","pos":[828,849]},{"content":"The recommended and simplest way to determine capacity for your ATA deployment is to use the <bpt id=\"p1\">[</bpt>ATA Sizing Tool<ept id=\"p1\">](http://aka.ms/atasizingtool)</ept>.","pos":[850,990],"source":"The recommended and simplest way to determine capacity for your ATA deployment is to use the [ATA Sizing Tool](http://aka.ms/atasizingtool)."},{"content":"Run the ATA Sizing Tool and from the Excel file results, use the following fields to determine the ATA capacity you need:","pos":[991,1112]},{"pos":[1116,1306],"content":"ATA Center CPU and Memory: Match the <bpt id=\"p1\">**</bpt>Busy Packets/sec<ept id=\"p1\">**</ept> field in the ATA Center table in the results file to the <bpt id=\"p2\">**</bpt>PACKETS PER SECOND<ept id=\"p2\">**</ept> field in the <bpt id=\"p3\">[</bpt>ATA Center table<ept id=\"p3\">](#ata-center-sizing)</ept>.","source":"ATA Center CPU and Memory: Match the **Busy Packets/sec** field in the ATA Center table in the results file to the **PACKETS PER SECOND** field in the [ATA Center table](#ata-center-sizing)."},{"pos":[1310,1492],"content":"ATA Center Storage: Match the <bpt id=\"p1\">**</bpt>Avg Packets/sec<ept id=\"p1\">**</ept> field in the ATA Center table in the results file to the <bpt id=\"p2\">**</bpt>PACKETS PER SECOND<ept id=\"p2\">**</ept> field in the <bpt id=\"p3\">[</bpt>ATA Center table<ept id=\"p3\">](#ata-center-sizing)</ept>.","source":"ATA Center Storage: Match the **Avg Packets/sec** field in the ATA Center table in the results file to the **PACKETS PER SECOND** field in the [ATA Center table](#ata-center-sizing)."},{"pos":[1495,1844],"content":"ATA Gateway: Match the <bpt id=\"p1\">**</bpt>Busy Packets/sec<ept id=\"p1\">**</ept> field in the ATA Gateway table in the results file to the <bpt id=\"p2\">**</bpt>PACKETS PER SECOND<ept id=\"p2\">**</ept> field in the <bpt id=\"p3\">[</bpt>ATA Gateway table<ept id=\"p3\">](#ata-gateway-sizing)</ept> or the <bpt id=\"p4\">[</bpt>ATA Lightweight Gateway table<ept id=\"p4\">](#ata-lightweight-gateway-sizing)</ept>, depending on the <bpt id=\"p5\">[</bpt>gateway type you choose<ept id=\"p5\">](#choosing-the-right-gateway-type-for-your-deployment)</ept>.","source":"ATA Gateway: Match the **Busy Packets/sec** field in the ATA Gateway table in the results file to the **PACKETS PER SECOND** field in the [ATA Gateway table](#ata-gateway-sizing) or the [ATA Lightweight Gateway table](#ata-lightweight-gateway-sizing), depending on the [gateway type you choose](#choosing-the-right-gateway-type-for-your-deployment)."},{"content":"Sample capacity planning tool","pos":[1849,1878]},{"content":"If for some reason you cannot use the ATA Sizing Tool, you need to manually gather the packet/sec counter information from all your Domain Controllers for a period of 24 hours with a very low collection interval (approximately 5 seconds).","pos":[1908,2146]},{"content":"Then, for each Domain Controller, you  must calculate the daily average and the busiest period (15 minutes) average.","pos":[2147,2263]},{"content":"The following sections present the instruction for how to collect the packets/sec counter from one Domain Controller.","pos":[2264,2381],"source":"\nThe following sections present the instruction for how to collect the packets/sec counter from one Domain Controller."},{"content":"ATA Center Sizing","pos":[2389,2406]},{"content":"The ATA Center requires a recommended minimum of 30 days of data for user behavioral analytics.","pos":[2407,2502]},{"content":"The required disk space for the ATA database on a per domain controller basis is defined below.","pos":[2503,2598]},{"content":"If you have multiple domain controllers, sum up the required disk space per domain controller to calculate the full amount of space required for the ATA database.","pos":[2599,2761]},{"content":"Packets per second&amp;#42;","pos":[2766,2789],"source":"Packets per second&#42;"},{"content":"CPU (cores&amp;#42;&amp;#42;)","pos":[2790,2811],"source":"CPU (cores&#42;&#42;)"},{"content":"Memory (GB)","pos":[2812,2823]},{"content":"Database storage per day (GB)","pos":[2824,2853]},{"content":"Database storage per month (GB)","pos":[2854,2885]},{"content":"IOPS&amp;#42;&amp;#42;&amp;#42;","pos":[2886,2905],"source":"IOPS&#42;&#42;&#42;"},{"content":"1,000","pos":[3090,3095]},{"content":"2","pos":[3096,3097]},{"content":"32","pos":[3098,3100]},{"content":"0.3","pos":[3101,3104]},{"content":"9","pos":[3105,3106]},{"content":"30 (100)","pos":[3107,3115]},{"content":"10,000","pos":[3117,3123]},{"content":"4","pos":[3124,3125]},{"content":"48","pos":[3126,3128]},{"content":"3","pos":[3129,3130]},{"content":"90","pos":[3131,3133]},{"content":"200 (300)","pos":[3134,3143]},{"content":"40,000","pos":[3145,3151]},{"content":"8","pos":[3152,3153]},{"content":"64","pos":[3154,3156]},{"content":"12","pos":[3157,3159]},{"content":"360","pos":[3160,3163]},{"content":"500 (1,000)","pos":[3164,3175]},{"content":"100,000","pos":[3177,3184]},{"content":"12","pos":[3185,3187]},{"content":"96","pos":[3188,3190]},{"content":"30","pos":[3191,3193]},{"content":"900","pos":[3194,3197]},{"content":"1,000 (1,500)","pos":[3198,3211]},{"content":"400,000","pos":[3213,3220]},{"content":"40","pos":[3221,3223]},{"content":"128","pos":[3224,3227]},{"content":"120","pos":[3228,3231]},{"content":"1,800","pos":[3232,3237]},{"content":"2,000 (2,500)","pos":[3238,3251]},{"content":"&amp;#42;Total daily average number of packets-per-second from all domain controllers being monitored by all ATA Gateways.","pos":[3252,3370],"source":"&#42;Total daily average number of packets-per-second from all domain controllers being monitored by all ATA Gateways."},{"content":"&amp;#42;&amp;#42;This includes physical cores, not hyper-threaded cores.","pos":[3372,3437],"source":"&#42;&#42;This includes physical cores, not hyper-threaded cores."},{"content":"&amp;#42;&amp;#42;&amp;#42;Average numbers (Peak numbers)","pos":[3439,3484],"source":"&#42;&#42;&#42;Average numbers (Peak numbers)"},{"content":"The ATA Center can handle an aggregated maximum of 400,000 frames per second (FPS) from all the monitored domain controllers.","pos":[3501,3626]},{"content":"The amounts of storage dictated here are net values, you should always account for future growth and to make sure that the disk the database resides on has at least 20% of free space.","pos":[3633,3816]},{"content":"If your free space reaches a minimum of either 20% or 100 GB, the oldest collection of data will be deleted.","pos":[3823,3931]},{"content":"This will continue to occur until 5% or 50 GB of free space remains at which point data collection will stop working.","pos":[3932,4049]},{"content":"The storage latency for read and write activities should be below 10 ms.","pos":[4056,4128]},{"content":"The ratio between read and write activities is approximately 1:3 below 100,000 packets-per-second and 1:6 above 100,000 packets-per-second.","pos":[4135,4274]},{"content":"When running as a virtual machine dynamic memory or any other memory ballooning feature is not supported.","pos":[4281,4386]},{"content":"For optimal performance, set the <bpt id=\"p1\">**</bpt>Power Option<ept id=\"p1\">**</ept> of the ATA Center to <bpt id=\"p2\">**</bpt>High Performance<ept id=\"p2\">**</ept>.","pos":[4393,4485],"source":"For optimal performance, set the **Power Option** of the ATA Center to **High Performance**."},{"content":"When working on a physical server, the ATA database necessitates that you <bpt id=\"p1\">**</bpt>disable<ept id=\"p1\">**</ept> Non-uniform memory access (NUMA) in the BIOS.","pos":[4496,4627],"source":"When working on a physical server, the ATA database necessitates that you **disable** Non-uniform memory access (NUMA) in the BIOS."},{"content":"Your system may refer to NUMA as Node Interleaving, in which case you will have to <bpt id=\"p1\">**</bpt>enable<ept id=\"p1\">**</ept> Node Interleaving in order to disable NUMA.","pos":[4628,4765],"source":" Your system may refer to NUMA as Node Interleaving, in which case you will have to **enable** Node Interleaving in order to disable NUMA."},{"content":"See your BIOS documentation for more information.","pos":[4766,4815]},{"content":"Note that this is not relevant when the ATA Center is running on a virtual server.","pos":[4816,4898]},{"content":"Choosing the right gateway type for your deployment","pos":[4904,4955]},{"content":"In an ATA deployment any combination of the ATA Gateway types is supported:","pos":[4956,5031]},{"content":"Only ATA Gateway(s)","pos":[5035,5054]},{"content":"Only ATA Lightweight Gateway(s)","pos":[5057,5088]},{"content":"A combination of both","pos":[5091,5112]},{"content":"When deciding the Gateway deployment type, consider the following:","pos":[5114,5180]},{"content":"Gateway type","pos":[5183,5195]},{"content":"Benefits","pos":[5196,5204]},{"content":"Cost","pos":[5205,5209]},{"content":"Deployment topology","pos":[5210,5229]},{"content":"Domain controller use","pos":[5230,5251]},{"content":"ATA Gateway","pos":[5282,5293]},{"content":"The Out of band deployment makes it harder for attackers to discover ATA is present","pos":[5294,5377]},{"content":"Higher","pos":[5378,5384]},{"content":"Installed alongside the domain controller (out of band)","pos":[5385,5440]},{"content":"Supports up to 50,000 packets per second","pos":[5441,5481]},{"content":"ATA Lightweight Gateway","pos":[5484,5507]},{"content":"Doesn't require a dedicated server and port-mirroring configuration","pos":[5508,5575]},{"content":"Lower","pos":[5576,5581]},{"content":"Installed on the domain controller","pos":[5582,5616]},{"content":"Supports up to 10,000 packets per second","pos":[5617,5657]},{"content":"The following are examples of scenarios in which domain controllers should be covered by the ATA Lightweight Gateway:","pos":[5660,5777]},{"content":"Branch sites","pos":[5782,5794]},{"content":"Virtual domain controllers deployed in the cloud (IaaS)","pos":[5798,5853]},{"content":"The following are examples of scenarios in which domain controllers should be covered by the ATA Gateway:","pos":[5856,5961]},{"content":"Headquarter data centers (having domain controllers with more than 10,000 packets per seconds)","pos":[5966,6060]},{"content":"ATA Lightweight Gateway Sizing","pos":[6067,6097]},{"content":"An ATA Lightweight Gateway can support the monitoring of one domain controller based on the amount of network traffic the domain controller generates.","pos":[6099,6249]},{"content":"Packets per second&amp;#42;","pos":[6254,6277],"source":"Packets per second&#42;"},{"content":"CPU (cores&amp;#42;&amp;#42;)","pos":[6278,6299],"source":"CPU (cores&#42;&#42;)"},{"content":"Memory (GB)&amp;#42;&amp;#42;&amp;#42;","pos":[6300,6326],"source":"Memory (GB)&#42;&#42;&#42;"},{"content":"1,000","pos":[6401,6406]},{"content":"2","pos":[6407,6408]},{"content":"6","pos":[6409,6410]},{"content":"5,000","pos":[6413,6418]},{"content":"6","pos":[6419,6420]},{"content":"16","pos":[6421,6423]},{"content":"10,000","pos":[6430,6436]},{"content":"10","pos":[6437,6439]},{"content":"24","pos":[6440,6442]},{"content":"&amp;#42;Total number of packets-per-second on the domain controller being monitored by the specific ATA Lightweight Gateway.","pos":[6445,6566],"source":"&#42;Total number of packets-per-second on the domain controller being monitored by the specific ATA Lightweight Gateway."},{"content":"&amp;#42;&amp;#42;Total amount of non-hyper threaded cores that this domain controller has installed.","pos":[6568,6661],"source":"&#42;&#42;Total amount of non-hyper threaded cores that this domain controller has installed."},{"content":"While hyper threading is acceptable for the ATA Lightweight Gateway, when planning for capacity, you should count actual cores and not hyper threaded cores.","pos":[6665,6821]},{"content":"&amp;#42;&amp;#42;&amp;#42;Total amount of memory that this domain controller has installed.","pos":[6823,6903],"source":"&#42;&#42;&#42;Total amount of memory that this domain controller has installed."},{"content":"If the domain controller does not have the necessary amount of resources required by the ATA Lightweight Gateway, the domain controller performance will not be effected, but the ATA Lightweight Gateway might not operate as expected.","pos":[6924,7156]},{"content":"When running as a virtual machine dynamic memory or any other memory ballooning feature is not supported.","pos":[7163,7268]},{"pos":[7275,7380],"content":"For optimal performance, set the <bpt id=\"p1\">**</bpt>Power Option<ept id=\"p1\">**</ept> of the ATA Lightweight Gateway to <bpt id=\"p2\">**</bpt>High Performance<ept id=\"p2\">**</ept>.","source":"For optimal performance, set the **Power Option** of the ATA Lightweight Gateway to **High Performance**."},{"content":"ATA Gateway Sizing","pos":[7387,7405]},{"content":"Consider the following when deciding how many ATA Gateways to deploy.","pos":[7407,7476]},{"pos":[7482,7817],"content":"**Active Directory forests and domains**<br>\nATA can monitor traffic from multiple domains from a single Active Directory forest. Monitoring multiple Active Directory forests requires separate ATA deployments. A single ATA deployment should not be configured to monitor network traffic of domain controllers from different forests.","leadings":["","    "],"nodes":[{"content":"<bpt id=\"p1\">**</bpt>Active Directory forests and domains<ept id=\"p1\">**</ept>","pos":[0,40],"source":"**Active Directory forests and domains**"},{"content":"\nATA can monitor traffic from multiple domains from a single Active Directory forest. Monitoring multiple Active Directory forests requires separate ATA deployments. A single ATA deployment should not be configured to monitor network traffic of domain controllers from different forests.","pos":[44,331],"nodes":[{"content":"ATA can monitor traffic from multiple domains from a single Active Directory forest.","pos":[1,85],"source":"\nATA can monitor traffic from multiple domains from a single Active Directory forest."},{"content":"Monitoring multiple Active Directory forests requires separate ATA deployments.","pos":[86,165]},{"content":"A single ATA deployment should not be configured to monitor network traffic of domain controllers from different forests.","pos":[166,287]}]}]},{"content":"<bpt id=\"p1\">**</bpt>Port Mirroring<ept id=\"p1\">**</ept>","pos":[7823,7841],"source":"**Port Mirroring**"},{"content":"Port mirroring considerations might require you to deploy multiple ATA Gateways per data center or branch site.","pos":[7846,7957],"source":"\nPort mirroring considerations might require you to deploy multiple ATA Gateways per data center or branch site."},{"pos":[7963,8142],"content":"**Capacity**<br>\nAn ATA Gateway can support monitoring multiple domain controllers, depending on the amount of network traffic of the domain controllers being monitored. \n<br>","leadings":["","    ",""],"nodes":[{"content":"<bpt id=\"p1\">**</bpt>Capacity<ept id=\"p1\">**</ept>","pos":[0,12],"source":"**Capacity**"},{"content":"\nAn ATA Gateway can support monitoring multiple domain controllers, depending on the amount of network traffic of the domain controllers being monitored. \n","pos":[16,171],"nodes":[{"content":"An ATA Gateway can support monitoring multiple domain controllers, depending on the amount of network traffic of the domain controllers being monitored.","pos":[1,153],"source":"\nAn ATA Gateway can support monitoring multiple domain controllers, depending on the amount of network traffic of the domain controllers being monitored."}]}]},{"content":"Packets per second&amp;#42;","pos":[8147,8170],"source":"Packets per second&#42;"},{"content":"CPU (cores&amp;#42;&amp;#42;)","pos":[8171,8192],"source":"CPU (cores&#42;&#42;)"},{"content":"Memory (GB)","pos":[8193,8204]},{"content":"1,000","pos":[8279,8284]},{"content":"1","pos":[8285,8286]},{"content":"6","pos":[8287,8288]},{"content":"5,000","pos":[8291,8296]},{"content":"2","pos":[8297,8298]},{"content":"10","pos":[8299,8301]},{"content":"10,000","pos":[8304,8310]},{"content":"3","pos":[8311,8312]},{"content":"12","pos":[8313,8315]},{"content":"20,000","pos":[8318,8324]},{"content":"6","pos":[8325,8326]},{"content":"24","pos":[8327,8329]},{"content":"50,000","pos":[8332,8338]},{"content":"16","pos":[8339,8341]},{"content":"48","pos":[8342,8344]},{"content":"&amp;#42;Total average number of packets-per-second from all domain controllers being monitored by the specific ATA Gateway during their busiest hour of the day.","pos":[8346,8503],"source":"&#42;Total average number of packets-per-second from all domain controllers being monitored by the specific ATA Gateway during their busiest hour of the day."},{"content":"&amp;#42;The total amount of domain controller port-mirrored traffic cannot exceed the capacity of the capture NIC on the ATA Gateway.","pos":[8505,8635],"source":"&#42;The total amount of domain controller port-mirrored traffic cannot exceed the capacity of the capture NIC on the ATA Gateway."},{"content":"&amp;#42;&amp;#42;Hyper-threading must be disabled.","pos":[8637,8680],"source":"&#42;&#42;Hyper-threading must be disabled."},{"content":"Dynamic memory is not supported.","pos":[8699,8731]},{"pos":[8738,8831],"content":"For optimal performance, set the <bpt id=\"p1\">**</bpt>Power Option<ept id=\"p1\">**</ept> of the ATA Gateway to <bpt id=\"p2\">**</bpt>High Performance<ept id=\"p2\">**</ept>.","source":"For optimal performance, set the **Power Option** of the ATA Gateway to **High Performance**."},{"content":"Domain controller traffic estimation","pos":[8837,8873]},{"content":"There are various tools that you can use to discover the average packets per second of your domain controllers.","pos":[8874,8985]},{"content":"If you do not have any tools that track this counter, you can use Performance Monitor to gather the required information.","pos":[8986,9107]},{"content":"To determine packets per second, perform the following on each domain controller:","pos":[9109,9190]},{"content":"Open Performance Monitor.","pos":[9196,9221]},{"content":"Performance monitor image","pos":[9229,9254]},{"pos":[9297,9328],"content":"Expand <bpt id=\"p1\">**</bpt>Data Collector Sets<ept id=\"p1\">**</ept>.","source":"Expand **Data Collector Sets**."},{"content":"Data collector sets image","pos":[9336,9361]},{"pos":[9404,9480],"content":"Right click <bpt id=\"p1\">**</bpt>User Defined<ept id=\"p1\">**</ept> and select <bpt id=\"p2\">**</bpt>New<ept id=\"p2\">**</ept> <ph id=\"ph1\">&amp;gt;</ph> <bpt id=\"p3\">**</bpt>Data Collector Set<ept id=\"p3\">**</ept>.","source":"Right click **User Defined** and select **New** &gt; **Data Collector Set**."},{"content":"New data collector set image","pos":[9488,9516]},{"pos":[9559,9636],"content":"Enter a name for the collector set and select <bpt id=\"p1\">**</bpt>Create Manually (Advanced)<ept id=\"p1\">**</ept>.","source":"Enter a name for the collector set and select **Create Manually (Advanced)**."},{"pos":[9642,9748],"content":"Under <bpt id=\"p1\">**</bpt>What type of data do you want to include?<ept id=\"p1\">**</ept>, select  <bpt id=\"p2\">**</bpt>Create data logs and Performance counter<ept id=\"p2\">**</ept>.","source":"Under **What type of data do you want to include?**, select  **Create data logs and Performance counter**."},{"content":"Type of data for new data collector set image","pos":[9756,9801]},{"pos":[9844,9917],"content":"Under <bpt id=\"p1\">**</bpt>Which performance counters would you like to log<ept id=\"p1\">**</ept> click <bpt id=\"p2\">**</bpt>Add<ept id=\"p2\">**</ept>.","source":"Under **Which performance counters would you like to log** click **Add**."},{"content":"Expand <bpt id=\"p1\">**</bpt>Network Adapter<ept id=\"p1\">**</ept> and select <bpt id=\"p2\">**</bpt>Packets/sec<ept id=\"p2\">**</ept> and select the proper instance.","pos":[9923,10008],"source":"Expand **Network Adapter** and select **Packets/sec** and select the proper instance."},{"content":"If you are not sure, you can select <bpt id=\"p1\">**</bpt><ph id=\"ph1\">&amp;lt;</ph>All instances<ph id=\"ph2\">&amp;gt;</ph><ept id=\"p1\">**</ept> and click <bpt id=\"p2\">**</bpt>Add<ept id=\"p2\">**</ept> and <bpt id=\"p3\">**</bpt>OK<ept id=\"p3\">**</ept>.","pos":[10009,10100],"source":" If you are not sure, you can select **&lt;All instances&gt;** and click **Add** and **OK**."},{"pos":[10108,10222],"content":"[!NOTE]\nTo do this, in a command line, run `ipconfig /all` to see the name of the adapter and configuration.","leadings":["","    > "],"nodes":[{"content":"To do this, in a command line, run <ph id=\"ph1\">`ipconfig /all`</ph> to see the name of the adapter and configuration.","pos":[8,108],"source":"To do this, in a command line, run `ipconfig /all` to see the name of the adapter and configuration."}]},{"content":"Add performance counters image","pos":[10230,10260]},{"pos":[10303,10350],"content":"Change the <bpt id=\"p1\">**</bpt>Sample interval<ept id=\"p1\">**</ept> to <bpt id=\"p2\">**</bpt>1 second<ept id=\"p2\">**</ept>.","source":"Change the **Sample interval** to **1 second**."},{"content":"Set the location where you want the data to be saved.","pos":[10355,10408]},{"pos":[10414,10521],"content":"Under <bpt id=\"p1\">**</bpt>Create the data collector set<ept id=\"p1\">**</ept>  select <bpt id=\"p2\">**</bpt>Start this data collector set now<ept id=\"p2\">**</ept> and click <bpt id=\"p3\">**</bpt>Finish<ept id=\"p3\">**</ept>.","source":"Under **Create the data collector set**  select **Start this data collector set now** and click **Finish**."},{"content":"You should now see the data collector set you just created with a green triangle indicating that it is working.","pos":[10527,10638]},{"pos":[10644,10753],"content":"After 24 hours, stop the data collector set, by right clicking the data collector set and selecting <bpt id=\"p1\">**</bpt>Stop<ept id=\"p1\">**</ept>.","source":"After 24 hours, stop the data collector set, by right clicking the data collector set and selecting **Stop**."},{"content":"Stop data collector set image","pos":[10761,10790]},{"content":"In File Explorer, browse to the folder where the .blg file was saved and double click it to open it in Performance Monitor.","pos":[10834,10957]},{"content":"Select the Packets/sec counter, and record the average and maximum values.","pos":[10963,11037]},{"content":"Packets per second counter image","pos":[11045,11077]},{"content":"See Also","pos":[11120,11128]},{"pos":[11131,11172],"content":"<bpt id=\"p1\">[</bpt>ATA prerequisites<ept id=\"p1\">](ata-prerequisites.md)</ept>","source":"[ATA prerequisites](ata-prerequisites.md)"},{"pos":[11175,11214],"content":"<bpt id=\"p1\">[</bpt>ATA architecture<ept id=\"p1\">](ata-architecture.md)</ept>","source":"[ATA architecture](ata-architecture.md)"},{"pos":[11217,11313],"content":"<bpt id=\"p1\">[</bpt>Check out the ATA forum!<ept id=\"p1\">](https://social.technet.microsoft.com/Forums/security/home?forum=mata)</ept>","source":"[Check out the ATA forum!](https://social.technet.microsoft.com/Forums/security/home?forum=mata)"}],"content":"---\n# required metadata\n\ntitle: Planning your ATA Deployment | Microsoft ATA\ndescription: Helps you plan your deployment and decide how many ATA servers will be needed to support your network\nkeywords:\nauthor: rkarlin\nmanager: mbaldwin\nms.date: 08/24/2016\nms.topic: get-started-article\nms.service: advanced-threat-analytics\nms.prod:\nms.assetid: 279d79f2-962c-4c6f-9702-29744a5d50e2\n\n# optional metadata\n\n#ROBOTS:\n#audience:\n#ms.devlang:\nms.reviewer: bennyl\nms.suite: ems\n#ms.tgt_pltfrm:\n#ms.custom:\n\n---\n\n*Applies to: Advanced Threat Analytics version 1.7*\n\n\n\n# ATA Capacity Planning\nThis topic helps you determine how many ATA servers will be needed to monitor your network, including understanding how many ATA Gateways and/or ATA Lightweight Gateways you need and the server capacity for your ATA Center and ATA Gateways.\n\n##Using the sizing tool\nThe recommended and simplest way to determine capacity for your ATA deployment is to use the [ATA Sizing Tool](http://aka.ms/atasizingtool). Run the ATA Sizing Tool and from the Excel file results, use the following fields to determine the ATA capacity you need:\n\n- ATA Center CPU and Memory: Match the **Busy Packets/sec** field in the ATA Center table in the results file to the **PACKETS PER SECOND** field in the [ATA Center table](#ata-center-sizing).\n\n- ATA Center Storage: Match the **Avg Packets/sec** field in the ATA Center table in the results file to the **PACKETS PER SECOND** field in the [ATA Center table](#ata-center-sizing).\n- ATA Gateway: Match the **Busy Packets/sec** field in the ATA Gateway table in the results file to the **PACKETS PER SECOND** field in the [ATA Gateway table](#ata-gateway-sizing) or the [ATA Lightweight Gateway table](#ata-lightweight-gateway-sizing), depending on the [gateway type you choose](#choosing-the-right-gateway-type-for-your-deployment).\n\n\n![Sample capacity planning tool](media/capacity tool.png)\n\n\n\nIf for some reason you cannot use the ATA Sizing Tool, you need to manually gather the packet/sec counter information from all your Domain Controllers for a period of 24 hours with a very low collection interval (approximately 5 seconds). Then, for each Domain Controller, you  must calculate the daily average and the busiest period (15 minutes) average.\nThe following sections present the instruction for how to collect the packets/sec counter from one Domain Controller.\n\n\n\n### ATA Center Sizing\nThe ATA Center requires a recommended minimum of 30 days of data for user behavioral analytics. The required disk space for the ATA database on a per domain controller basis is defined below. If you have multiple domain controllers, sum up the required disk space per domain controller to calculate the full amount of space required for the ATA database.\n \n\n|Packets per second&#42;|CPU (cores&#42;&#42;)|Memory (GB)|Database storage per day (GB)|Database storage per month (GB)|IOPS&#42;&#42;&#42;|\n|---------------------------|-------------------------|-------------------|---------------------------------|-----------------------------------|-----------------------------------|\n|1,000|2|32|0.3|9|30 (100)\n|10,000|4|48|3|90|200 (300)\n|40,000|8|64|12|360|500 (1,000)\n|100,000|12|96|30|900|1,000 (1,500)\n|400,000|40|128|120|1,800|2,000 (2,500)\n&#42;Total daily average number of packets-per-second from all domain controllers being monitored by all ATA Gateways.\n\n&#42;&#42;This includes physical cores, not hyper-threaded cores.\n\n&#42;&#42;&#42;Average numbers (Peak numbers)\n> [!NOTE]\n> -   The ATA Center can handle an aggregated maximum of 400,000 frames per second (FPS) from all the monitored domain controllers.\n> -   The amounts of storage dictated here are net values, you should always account for future growth and to make sure that the disk the database resides on has at least 20% of free space.\n> -   If your free space reaches a minimum of either 20% or 100 GB, the oldest collection of data will be deleted. This will continue to occur until 5% or 50 GB of free space remains at which point data collection will stop working.\n> -   The storage latency for read and write activities should be below 10 ms.\n> -   The ratio between read and write activities is approximately 1:3 below 100,000 packets-per-second and 1:6 above 100,000 packets-per-second.\n> -   When running as a virtual machine dynamic memory or any other memory ballooning feature is not supported.\n> -   For optimal performance, set the **Power Option** of the ATA Center to **High Performance**.<br>\n> -   When working on a physical server, the ATA database necessitates that you **disable** Non-uniform memory access (NUMA) in the BIOS. Your system may refer to NUMA as Node Interleaving, in which case you will have to **enable** Node Interleaving in order to disable NUMA. See your BIOS documentation for more information. Note that this is not relevant when the ATA Center is running on a virtual server.\n\n\n## Choosing the right gateway type for your deployment\nIn an ATA deployment any combination of the ATA Gateway types is supported:\n\n- Only ATA Gateway(s)\n- Only ATA Lightweight Gateway(s)\n- A combination of both\n\nWhen deciding the Gateway deployment type, consider the following:\n\n|Gateway type|Benefits|Cost|Deployment topology|Domain controller use|\n|----|----|----|----|-----|\n|ATA Gateway|The Out of band deployment makes it harder for attackers to discover ATA is present|Higher|Installed alongside the domain controller (out of band)|Supports up to 50,000 packets per second|\n|ATA Lightweight Gateway|Doesn't require a dedicated server and port-mirroring configuration|Lower|Installed on the domain controller|Supports up to 10,000 packets per second|\n\nThe following are examples of scenarios in which domain controllers should be covered by the ATA Lightweight Gateway:\n\n\n- Branch sites\n\n- Virtual domain controllers deployed in the cloud (IaaS)\n\n\nThe following are examples of scenarios in which domain controllers should be covered by the ATA Gateway:\n\n\n- Headquarter data centers (having domain controllers with more than 10,000 packets per seconds)\n\n\n### ATA Lightweight Gateway Sizing\n\nAn ATA Lightweight Gateway can support the monitoring of one domain controller based on the amount of network traffic the domain controller generates. \n\n\n|Packets per second&#42;|CPU (cores&#42;&#42;)|Memory (GB)&#42;&#42;&#42;|\n|---------------------------|-------------------------|---------------|\n|1,000|2|6|\n|5,000|6|16|\n    |10,000|10|24|\n\n&#42;Total number of packets-per-second on the domain controller being monitored by the specific ATA Lightweight Gateway.\n\n&#42;&#42;Total amount of non-hyper threaded cores that this domain controller has installed.<br>While hyper threading is acceptable for the ATA Lightweight Gateway, when planning for capacity, you should count actual cores and not hyper threaded cores.\n\n&#42;&#42;&#42;Total amount of memory that this domain controller has installed.\n\n> [!NOTE]   \n> -   If the domain controller does not have the necessary amount of resources required by the ATA Lightweight Gateway, the domain controller performance will not be effected, but the ATA Lightweight Gateway might not operate as expected.\n> -   When running as a virtual machine dynamic memory or any other memory ballooning feature is not supported.\n> -   For optimal performance, set the **Power Option** of the ATA Lightweight Gateway to **High Performance**.\n\n\n### ATA Gateway Sizing\n\nConsider the following when deciding how many ATA Gateways to deploy.\n\n-   **Active Directory forests and domains**<br>\n    ATA can monitor traffic from multiple domains from a single Active Directory forest. Monitoring multiple Active Directory forests requires separate ATA deployments. A single ATA deployment should not be configured to monitor network traffic of domain controllers from different forests.\n\n-   **Port Mirroring**<br>\nPort mirroring considerations might require you to deploy multiple ATA Gateways per data center or branch site.\n\n-   **Capacity**<br>\n    An ATA Gateway can support monitoring multiple domain controllers, depending on the amount of network traffic of the domain controllers being monitored. \n<br>\n\n\n\n|Packets per second&#42;|CPU (cores&#42;&#42;)|Memory (GB)|\n|---------------------------|-------------------------|---------------|\n|1,000|1|6|\n|5,000|2|10|\n|10,000|3|12|\n|20,000|6|24|\n|50,000|16|48|\n&#42;Total average number of packets-per-second from all domain controllers being monitored by the specific ATA Gateway during their busiest hour of the day.\n\n&#42;The total amount of domain controller port-mirrored traffic cannot exceed the capacity of the capture NIC on the ATA Gateway.\n\n&#42;&#42;Hyper-threading must be disabled.\n\n> [!NOTE] \n> -   Dynamic memory is not supported.\n> -   For optimal performance, set the **Power Option** of the ATA Gateway to **High Performance**.\n\n\n## Domain controller traffic estimation\nThere are various tools that you can use to discover the average packets per second of your domain controllers. If you do not have any tools that track this counter, you can use Performance Monitor to gather the required information.\n\nTo determine packets per second, perform the following on each domain controller:\n\n1.  Open Performance Monitor.\n\n    ![Performance monitor image](media/ATA-traffic-estimation-1.png)\n\n2.  Expand **Data Collector Sets**.\n\n    ![Data collector sets image](media/ATA-traffic-estimation-2.png)\n\n3.  Right click **User Defined** and select **New** &gt; **Data Collector Set**.\n\n    ![New data collector set image](media/ATA-traffic-estimation-3.png)\n\n4.  Enter a name for the collector set and select **Create Manually (Advanced)**.\n\n5.  Under **What type of data do you want to include?**, select  **Create data logs and Performance counter**.\n\n    ![Type of data for new data collector set image](media/ATA-traffic-estimation-5.png)\n\n6.  Under **Which performance counters would you like to log** click **Add**.\n\n7.  Expand **Network Adapter** and select **Packets/sec** and select the proper instance. If you are not sure, you can select **&lt;All instances&gt;** and click **Add** and **OK**.\n\n    > [!NOTE]\n    > To do this, in a command line, run `ipconfig /all` to see the name of the adapter and configuration.\n\n    ![Add performance counters image](media/ATA-traffic-estimation-7.png)\n\n8.  Change the **Sample interval** to **1 second**.\n\n9. Set the location where you want the data to be saved.\n\n10. Under **Create the data collector set**  select **Start this data collector set now** and click **Finish**.\n\n    You should now see the data collector set you just created with a green triangle indicating that it is working.\n\n11. After 24 hours, stop the data collector set, by right clicking the data collector set and selecting **Stop**.\n\n    ![Stop data collector set image](media/ATA-traffic-estimation-12.png)\n\n12. In File Explorer, browse to the folder where the .blg file was saved and double click it to open it in Performance Monitor.\n\n13. Select the Packets/sec counter, and record the average and maximum values.\n\n    ![Packets per second counter image](media/ATA-traffic-estimation-14.png)\n\n## See Also\n- [ATA prerequisites](ata-prerequisites.md)\n- [ATA architecture](ata-architecture.md)\n- [Check out the ATA forum!](https://social.technet.microsoft.com/Forums/security/home?forum=mata)\n"}