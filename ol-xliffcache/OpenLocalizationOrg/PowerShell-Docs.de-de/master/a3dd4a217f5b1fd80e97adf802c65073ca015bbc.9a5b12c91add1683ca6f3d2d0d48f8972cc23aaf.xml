{"nodes":[{"pos":[105,126],"content":"powershell,cmdlet,jea","needQuote":true,"nodes":[{"content":"powershell,cmdlet,jea","pos":[0,21]}]},{"pos":[156,173],"content":"role capabilities","needQuote":true,"nodes":[{"content":"role capabilities","pos":[0,17]}]},{"content":"Role Capabilities","pos":[208,225]},{"content":"Overview","pos":[230,238]},{"content":"In the above section, you learned that the \"RoleDefinitions\" field defined which groups had access to which Role Capabilities.","pos":[239,365]},{"content":"You may have wondered, \"What are Role Capabilities?\"","pos":[366,418],"source":"\nYou may have wondered, \"What are Role Capabilities?\""},{"content":"This section will answer that question.","pos":[419,458],"source":"\nThis section will answer that question."},{"content":"Introducing PowerShell Role Capabilities","pos":[465,505]},{"content":"PowerShell Role Capabilities define \"what\" a user can do at a JEA endpoint.","pos":[506,581]},{"content":"They detail a whitelist of things like visible commands, visible applications, and more.","pos":[582,670],"source":"\nThey detail a whitelist of things like visible commands, visible applications, and more."},{"content":"Role Capabilities are defined by files with a \".psrc\" extension.","pos":[671,735],"source":"\nRole Capabilities are defined by files with a \".psrc\" extension."},{"content":"Role Capability Contents","pos":[740,764]},{"content":"We will start by examining and modifying the demo Role Capability file you used before.","pos":[765,852]},{"content":"Imagine you have deployed your Session Configuration across your environment, but you have gotten feedback that you need to change the capabilities exposed to users.","pos":[853,1018],"source":"\nImagine you have deployed your Session Configuration across your environment, but you have gotten feedback that you need to change the capabilities exposed to users."},{"content":"Operators need the ability to restart machines, and they also want to be able to get information about network settings.","pos":[1019,1139],"source":"\nOperators need the ability to restart machines, and they also want to be able to get information about network settings."},{"content":"In addition, the security team has told you that allowing users to run \"Restart-Service\" without any restrictions is not acceptable.","pos":[1140,1272],"source":"\nIn addition, the security team has told you that allowing users to run \"Restart-Service\" without any restrictions is not acceptable."},{"content":"You need to restrict the services that operators can restart.","pos":[1273,1334],"source":"\nYou need to restrict the services that operators can restart."},{"content":"To make these changes, start by running PowerShell ISE as an Administrator and open the following file:","pos":[1336,1439]},{"content":"Now find and update the following lines in the file:","pos":[1539,1591]},{"content":"This contains a few interesting examples:","pos":[2001,2042]},{"content":"You have restricted Restart-Service such that operators will only be able to use Restart-Service with the -Name parameter, and they will only be allowed to provide \"Spooler\" as an argument to that parameter.","pos":[2048,2255]},{"content":"If you wanted to, you could also restrict the arguments using a regular expression using \"ValidatePattern\" instead of \"ValidateSet\".","pos":[2256,2388],"source":"\nIf you wanted to, you could also restrict the arguments using a regular expression using \"ValidatePattern\" instead of \"ValidateSet\"."},{"content":"You have exposed all commands with the \"Get\" verb from the NetTCPIP module.","pos":[2394,2469]},{"content":"Because \"Get\" commands typically don't change system state, this is a relatively safe action.","pos":[2470,2563],"source":"\nBecause \"Get\" commands typically don't change system state, this is a relatively safe action."},{"content":"That being said, it is strongly encouraged to closely examinine every command you expose through JEA.","pos":[2564,2665],"source":"\nThat being said, it is strongly encouraged to closely examinine every command you expose through JEA."},{"content":"You have exposed an executable (ipconfig) using VisibleExternalCommands.","pos":[2671,2743]},{"content":"You can also expose full PowerShell scripts with this field.","pos":[2744,2804],"source":"\nYou can also expose full PowerShell scripts with this field."},{"content":"It is important to always provide the full path to external commands to ensure a similarly named (and potentially malicious) program placed in the user's path does not get executed instead.","pos":[2805,2994],"source":"\nIt is important to always provide the full path to external commands to ensure a similarly named (and potentially malicious) program placed in the user's path does not get executed instead."},{"content":"Save the file, then connect to the demo endpoint again to confirm the changes worked.","pos":[2996,3081]},{"content":"Because you only modified the Role Capability file, you do not need to re-register the Session Configuration.","pos":[3199,3308]},{"content":"PowerShell will automatically find your updated Role Capability when a user connects.","pos":[3309,3394],"source":"\nPowerShell will automatically find your updated Role Capability when a user connects."},{"content":"Since Role Capabilities are loaded when the session starts, existing sessions are not affected by updates to Role Capability files.","pos":[3395,3526],"source":"\nSince Role Capabilities are loaded when the session starts, existing sessions are not affected by updates to Role Capability files."},{"content":"Now, confirm that you can restart the computer by running Restart-Computer with the -WhatIf parameter (unless you actually want to restart the computer).","pos":[3528,3681]},{"content":"Confirm that you can run \"ipconfig\"","pos":[3727,3762]},{"content":"And finally, confirm that Restart-Service only works for the Spooler service.","pos":[3792,3869]},{"content":"Exit the session when you are finished.","pos":[3976,4015]},{"content":"Role Capability Creation","pos":[4054,4078]},{"content":"In the next section, you will create a JEA endpoint for AD help desk users.","pos":[4079,4154]},{"content":"To prepare, we will create a blank Role Capability file to fill in for that section.","pos":[4155,4239],"source":"\nTo prepare, we will create a blank Role Capability file to fill in for that section."},{"content":"Role Capabilities must be created inside a \"RoleCapabilities\" folder inside a valid PowerShell module in order to be resolved when a session starts.","pos":[4240,4388],"source":"\nRole Capabilities must be created inside a \"RoleCapabilities\" folder inside a valid PowerShell module in order to be resolved when a session starts."},{"content":"PowerShell Modules are essentially packages of PowerShell functionality.","pos":[4390,4462]},{"content":"They can contain PowerShell functions, cmdlets, DSC Resources, Role Capabilities, and more.","pos":[4463,4554],"source":"\nThey can contain PowerShell functions, cmdlets, DSC Resources, Role Capabilities, and more."},{"content":"You can find information about modules by running <ph id=\"ph1\">`Get-Help about_Modules`</ph> in a PowerShell console.","pos":[4555,4654],"source":"\nYou can find information about modules by running `Get-Help about_Modules` in a PowerShell console."},{"content":"To create a new PowerShell module with a blank Role Capability file, run the following commands:","pos":[4656,4752]},{"content":"Congratulations, you have created a blank Role Capability File.","pos":[5889,5952]},{"content":"It will be used in the next section.","pos":[5953,5989],"source":"\nIt will be used in the next section."},{"content":"Key Concepts","pos":[5994,6006]},{"content":"<bpt id=\"p1\">**</bpt>Role Capability (.psrc)<ept id=\"p1\">**</ept>: A file that defines \"what\" a user can do at a JEA endpoint.","pos":[6007,6095],"source":"**Role Capability (.psrc)**:\nA file that defines \"what\" a user can do at a JEA endpoint."},{"content":"It details a whitelist of things like visible commands, visible console applications, and more.","pos":[6096,6191],"source":"\nIt details a whitelist of things like visible commands, visible console applications, and more."},{"content":"In order for PowerShell to detect Role Capabilities, you must put them in a \"RoleCapabilities\" folder in a valid PowerShell module.","pos":[6192,6323],"source":"\nIn order for PowerShell to detect Role Capabilities, you must put them in a \"RoleCapabilities\" folder in a valid PowerShell module."},{"content":"<bpt id=\"p1\">**</bpt>PowerShell Module<ept id=\"p1\">**</ept>: A package of PowerShell functionality.","pos":[6325,6386],"source":"**PowerShell Module**:\nA package of PowerShell functionality."},{"content":"It can contain PowerShell functions, cmdlets, DSC Resources, Role Capabilities, and more.","pos":[6387,6476],"source":"\nIt can contain PowerShell functions, cmdlets, DSC Resources, Role Capabilities, and more."},{"content":"In order to be automatically loaded, PowerShell modules must be located under a path in <ph id=\"ph1\">`$env:PSModulePath`</ph>.","pos":[6477,6585],"source":"\nIn order to be automatically loaded, PowerShell modules must be located under a path in `$env:PSModulePath`."}],"content":"---\ndescription:  \nmanager:  dongill\nms.topic:  article\nauthor:  jpjofre\nms.prod:  powershell\nkeywords:  powershell,cmdlet,jea\nms.date:  2016-06-22\ntitle:  role capabilities\nms.technology:  powershell\n---\n\n# Role Capabilities\n\n## Overview\nIn the above section, you learned that the \"RoleDefinitions\" field defined which groups had access to which Role Capabilities.\nYou may have wondered, \"What are Role Capabilities?\"\nThis section will answer that question.  \n\n## Introducing PowerShell Role Capabilities\nPowerShell Role Capabilities define \"what\" a user can do at a JEA endpoint.\nThey detail a whitelist of things like visible commands, visible applications, and more.\nRole Capabilities are defined by files with a \".psrc\" extension.\n\n## Role Capability Contents\nWe will start by examining and modifying the demo Role Capability file you used before.\nImagine you have deployed your Session Configuration across your environment, but you have gotten feedback that you need to change the capabilities exposed to users.\nOperators need the ability to restart machines, and they also want to be able to get information about network settings.\nIn addition, the security team has told you that allowing users to run \"Restart-Service\" without any restrictions is not acceptable.\nYou need to restrict the services that operators can restart.\n\nTo make these changes, start by running PowerShell ISE as an Administrator and open the following file:\n\n```\nC:\\Program Files\\WindowsPowerShell\\Modules\\Demo_Module\\RoleCapabilities\\Maintenance.psrc\n```\n\nNow find and update the following lines in the file:\n\n```PowerShell\n# OLD: VisibleCmdlets = 'Restart-Service'\nVisibleCmdlets = 'Restart-Computer',\n                 @{\n                     Name = 'Restart-Service'\n                     Parameters = @{ Name = 'Name'; ValidateSet = 'Spooler' }\n                 },\n                 'NetTCPIP\\Get-*'\n\n# OLD: VisibleExternalCommands = 'Item1', 'Item2'\nVisibleExternalCommands = 'C:\\Windows\\system32\\ipconfig.exe'\n```\n\nThis contains a few interesting examples:\n\n1.  You have restricted Restart-Service such that operators will only be able to use Restart-Service with the -Name parameter, and they will only be allowed to provide \"Spooler\" as an argument to that parameter.\nIf you wanted to, you could also restrict the arguments using a regular expression using \"ValidatePattern\" instead of \"ValidateSet\".\n\n2.  You have exposed all commands with the \"Get\" verb from the NetTCPIP module.\nBecause \"Get\" commands typically don't change system state, this is a relatively safe action.\nThat being said, it is strongly encouraged to closely examinine every command you expose through JEA.\n\n3.  You have exposed an executable (ipconfig) using VisibleExternalCommands.\nYou can also expose full PowerShell scripts with this field.\nIt is important to always provide the full path to external commands to ensure a similarly named (and potentially malicious) program placed in the user's path does not get executed instead.\n\nSave the file, then connect to the demo endpoint again to confirm the changes worked.\n\n```PowerShell\nEnter-PSSession -ComputerName . -ConfigurationName JEADemo2 -Credential $NonAdminCred\nGet-Command\n```\nBecause you only modified the Role Capability file, you do not need to re-register the Session Configuration.\nPowerShell will automatically find your updated Role Capability when a user connects.\nSince Role Capabilities are loaded when the session starts, existing sessions are not affected by updates to Role Capability files.\n\nNow, confirm that you can restart the computer by running Restart-Computer with the -WhatIf parameter (unless you actually want to restart the computer).\n\n```PowerShell\nRestart-Computer -WhatIf\n```\n\nConfirm that you can run \"ipconfig\"\n\n```PowerShell\nipconfig\n```\n\nAnd finally, confirm that Restart-Service only works for the Spooler service.\n\n```PowerShell\nRestart-Service Spooler # This should work\nRestart-Service WSearch # This should fail\n```\n\nExit the session when you are finished.\n\n```PowerShell\nExit-PSSession\n```\n\n## Role Capability Creation\nIn the next section, you will create a JEA endpoint for AD help desk users.\nTo prepare, we will create a blank Role Capability file to fill in for that section.\nRole Capabilities must be created inside a \"RoleCapabilities\" folder inside a valid PowerShell module in order to be resolved when a session starts.\n\nPowerShell Modules are essentially packages of PowerShell functionality.\nThey can contain PowerShell functions, cmdlets, DSC Resources, Role Capabilities, and more.\nYou can find information about modules by running `Get-Help about_Modules` in a PowerShell console.\n\nTo create a new PowerShell module with a blank Role Capability file, run the following commands:  \n\n```PowerShell\n# Create a new folder for the module.\nNew-Item -Path 'C:\\Program Files\\WindowsPowerShell\\Modules\\Contoso_AD_Module' -ItemType Directory\n\n# Add a module manifest to contain metadata for this module.\nNew-ModuleManifest -Path 'C:\\Program Files\\WindowsPowerShell\\Modules\\Contoso_AD_Module\\Contoso_AD_Module.psd1' -RootModule Contoso_AD_Module.psm1\n\n# Create a blank script module. You'll use this for custom functions in the next section.\nNew-Item -Path 'C:\\Program Files\\WindowsPowerShell\\Modules\\Contoso_AD_Module\\Contoso_AD_Module.psm1' -ItemType File\n\n# Create a RoleCapabilities folder in the Contoso_AD_Module folder. PowerShell expects Role Capabilities to be located in a \"RoleCapabilities\" folder within a module.\nNew-Item -Path 'C:\\Program Files\\WindowsPowerShell\\Modules\\Contoso_AD_Module\\RoleCapabilities' -ItemType Directory\n\n# Create a blank Role Capability in your RoleCapabilities folder. Running this command without any additional parameters just creates a blank template.\nNew-PSRoleCapabilityFile -Path 'C:\\Program Files\\WindowsPowerShell\\Modules\\Contoso_AD_Module\\RoleCapabilities\\ADHelpDesk.psrc'\n```\n\nCongratulations, you have created a blank Role Capability File.\nIt will be used in the next section.\n\n## Key Concepts\n**Role Capability (.psrc)**:\nA file that defines \"what\" a user can do at a JEA endpoint.\nIt details a whitelist of things like visible commands, visible console applications, and more.\nIn order for PowerShell to detect Role Capabilities, you must put them in a \"RoleCapabilities\" folder in a valid PowerShell module.\n\n**PowerShell Module**:\nA package of PowerShell functionality.\nIt can contain PowerShell functions, cmdlets, DSC Resources, Role Capabilities, and more.\nIn order to be automatically loaded, PowerShell modules must be located under a path in `$env:PSModulePath`.\n\n"}