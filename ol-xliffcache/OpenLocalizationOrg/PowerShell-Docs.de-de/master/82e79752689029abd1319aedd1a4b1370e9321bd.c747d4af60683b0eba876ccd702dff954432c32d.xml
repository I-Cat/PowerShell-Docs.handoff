{"nodes":[{"pos":[32,81],"content":"Troubleshooting the ATA error log | Microsoft ATA","needQuote":true,"nodes":[{"content":"Troubleshooting the ATA error log | Microsoft ATA","pos":[0,49]}]},{"pos":[95,150],"content":"Describes how you can troubleshoot common errors in ATA","needQuote":true,"nodes":[{"content":"Describes how you can troubleshoot common errors in ATA","pos":[0,55]}]},{"content":"Applies to: Advanced Threat Analytics version 1.7","pos":[469,518]},{"pos":[525,558],"content":"Troubleshooting the ATA error log","linkify":"Troubleshooting the ATA error log","nodes":[{"content":"Troubleshooting the ATA error log","pos":[0,33]}]},{"content":"This section details possible errors in the deployments of ATA and the steps required for troubleshooting them.","pos":[559,670]},{"pos":[674,692],"content":"ATA Gateway errors","linkify":"ATA Gateway errors","nodes":[{"content":"ATA Gateway errors","pos":[0,18]}]},{"content":"Error","pos":[694,699]},{"content":"Description","pos":[700,711]},{"content":"Resolution","pos":[712,722]},{"content":"System.DirectoryServices.Protocols.LdapException: A local error occurred","pos":[762,834]},{"content":"The ATA Gateway failed to authenticate against the domain controller.","pos":[835,904]},{"content":"1. Confirm that the domain controller’s DNS record is configured properly in the DNS server.","pos":[905,997]},{"content":"2. Verify that the time of the ATA Gateway is synchronized with the time of the domain controller.","pos":[1002,1100]},{"content":"System.IdentityModel.Tokens.SecurityTokenValidationException: Failed to validate certificate chain","pos":[1103,1201]},{"content":"The ATA Gateway failed to validate the certificate of the ATA Center.","pos":[1202,1271]},{"content":"1. Verify that the Root CA certificate is installed in the trusted certificate authority certificate store on the ATA Gateway.","pos":[1272,1398]},{"content":"2. Validate that the certificate revocation list (CRL) is available and that certificate revocation validation can be performed.","pos":[1403,1531]},{"content":"Microsoft.Common.ExtendedException: Failed to parse time generated","pos":[1534,1600]},{"content":"The ATA Gateway failed to parse syslog messages that were forwarded from the SIEM.","pos":[1601,1683]},{"content":"Verify that the SIEM is configured to forward the messages in one of the formats that are supported by ATA.","pos":[1684,1791]},{"content":"System.ServiceModel.FaultException: An error occurred when verifying security for the message.","pos":[1794,1888]},{"content":"The ATA Gateway failed to authenticate against ATA Center.","pos":[1889,1947]},{"content":"Verify that the time of the ATA Gateway is synchronized with the time of the ATA Center.","pos":[1948,2036]},{"content":"System.ServiceModel.EndpointNotFoundException: Could not connect to net.tcp://center.ip.addr:443/IEntityReceiver","pos":[2039,2151]},{"content":"The ATA Gateway failed to establish connection to the ATA Center.","pos":[2152,2217]},{"content":"Ensure that the network settings are correct and that the network connection between the ATA Gateway and the ATA Center is active.","pos":[2218,2348]},{"content":"System.DirectoryServices.Protocols.LdapException: The LDAP server is unavailable.","pos":[2351,2432]},{"content":"The ATA Gateway failed to query the domain controller using the LDAP protocol.","pos":[2433,2511]},{"content":"1.Verify that the user account used by ATA to connect to the Active Directory domain has read access to all the objects in the Active Directory tree.","pos":[2512,2661]},{"content":"2.Make sure that the domain controller is not hardened to prevent LDAP queries from the user account used by ATA.","pos":[2666,2779]},{"content":"Microsoft.Tri.Infrastructure.ContractException: Contract exception","pos":[2782,2848]},{"content":"The ATA Gateway failed to synchronize the configuration from the ATA Center.","pos":[2849,2925]},{"content":"Complete configuration of the ATA Gateway in the ATA Console.","pos":[2926,2987]},{"content":"System.Reflection.ReflectionTypeLoadException: Unable to load one or more of the requested types.","pos":[2990,3087]},{"content":"Retrieve the LoaderExceptions property for more information.","pos":[3088,3148]},{"content":"Message Analyzer is installed on the ATA Gateway.","pos":[3149,3198]},{"content":"Uninstall Message Analyzer.","pos":[3200,3227]},{"content":"Error [Layout] System.OutOfMemoryException: Exception of type 'System.OutOfMemoryException' was thrown.","pos":[3230,3333]},{"content":"The ATA Gateway does not have enough memory.","pos":[3334,3378]},{"content":"Increase the amount of memory on the domain controller.","pos":[3379,3434]},{"content":"Fail to start live consumer  ---&gt; Microsoft.Opn.Runtime.Monitoring.MessageSessionException: The PEFNDIS event provider is not ready","pos":[3437,3568],"source":"Fail to start live consumer  ---> Microsoft.Opn.Runtime.Monitoring.MessageSessionException: The PEFNDIS event provider is not ready"},{"content":"PEF (Message Analyzer) was not installed correctly.","pos":[3569,3620]},{"content":"If using Hyper-V, try to upgrade the Hyper-V Integration services otherwise, contact support for a workaround.","pos":[3621,3731]},{"content":"Installation failed with error: 0x80070652","pos":[3734,3776]},{"content":"There are other pending installations on your computer.","pos":[3777,3832]},{"content":"Wait for the other installations to complete and, if necessary, restart the computer.","pos":[3833,3918]},{"content":"System.InvalidOperationException: Instance 'Microsoft.Tri.Gateway' does not exist in the specified Category.","pos":[3921,4029]},{"content":"PIDs was enabled for process names in the ATA Gateway","pos":[4030,4083]},{"pos":[4084,4178],"content":"Use <bpt id=\"p1\">[</bpt>KB281884<ept id=\"p1\">](https://support.microsoft.com/en-us/kb/281884)</ept> to disable PIDs in process names","source":"Use [KB281884](https://support.microsoft.com/en-us/kb/281884) to disable PIDs in process names"},{"content":"System.InvalidOperationException: Category does not exist.","pos":[4181,4239]},{"content":"Counters might be disabled in the registry","pos":[4240,4282]},{"pos":[4283,4378],"content":"Use <bpt id=\"p1\">[</bpt>KB2554336<ept id=\"p1\">](https://support.microsoft.com/en-us/kb/2554336)</ept> to rebuild Performance Counters","source":"Use [KB2554336](https://support.microsoft.com/en-us/kb/2554336) to rebuild Performance Counters"},{"content":"System.ApplicationException: Unable to start ETW session MMA-ETW-Livecapture-a4f595bd-f567-49a7-b963-20fa4e370329","pos":[4381,4494]},{"content":"There is a host entry in the HOSTS file pointing to the machine's shortname","pos":[4495,4570]},{"content":"Remove the host entry from C:\\Windows\\System32\\drivers\\etc\\HOSTS file or change it to an FQDN.","pos":[4571,4665]},{"pos":[4672,4726],"content":"ATA IIS errors (Not applicable for ATA v1.7 and above)","linkify":"ATA IIS errors (Not applicable for ATA v1.7 and above)","nodes":[{"content":"ATA IIS errors (Not applicable for ATA v1.7 and above)","pos":[0,54]}]},{"content":"Error","pos":[4728,4733]},{"content":"Description","pos":[4734,4745]},{"content":"Resolution","pos":[4746,4756]},{"content":"HTTP Error 500.19 – Internal Server Error","pos":[4796,4837]},{"content":"The IIS URL Rewrite module failed to install correctly.","pos":[4838,4893]},{"content":"Uninstall and reinstall the IIS URL Rewrite module.","pos":[4894,4945]},{"content":"Download the IIS URL Rewrite module","pos":[4950,4985]},{"pos":[5039,5056],"content":"Deployment errors","linkify":"Deployment errors","nodes":[{"content":"Deployment errors","pos":[0,17]}]},{"content":"Error","pos":[5058,5063]},{"content":"Description","pos":[5064,5075]},{"content":"Resolution","pos":[5076,5086]},{"content":".Net Framework 4.6.1 installation fails with error 0x800713ec","pos":[5126,5187]},{"content":"The pre-requisites for .Net Framework 4.6.1 are not installed on the server.","pos":[5188,5264]},{"pos":[5266,5477],"content":"Before installing ATA, verify that the windows updates <bpt id=\"p1\">[</bpt>KB2919442<ept id=\"p1\">](https://www.microsoft.com/download/details.aspx?id=42135)</ept> and <bpt id=\"p2\">[</bpt>KB2919355<ept id=\"p2\">](https://support.microsoft.com/kb/2919355)</ept> are installed on the server.","source":"Before installing ATA, verify that the windows updates [KB2919442](https://www.microsoft.com/download/details.aspx?id=42135) and [KB2919355](https://support.microsoft.com/kb/2919355) are installed on the server."},{"content":"ATA .NET installation error image","pos":[5482,5515]},{"pos":[5549,5557],"content":"See Also","linkify":"See Also","nodes":[{"content":"See Also","pos":[0,8]}]},{"content":"ATA prerequisites","pos":[5561,5578]},{"content":"ATA capacity planning","pos":[5641,5662]},{"content":"Configure event collection","pos":[5729,5755]},{"content":"Configuring Windows event forwarding","pos":[5826,5862]},{"content":"Check out the ATA forum!","pos":[5970,5994]}],"content":"---\n# required metadata\n\ntitle: Troubleshooting the ATA error log | Microsoft ATA\ndescription: Describes how you can troubleshoot common errors in ATA \nkeywords:\nauthor: rkarlin\nmanager: mbaldwin\nms.date: 08/24/2016\nms.topic: article\nms.prod:\nms.service: advanced-threat-analytics\nms.technology:\nms.assetid: d89e7aff-a6ef-48a3-ae87-6ac2e39f3bdb\n\n# optional metadata\n\n#ROBOTS:\n#audience:\n#ms.devlang:\nms.reviewer: bennyl\nms.suite: ems\n#ms.tgt_pltfrm:\n#ms.custom:\n\n---\n\n*Applies to: Advanced Threat Analytics version 1.7*\n\n\n\n# Troubleshooting the ATA error log\nThis section details possible errors in the deployments of ATA and the steps required for troubleshooting them.\n## ATA Gateway errors\n|Error|Description|Resolution|\n|-------------|----------|---------|\n|System.DirectoryServices.Protocols.LdapException: A local error occurred|The ATA Gateway failed to authenticate against the domain controller.|1. Confirm that the domain controller’s DNS record is configured properly in the DNS server. <br>2. Verify that the time of the ATA Gateway is synchronized with the time of the domain controller.|\n|System.IdentityModel.Tokens.SecurityTokenValidationException: Failed to validate certificate chain|The ATA Gateway failed to validate the certificate of the ATA Center.|1. Verify that the Root CA certificate is installed in the trusted certificate authority certificate store on the ATA Gateway. <br>2. Validate that the certificate revocation list (CRL) is available and that certificate revocation validation can be performed.|\n|Microsoft.Common.ExtendedException: Failed to parse time generated|The ATA Gateway failed to parse syslog messages that were forwarded from the SIEM.|Verify that the SIEM is configured to forward the messages in one of the formats that are supported by ATA.|\n|System.ServiceModel.FaultException: An error occurred when verifying security for the message.|The ATA Gateway failed to authenticate against ATA Center.|Verify that the time of the ATA Gateway is synchronized with the time of the ATA Center.|\n|System.ServiceModel.EndpointNotFoundException: Could not connect to net.tcp://center.ip.addr:443/IEntityReceiver|The ATA Gateway failed to establish connection to the ATA Center.|Ensure that the network settings are correct and that the network connection between the ATA Gateway and the ATA Center is active.|\n|System.DirectoryServices.Protocols.LdapException: The LDAP server is unavailable.|The ATA Gateway failed to query the domain controller using the LDAP protocol.|1.Verify that the user account used by ATA to connect to the Active Directory domain has read access to all the objects in the Active Directory tree. <br>2.Make sure that the domain controller is not hardened to prevent LDAP queries from the user account used by ATA.|\n|Microsoft.Tri.Infrastructure.ContractException: Contract exception|The ATA Gateway failed to synchronize the configuration from the ATA Center.|Complete configuration of the ATA Gateway in the ATA Console.|\n|System.Reflection.ReflectionTypeLoadException: Unable to load one or more of the requested types. Retrieve the LoaderExceptions property for more information.|Message Analyzer is installed on the ATA Gateway.| Uninstall Message Analyzer.|\n|Error [Layout] System.OutOfMemoryException: Exception of type 'System.OutOfMemoryException' was thrown.|The ATA Gateway does not have enough memory.|Increase the amount of memory on the domain controller.|\n|Fail to start live consumer  ---> Microsoft.Opn.Runtime.Monitoring.MessageSessionException: The PEFNDIS event provider is not ready|PEF (Message Analyzer) was not installed correctly.|If using Hyper-V, try to upgrade the Hyper-V Integration services otherwise, contact support for a workaround.|\n|Installation failed with error: 0x80070652|There are other pending installations on your computer.|Wait for the other installations to complete and, if necessary, restart the computer.|\n|System.InvalidOperationException: Instance 'Microsoft.Tri.Gateway' does not exist in the specified Category.|PIDs was enabled for process names in the ATA Gateway|Use [KB281884](https://support.microsoft.com/en-us/kb/281884) to disable PIDs in process names|\n|System.InvalidOperationException: Category does not exist.|Counters might be disabled in the registry|Use [KB2554336](https://support.microsoft.com/en-us/kb/2554336) to rebuild Performance Counters|\n|System.ApplicationException: Unable to start ETW session MMA-ETW-Livecapture-a4f595bd-f567-49a7-b963-20fa4e370329|There is a host entry in the HOSTS file pointing to the machine's shortname|Remove the host entry from C:\\Windows\\System32\\drivers\\etc\\HOSTS file or change it to an FQDN.|\n\n\n## ATA IIS errors (Not applicable for ATA v1.7 and above)\n|Error|Description|Resolution|\n|-------------|----------|---------|\n|HTTP Error 500.19 – Internal Server Error|The IIS URL Rewrite module failed to install correctly.|Uninstall and reinstall the IIS URL Rewrite module.<br>[Download the IIS URL Rewrite module](http://go.microsoft.com/fwlink/?LinkID=615137)|\n\n## Deployment errors\n|Error|Description|Resolution|\n|-------------|----------|---------|\n|.Net Framework 4.6.1 installation fails with error 0x800713ec|The pre-requisites for .Net Framework 4.6.1 are not installed on the server. |Before installing ATA, verify that the windows updates [KB2919442](https://www.microsoft.com/download/details.aspx?id=42135) and [KB2919355](https://support.microsoft.com/kb/2919355) are installed on the server.|\n\n![ATA .NET installation error image](media/netinstallerror.png)\n\n\n## See Also\n- [ATA prerequisites](/advanced-threat-analytics/plan-design/ata-prerequisites)\n- [ATA capacity planning](/advanced-threat-analytics/plan-design/ata-capacity-planning)\n- [Configure event collection](/advanced-threat-analytics/deploy-use/configure-event-collection)\n- [Configuring Windows event forwarding](/advanced-threat-analytics/deploy-use/configure-event-collection#configuring-windows-event-forwarding)\n- [Check out the ATA forum!](https://social.technet.microsoft.com/Forums/security/home?forum=mata)\n"}