{"nodes":[{"pos":[13,50],"content":"DSC Improvements in WMF 5.1 (Preview)","needQuote":true,"nodes":[{"content":"DSC Improvements in WMF 5.1 (Preview)","pos":[0,37]}]},{"pos":[83,103],"content":"PowerShell, DSC, WMF","needQuote":true,"nodes":[{"content":"PowerShell, DSC, WMF","pos":[0,20]}]},{"content":"Improvements in Desired State Configuration (DSC) in WMF 5.1","pos":[218,278]},{"content":"DSC class resource improvements","pos":[283,314]},{"content":"In WMF 5.1, we have fixed the following known issues:","pos":[316,369]},{"content":"Get-DscConfiguration may return empty values (null) or errors if a complex/hash table type is returned by Get() function of a class-based DSC resource.","pos":[372,523]},{"content":"Get-DscConfiguration returns error if RunAs credential is used in DSC configuration.","pos":[526,610]},{"content":"Class-based resource cannot be used in a composite configuration.","pos":[613,678]},{"content":"Start-DscConfiguration hangs if class-based resource has a property of its own type.","pos":[681,765]},{"content":"Class-based resource cannot be used as an exclusive resource.","pos":[768,829]},{"content":"DSC resource debugging improvements","pos":[835,870]},{"content":"In WMF 5.0, the PowerShell debugger did not stop at the class-based resource method (Get/Set/Test) directly.","pos":[872,980]},{"content":"In WMF 5.1, the debugger will stop at the class-based resource method in the same way as for MOF-based resources methods.","pos":[981,1102],"source":"\nIn WMF 5.1, the debugger will stop at the class-based resource method in the same way as for MOF-based resources methods."},{"content":"DSC pull client supports TLS 1.1 and TLS 1.2","pos":[1107,1151]},{"content":"Previously, the DSC pull client only supported SSL3.0 and TLS1.0 over HTTPS connections.","pos":[1153,1241]},{"content":"When forced to use more secure protocols, the pull client would stop functioning.","pos":[1242,1324],"source":" \nWhen forced to use more secure protocols, the pull client would stop functioning."},{"content":"In WMF 5.1, the DSC pull client no longer supports SSL 3.0 and adds support for the more secure TLS 1.1 and TLS 1.2 protocols.","pos":[1325,1452],"source":" \nIn WMF 5.1, the DSC pull client no longer supports SSL 3.0 and adds support for the more secure TLS 1.1 and TLS 1.2 protocols."},{"content":"Improved pull server registration","pos":[1459,1492]},{"content":"In the earlier versions of WMF, simultaneous registrations/reporting requests to a DSC pull server while using the ESENT database would lead to LCM failing to register and/or report.","pos":[1497,1679]},{"content":"In such cases, the event logs on the pull server will have the error \"Instance Name already in use.\"","pos":[1680,1781],"source":" \nIn such cases, the event logs on the pull server will have the error \"Instance Name already in use.\""},{"content":"This was due to an incorrect pattern being used to access the ESENT database in a multi-threaded scenario.","pos":[1782,1888],"source":"\nThis was due to an incorrect pattern being used to access the ESENT database in a multi-threaded scenario."},{"content":"In WMF 5.1, this issue has been fixed.","pos":[1889,1928],"source":" \nIn WMF 5.1, this issue has been fixed."},{"content":"Concurrent registrations or reporting (involving ESENT database) will work fine in WMF 5.1.","pos":[1929,2021],"source":" \nConcurrent registrations or reporting (involving ESENT database) will work fine in WMF 5.1."},{"content":"This issue is applicable only to the ESENT database and does not apply to the OLEDB database.","pos":[2022,2116],"source":" \nThis issue is applicable only to the ESENT database and does not apply to the OLEDB database."},{"content":"Pull partial configuration naming convention","pos":[2121,2165]},{"content":"In the previous release, the naming convention for a partial configuration was that the MOF file name in the pull server/service should match the partial configuration name specified in the local configuration manager settings that in turn must match the configuration name embedded in the MOF file.","pos":[2166,2465]},{"content":"See the snapshots below:","pos":[2468,2492]},{"content":"•   Local configuration settings which defines a partial configuration that a node is allowed to receive.","pos":[2494,2599]},{"content":"Sample metaconfiguration","pos":[2603,2627]},{"content":"•   Sample partial configuration definition","pos":[2666,2709]},{"content":"•   'ConfigurationName' embedded in the generated MOF file.","pos":[2959,3018]},{"content":"Sample generated mof file","pos":[3022,3047]},{"content":"•   FileName in the pull configuration repository","pos":[3085,3134]},{"content":"FileName in Configuration Repository","pos":[3139,3175]},{"content":"Azure Automation service name generated MOF files as <ph id=\"ph1\">`&lt;ConfigurationName&gt;.&lt;NodeName&gt;.mof`</ph>.","pos":[3219,3309],"source":"Azure Automation service name generated MOF files as `<ConfigurationName>.<NodeName>.mof`."},{"content":"So the configuration below will compile to PartialOne.localhost.mof.","pos":[3310,3379],"source":" \nSo the configuration below will compile to PartialOne.localhost.mof."},{"content":"This made it impossible to pull one of your partial configuration from Azure Automation service.","pos":[3381,3477]},{"content":"In WMF 5.1, partial configuration in the pull server/service can be named as <ph id=\"ph1\">`&lt;ConfigurationName&gt;.&lt;NodeName&gt;.mof`</ph>.","pos":[3726,3840],"source":"In WMF 5.1, partial configuration in the pull server/service can be named as `<ConfigurationName>.<NodeName>.mof`."},{"content":"Moreover, if a machine is pulling a single configuration from a pull server/service then the configuration file on the pull server configuration repository can have any file name.","pos":[3841,4021],"source":" \nMoreover, if a machine is pulling a single configuration from a pull server/service then the configuration file on the pull server configuration repository can have any file name."},{"content":"This naming flexibility allow you to manage your nodes partially by Azure Automation service, where some configuration for your node is coming from Azure Automation DSC and you have a partial configuration that you wanted to manage locally.","pos":[4022,4263],"source":" \nThis naming flexibility allow you to manage your nodes partially by Azure Automation service, where some configuration for your node is coming from Azure Automation DSC and you have a partial configuration that you wanted to manage locally."},{"content":"The metaconfiguration below will set up a node to be managed both locally as well as by Azure Automation service.","pos":[4265,4378]},{"content":"Using PsDscRunAsCredential with DSC composite resources","pos":[5318,5373]},{"pos":[5378,5601],"content":"We have added support for using <bpt id=\"p1\">[</bpt><bpt id=\"p2\">*</bpt>PsDscRunAsCredential<ept id=\"p2\">*</ept><ept id=\"p1\">](https://msdn.microsoft.com/cs-cz/powershell/dsc/runasuser)</ept> with DSC <bpt id=\"p3\">[</bpt>Composite<ept id=\"p3\">](https://msdn.microsoft.com/en-us/powershell/dsc/authoringresourcecomposite)</ept> resources.","source":"We have added support for using [*PsDscRunAsCredential*](https://msdn.microsoft.com/cs-cz/powershell/dsc/runasuser) with DSC [Composite](https://msdn.microsoft.com/en-us/powershell/dsc/authoringresourcecomposite) resources."},{"content":"Users can now specify a value for PsDscRunAsCredential when using composite resources inside configurations.","pos":[5607,5715]},{"content":"When specified, all resources run inside a composite resource as a RunAs user.","pos":[5716,5795],"source":" \nWhen specified, all resources run inside a composite resource as a RunAs user."},{"content":"If a composite resource calls another composite resource, all of its resources are also executed as RunAs user.","pos":[5796,5908],"source":" \nIf a composite resource calls another composite resource, all of its resources are also executed as RunAs user."},{"content":"RunAs credentials are propagated to any level of the composite resource hierarchy.","pos":[5909,5992],"source":" \nRunAs credentials are propagated to any level of the composite resource hierarchy."},{"content":"If any resource inside a composite resource specifies its own value for PsDscRunAsCredential, a merge error will result during configuration compilation.","pos":[5993,6147],"source":" \nIf any resource inside a composite resource specifies its own value for PsDscRunAsCredential, a merge error will result during configuration compilation."},{"pos":[6149,6331],"content":"This example shows usage with <bpt id=\"p1\">[</bpt>WindowsFeatureSet<ept id=\"p1\">](https://msdn.microsoft.com/en-us/powershell/wmf/dsc_newresources)</ept> composite resource included in PSDesiredStateConfiguration module.","source":"This example shows usage with [WindowsFeatureSet](https://msdn.microsoft.com/en-us/powershell/wmf/dsc_newresources) composite resource included in PSDesiredStateConfiguration module."},{"content":"DSC module and configuration signing validations","pos":[7102,7150]},{"content":"In DSC, configurations and modules are distributed to managed computers from the pull server.","pos":[7151,7244]},{"content":"If the pull server is compromised, an attacker can potentially modify the configurations and modules on the pull server and have it distributed to all managed nodes, compromising all of them.","pos":[7245,7437],"source":" \nIf the pull server is compromised, an attacker can potentially modify the configurations and modules on the pull server and have it distributed to all managed nodes, compromising all of them."},{"content":"In WMF 5.1, DSC supports validating the digital signatures on catalog and configuration (.MOF) files.","pos":[7441,7542]},{"content":"This feature will prevent nodes from executing configurations or module files which are not signed by a trusted signer or which have been tampered with after they have been signed by trusted signer.","pos":[7543,7743],"source":" \n This feature will prevent nodes from executing configurations or module files which are not signed by a trusted signer or which have been tampered with after they have been signed by trusted signer."},{"content":"How to sign configuration and module","pos":[7751,7787]},{"pos":[7795,7981],"content":"Configuration Files (.MOFs): The existing PowerShell cmdlet <bpt id=\"p1\">[</bpt>Set-AuthenticodeSignature<ept id=\"p1\">](https://technet.microsoft.com/library/hh849819.aspx)</ept> is extended to support signing of MOF files.","source":"Configuration Files (.MOFs): \nThe existing PowerShell cmdlet [Set-AuthenticodeSignature](https://technet.microsoft.com/library/hh849819.aspx) is extended to support signing of MOF files."},{"pos":[7986,8092],"content":"Modules: Signing of modules is done by signing the corresponding module catalog using the following steps:","source":"Modules:\nSigning of modules is done by signing the corresponding module catalog using the following steps:"},{"pos":[8101,8447],"content":"Create a catalog file: A catalog file contains a collection of cryptographic hashes or thumbprints. \nEach thumbprint corresponds to a file that is included in the module. \nThe new cmdlet [New-FileCatalog](https://technet.microsoft.com/library/cc732148.aspx), has been added to enable users to create a catalog file for their module.","leadings":["","       ","       "],"nodes":[{"content":"Create a catalog file: A catalog file contains a collection of cryptographic hashes or thumbprints.","pos":[0,99]},{"content":"Each thumbprint corresponds to a file that is included in the module.","pos":[101,170]},{"content":"The new cmdlet <bpt id=\"p1\">[</bpt>New-FileCatalog<ept id=\"p1\">](https://technet.microsoft.com/library/cc732148.aspx)</ept>, has been added to enable users to create a catalog file for their module.","pos":[172,332],"source":"The new cmdlet [New-FileCatalog](https://technet.microsoft.com/library/cc732148.aspx), has been added to enable users to create a catalog file for their module."}]},{"pos":[8455,8589],"content":"Sign the catalog file: Use <bpt id=\"p1\">[</bpt>Set-AuthenticodeSignature<ept id=\"p1\">](https://technet.microsoft.com/library/hh849819.aspx)</ept> to sign the catalog file.","source":"Sign the catalog file: \nUse [Set-AuthenticodeSignature](https://technet.microsoft.com/library/hh849819.aspx) to sign the catalog file."},{"content":"Place the catalog file inside the module folder.","pos":[8597,8645]},{"content":"By convention, module catalog file should be placed under the module folder with the same name as the module.","pos":[8646,8755],"source":"\nBy convention, module catalog file should be placed under the module folder with the same name as the module."},{"content":"LocalConfigurationManager settings to enable signing validations","pos":[8760,8824]},{"content":"Pull","pos":[8830,8834]},{"content":"The LocalConfigurationManager of a node performs signing validation of modules and configurations based on its current settings.","pos":[8835,8963]},{"content":"By default, signature validation is disabled.","pos":[8964,9010],"source":" \nBy default, signature validation is disabled."},{"content":"Signature validation can enabled by adding the ‘SignatureValidation’ block to the meta-configuration definition of the node as shown below:","pos":[9011,9151],"source":" \nSignature validation can enabled by adding the ‘SignatureValidation’ block to the meta-configuration definition of the node as shown below:"},{"content":"Setting the above metaconfiguration on a node enables signature validation on downloaded configurations and modules.","pos":[10277,10393]},{"content":"The Local Configuration Manager will perform the following steps to verify the digital signatures.","pos":[10394,10493],"source":" \nThe Local Configuration Manager will perform the following steps to verify the digital signatures."},{"pos":[10498,10737],"content":"Verify the signature on a configuration file (.MOF) is valid. \nIt uses the PowerShell cmdlet [Get-AuthenticodeSignature](https://technet.microsoft.com/library/hh849805.aspx), which is extended in 5.1 to support MOF signature validation.","leadings":["","   "],"nodes":[{"content":"Verify the signature on a configuration file (.MOF) is valid.","pos":[0,61]},{"content":"It uses the PowerShell cmdlet <bpt id=\"p1\">[</bpt>Get-AuthenticodeSignature<ept id=\"p1\">](https://technet.microsoft.com/library/hh849805.aspx)</ept>, which is extended in 5.1 to support MOF signature validation.","pos":[63,236],"source":"It uses the PowerShell cmdlet [Get-AuthenticodeSignature](https://technet.microsoft.com/library/hh849805.aspx), which is extended in 5.1 to support MOF signature validation."}]},{"content":"Verify the certificate authority that authorized the signer is trusted.","pos":[10741,10812]},{"content":"Download module/resource dependencies of the configuration to a temp location.","pos":[10816,10894]},{"content":"Verify the signature of the catalog included inside the module.","pos":[10898,10961]},{"pos":[10968,11123],"content":"Find a <ph id=\"ph1\">`&lt;moduleName&gt;.cat`</ph> file and verify its signature using the cmdlet  <bpt id=\"p1\">[</bpt>Get-AuthenticodeSignature<ept id=\"p1\">](https://technet.microsoft.com/library/hh849805.aspx)</ept>.","source":"Find a `<moduleName>.cat` file and verify its signature using the cmdlet  [Get-AuthenticodeSignature](https://technet.microsoft.com/library/hh849805.aspx)."},{"content":"Verify the certification authority that authenticated the signer is trusted.","pos":[11130,11206]},{"pos":[11213,11362],"content":"Verify the content of the modules has not been tampered using the new cmdlet <bpt id=\"p1\">[</bpt>Test-FileCatalog<ept id=\"p1\">](https://technet.microsoft.com/library/cc732148.aspx)</ept>.","source":"Verify the content of the modules has not been tampered using the new cmdlet [Test-FileCatalog](https://technet.microsoft.com/library/cc732148.aspx)."},{"content":"Install-Module to $env:ProgramFiles\\WindowsPowerShell\\Modules\\","pos":[11366,11428]},{"content":"Process configuration","pos":[11432,11453]},{"content":"Note: Signature validation on module-catalog and configuration is only performed when the configuration is applied to the system for the first time or when the module is downloaded and installed.","pos":[11457,11652]},{"content":"Consistency runs do not validate the signature of Current.mof or its module dependencies.","pos":[11653,11743],"source":" \nConsistency runs do not validate the signature of Current.mof or its module dependencies."},{"content":"If verification has failed at any stage, for instance, if the configuration pulled from the pull server is unsigned, then processing of the configuration will terminate with the error shown below and all temporary files will be deleted.","pos":[11744,11980],"source":"\nIf verification has failed at any stage, for instance, if the configuration pulled from the pull server is unsigned, then processing of the configuration will terminate with the error shown below and all temporary files will be deleted."},{"content":"Sample Error Output Configuration","pos":[11984,12017]},{"content":"Similarly, pulling a module whose catalog is not signed will result in the following error:","pos":[12058,12149]},{"content":"Sample Error Output Module","pos":[12153,12179]},{"content":"Push","pos":[12221,12225]},{"content":"A configuration delivered by using push might be tampered with at its source before it delivered to the node.","pos":[12226,12335]},{"content":"The Local Configuration Manager will perform similar signature validation steps for pushed or published configuration(s).","pos":[12336,12458],"source":" \nThe Local Configuration Manager will perform similar signature validation steps for pushed or published configuration(s)."},{"content":"Below is a complete example of signature validation for push.","pos":[12459,12520],"source":"\nBelow is a complete example of signature validation for push."},{"content":"Enable signature validation on the node.","pos":[12524,12564]},{"content":"Create a sample configuration file.","pos":[12997,13032]},{"content":"Try pushing the unsigned configuration file in to the node.","pos":[13212,13271]},{"content":"ErrorUnsignedMofPushed","pos":[13353,13375]},{"content":"Sign the configuration file using code-signing certificate.","pos":[13411,13470]},{"content":"SignMofFile","pos":[13474,13485]},{"content":"Try pushing the signed MOF file.","pos":[13517,13549]},{"content":"SignMofFile","pos":[13553,13564]}],"content":"---\ntitle:   DSC Improvements in WMF 5.1 (Preview)\nms.date:  2016-07-13\nkeywords:  PowerShell, DSC, WMF\ndescription:  \nms.topic:  article\nauthor:  keithb\nmanager:  dongill\nms.prod:  powershell\nms.technology: WMF\n---\n\n#Improvements in Desired State Configuration (DSC) in WMF 5.1\n\n## DSC class resource improvements\n\nIn WMF 5.1, we have fixed the following known issues:\n* Get-DscConfiguration may return empty values (null) or errors if a complex/hash table type is returned by Get() function of a class-based DSC resource.\n* Get-DscConfiguration returns error if RunAs credential is used in DSC configuration.\n* Class-based resource cannot be used in a composite configuration.\n* Start-DscConfiguration hangs if class-based resource has a property of its own type.\n* Class-based resource cannot be used as an exclusive resource.\n\n\n## DSC resource debugging improvements\n\nIn WMF 5.0, the PowerShell debugger did not stop at the class-based resource method (Get/Set/Test) directly.\nIn WMF 5.1, the debugger will stop at the class-based resource method in the same way as for MOF-based resources methods.\n\n## DSC pull client supports TLS 1.1 and TLS 1.2 \nPreviously, the DSC pull client only supported SSL3.0 and TLS1.0 over HTTPS connections. \nWhen forced to use more secure protocols, the pull client would stop functioning. \nIn WMF 5.1, the DSC pull client no longer supports SSL 3.0 and adds support for the more secure TLS 1.1 and TLS 1.2 protocols.  \n\n## Improved pull server registration ##\n\nIn the earlier versions of WMF, simultaneous registrations/reporting requests to a DSC pull server while using the ESENT database would lead to LCM failing to register and/or report. \nIn such cases, the event logs on the pull server will have the error \"Instance Name already in use.\"\nThis was due to an incorrect pattern being used to access the ESENT database in a multi-threaded scenario. \nIn WMF 5.1, this issue has been fixed. \nConcurrent registrations or reporting (involving ESENT database) will work fine in WMF 5.1. \nThis issue is applicable only to the ESENT database and does not apply to the OLEDB database. \n\n##Pull partial configuration naming convention\nIn the previous release, the naming convention for a partial configuration was that the MOF file name in the pull server/service should match the partial configuration name specified in the local configuration manager settings that in turn must match the configuration name embedded in the MOF file. \n\nSee the snapshots below:\n\n•   Local configuration settings which defines a partial configuration that a node is allowed to receive.\n\n![Sample metaconfiguration](../images/MetaConfigPartialOne.png)\n\n•   Sample partial configuration definition \n\n```PowerShell\nConfiguration PartialOne\n{\n    Node('localhost')\n    {\n        File test \n        {\n            DestinationPath = \"$env:TEMP\\partialconfigexample.txt\"\n            Contents = 'Partial Config Example'\n        }\n    }\n}\nPartialOne\n```\n\n•   'ConfigurationName' embedded in the generated MOF file.\n\n![Sample generated mof file](../images/PartialGeneratedMof.png)\n\n•   FileName in the pull configuration repository \n\n![FileName in Configuration Repository](../images/PartialInConfigRepository.png)\n\nAzure Automation service name generated MOF files as `<ConfigurationName>.<NodeName>.mof`. \nSo the configuration below will compile to PartialOne.localhost.mof.\n\nThis made it impossible to pull one of your partial configuration from Azure Automation service.\n\n```PowerShell\nConfiguration PartialOne\n{\n    Node('localhost')\n    {\n        File test \n        {\n            DestinationPath = \"$env:TEMP\\partialconfigexample.txt\"\n            Contents = 'Partial Config Example'\n        }\n    }\n}\nPartialOne\n```\n\nIn WMF 5.1, partial configuration in the pull server/service can be named as `<ConfigurationName>.<NodeName>.mof`. \nMoreover, if a machine is pulling a single configuration from a pull server/service then the configuration file on the pull server configuration repository can have any file name. \nThis naming flexibility allow you to manage your nodes partially by Azure Automation service, where some configuration for your node is coming from Azure Automation DSC and you have a partial configuration that you wanted to manage locally.\n\nThe metaconfiguration below will set up a node to be managed both locally as well as by Azure Automation service.\n\n```PowerShell\n  [DscLocalConfigurationManager()]\n   Configuration RegistrationMetaConfig\n   {\n        Settings\n        {\n            RefreshFrequencyMins = 30\n            RefreshMode = \"PULL\"            \n        }\n\n        ConfigurationRepositoryWeb web\n        {\n            ServerURL =  $endPoint\n            RegistrationKey = $registrationKey\n            ConfigurationNames = $configurationName\n        }\n\n        # Partial configuration managed by Azure Automation service.\n        PartialConfiguration PartialConfigurationManagedByAzureAutomation\n        {\n            ConfigurationSource = \"[ConfigurationRepositoryWeb]Web\"   \n        }\n    \n        # This partial configuration is managed locally.\n        PartialConfiguration OnPremisesConfig\n        {\n            RefreshMode = \"PUSH\"\n            ExclusiveResources = @(\"Script\")\n        }\n\n   }\n\n   RegistrationMetaConfig\n   slcm -Path .\\RegistrationMetaConfig -Verbose\n ```\n\n# Using PsDscRunAsCredential with DSC composite resources   \n\nWe have added support for using [*PsDscRunAsCredential*](https://msdn.microsoft.com/cs-cz/powershell/dsc/runasuser) with DSC [Composite](https://msdn.microsoft.com/en-us/powershell/dsc/authoringresourcecomposite) resources.    \n\nUsers can now specify a value for PsDscRunAsCredential when using composite resources inside configurations. \nWhen specified, all resources run inside a composite resource as a RunAs user. \nIf a composite resource calls another composite resource, all of its resources are also executed as RunAs user. \nRunAs credentials are propagated to any level of the composite resource hierarchy. \nIf any resource inside a composite resource specifies its own value for PsDscRunAsCredential, a merge error will result during configuration compilation.\n\nThis example shows usage with [WindowsFeatureSet](https://msdn.microsoft.com/en-us/powershell/wmf/dsc_newresources) composite resource included in PSDesiredStateConfiguration module. \n\n\n\n```powershell\n\nConfiguration InstallWindowsFeature     \n{\n    Import-DscResource -ModuleName PSDesiredStateConfiguration\n\n    Node $AllNodes.NodeName\n    {\n        WindowsFeatureSet features \n        {  \n            Name = @(\"Telnet-Client\",\"SNMP-Service\")  \n            Ensure = \"Present\"  \n            IncludeAllSubFeature = $true  \n            PsDscRunAsCredential = Get-Credential   \n        }  \n    }\n\n}\n\n$configData = @{\n    AllNodes = @(\n        @{\n            NodeName             = 'localhost'\n            PSDscAllowDomainUser = $true\n            CertificateFile      = 'C:\\publicKeys\\targetNode.cer'\n            Thumbprint           = '7ee7f09d-4be0-41aa-a47f-96b9e3bdec25'\n        }\n    )\n}\n\n\nInstallWindowsFeature -ConfigurationData $configData \n\n```\n\n##DSC module and configuration signing validations\nIn DSC, configurations and modules are distributed to managed computers from the pull server. \nIf the pull server is compromised, an attacker can potentially modify the configurations and modules on the pull server and have it distributed to all managed nodes, compromising all of them. \n\n In WMF 5.1, DSC supports validating the digital signatures on catalog and configuration (.MOF) files. \n This feature will prevent nodes from executing configurations or module files which are not signed by a trusted signer or which have been tampered with after they have been signed by trusted signer. \n\n\n\n###How to sign configuration and module \n***\n* Configuration Files (.MOFs): \nThe existing PowerShell cmdlet [Set-AuthenticodeSignature](https://technet.microsoft.com/library/hh849819.aspx) is extended to support signing of MOF files.  \n* Modules:\nSigning of modules is done by signing the corresponding module catalog using the following steps: \n    1. Create a catalog file: A catalog file contains a collection of cryptographic hashes or thumbprints. \n       Each thumbprint corresponds to a file that is included in the module. \n       The new cmdlet [New-FileCatalog](https://technet.microsoft.com/library/cc732148.aspx), has been added to enable users to create a catalog file for their module.\n    2. Sign the catalog file: \nUse [Set-AuthenticodeSignature](https://technet.microsoft.com/library/hh849819.aspx) to sign the catalog file.\n    3. Place the catalog file inside the module folder.\nBy convention, module catalog file should be placed under the module folder with the same name as the module.\n\n###LocalConfigurationManager settings to enable signing validations\n\n####Pull\nThe LocalConfigurationManager of a node performs signing validation of modules and configurations based on its current settings. \nBy default, signature validation is disabled. \nSignature validation can enabled by adding the ‘SignatureValidation’ block to the meta-configuration definition of the node as shown below:\n\n```PowerShell\n[DSCLocalConfigurationManager()]\nConfiguration EnableSignatureValidation\n{\n    Settings\n    {\n        RefreshMode = 'PULL'        \n    } \n    \n    ConfigurationRepositoryWeb pullserver{\n      ConfigurationNames = 'sql'\n      ServerURL = 'http://localhost:8080/PSDSCPullServer/PSDSCPullServer.svc'\n      AllowUnsecureConnection = $true\n      RegistrationKey = 'd6750ff1-d8dd-49f7-8caf-7471ea9793fc' # Replace this with correct registration key.\n    }\n    SignatureValidation validations{\n        # By default, LCM will use default Windows trusted publisher store to validate the certificate chain. If TrustedStorePath property is specified, LCM will use this custom store for retrieving the trusted publishers to validate the content.\n        TrustedStorePath = 'Cert:\\LocalMachine\\DSCStore'            \n        SignedItemType = 'Configuration','Module'         # This is a list of DSC artifacts, for which LCM need to verify their digital signature before executing them on the node.       \n    }\n \n}\nEnableSignatureValidation\nSet-DscLocalConfigurationManager -Path .\\EnableSignatureValidation -Verbose \n ```\n\nSetting the above metaconfiguration on a node enables signature validation on downloaded configurations and modules. \nThe Local Configuration Manager will perform the following steps to verify the digital signatures.\n\n1. Verify the signature on a configuration file (.MOF) is valid. \n   It uses the PowerShell cmdlet [Get-AuthenticodeSignature](https://technet.microsoft.com/library/hh849805.aspx), which is extended in 5.1 to support MOF signature validation.\n2. Verify the certificate authority that authorized the signer is trusted.\n3. Download module/resource dependencies of the configuration to a temp location.\n4. Verify the signature of the catalog included inside the module.\n    * Find a `<moduleName>.cat` file and verify its signature using the cmdlet  [Get-AuthenticodeSignature](https://technet.microsoft.com/library/hh849805.aspx).\n    * Verify the certification authority that authenticated the signer is trusted.\n    * Verify the content of the modules has not been tampered using the new cmdlet [Test-FileCatalog](https://technet.microsoft.com/library/cc732148.aspx).\n5. Install-Module to $env:ProgramFiles\\WindowsPowerShell\\Modules\\\n6. Process configuration\n\n> Note: Signature validation on module-catalog and configuration is only performed when the configuration is applied to the system for the first time or when the module is downloaded and installed. \nConsistency runs do not validate the signature of Current.mof or its module dependencies.\nIf verification has failed at any stage, for instance, if the configuration pulled from the pull server is unsigned, then processing of the configuration will terminate with the error shown below and all temporary files will be deleted.\n\n![Sample Error Output Configuration](../images/PullUnsignedConfigFail.png)\n\nSimilarly, pulling a module whose catalog is not signed will result in the following error:\n\n![Sample Error Output Module](../images/PullUnisgnedCatalog.png)\n\n####Push\nA configuration delivered by using push might be tampered with at its source before it delivered to the node. \nThe Local Configuration Manager will perform similar signature validation steps for pushed or published configuration(s).\nBelow is a complete example of signature validation for push.\n\n* Enable signature validation on the node.\n\n```PowerShell\n[DSCLocalConfigurationManager()]\nConfiguration EnableSignatureValidation\n{\n    Settings\n    {\n        RefreshMode = 'PUSH'        \n    } \n    SignatureValidation validations{\n        TrustedStorePath = 'Cert:\\LocalMachine\\DSCStore'   \n        SignedItemType =  'Configuration','Module'             \n    }\n\n}\nEnableSignatureValidation\nSet-DscLocalConfigurationManager -Path .\\EnableSignatureValidation -Verbose\n``` \n* Create a sample configuration file.\n\n```PowerShell\n# Sample configuration\nConfiguration Test\n{\n\n    File foo\n    {\n        DestinationPath =  \"$env:TEMP\\signingTest.txt\"\n        Contents = \"ABC\"\n    }\n}\nTest\n```\n\n* Try pushing the unsigned configuration file in to the node. \n\n```PowerShell\nStart-DscConfiguration -Path .\\Test -Wait -Verbose -Force\n``` \n![ErrorUnsignedMofPushed](../images/PushUnsignedMof.png)\n\n* Sign the configuration file using code-signing certificate.\n\n![SignMofFile](../images/SignMofFile.png)\n\n* Try pushing the signed MOF file.\n\n![SignMofFile](../images/PushSignedMof.png)\n\n"}